%%
% Copyright (c) 2017 - 2023, Pascal Wagler;
% Copyright (c) 2014 - 2023, John MacFarlane
%
% All rights reserved.
%
% Redistribution and use in source and binary forms, with or without
% modification, are permitted provided that the following conditions
% are met:
%
% - Redistributions of source code must retain the above copyright
% notice, this list of conditions and the following disclaimer.
%
% - Redistributions in binary form must reproduce the above copyright
% notice, this list of conditions and the following disclaimer in the
% documentation and/or other materials provided with the distribution.
%
% - Neither the name of John MacFarlane nor the names of other
% contributors may be used to endorse or promote products derived
% from this software without specific prior written permission.
%
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
% "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
% LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
% FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
% COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
% INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
% BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
% LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
% CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
% LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
% ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
% POSSIBILITY OF SUCH DAMAGE.
%%

%%
% This is the Eisvogel pandoc LaTeX template.
%
% For usage information and examples visit the official GitHub page:
% https://github.com/Wandmalfarbe/pandoc-latex-template
%%

% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names,table}{xcolor}
%
\documentclass[
  11pt,
  a4paperpaper,
  oneside, openany  ,captions=tableheading
]{scrbook}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
% Changes and includes to the eisvogel template
% needs to be loaded before the fonts are set otherwise fonts are not properly chosen
% TODO check!
% custom package/styles for boxes, figures, xkcd, postits
\usepackage[]{igeo} %options: chapterpage, chapterheader 
% delete the following in eisvogel.tex template: to prevent: Not in outer par mode
% uncomment: \makeatletter\def\fps@figure{htbp}\makeatother
\PassOptionsToPackage{headsepline,footsepline}{scrlayer-scrpage}
\PassOptionsToPackage{ngerman}{babel}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	


\usepackage{amsmath,amssymb}
% Use setspace anyway because we change the default line spacing.
% The spacing is changed early to affect the titlepage and the TOC.															 
\usepackage{setspace}
\setstretch{1.2}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage[]{arial}
\ifPDFTeX\else
  % xetex/luatex font selection
  \setmainfont[]{Arial}
  \setsansfont[]{Arial}
  \setmonofont[Scale=0.9]{Courier New}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
% remove colordefinitions, as they are defined in igeo.sty
% \definecolor{default-linkcolor}{HTML}{A50000}
% \definecolor{default-filecolor}{HTML}{A50000}
% \definecolor{default-citecolor}{HTML}{4077C0}
% \definecolor{default-urlcolor}{HTML}{4077C0}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={EinfÃ¼hrung in IoT},
  pdfauthor={Pia Bereuter},
  pdflang={de},
  colorlinks=true,
  linkcolor={gray},
  filecolor={default-filecolor},
  citecolor={default-citecolor},
  urlcolor={default-urlcolor},
  breaklinks=true,
  pdfcreator={LaTeX via pandoc with the Eisvogel template}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[inner=2.1cm, outer=4cm, top=3cm,
bottom=3cm,marginpar=3cm,headsep=8mm]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

% Workaround/bugfix from jannick0.
% See https://github.com/jgm/pandoc/issues/4302#issuecomment-360669013)
% or https://github.com/Wandmalfarbe/pandoc-latex-template/issues/2
%
% Redefine the verbatim environment 'Highlighting' to break long lines (with
% the help of fvextra). Redefinition is necessary because it is unlikely that
% pandoc includes fvextra in the default template.
\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,fontsize=\small,commandchars=\\\{\}, breaknonspaceingroup}

\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
% add backlinks to footnote references, cf. https://tex.stackexchange.com/questions/302266/make-footnote-clickable-both-ways
\usepackage{footnotebackref}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Have figures scaled if necessary and allow for oversize images as in the igeo package
%\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
%https://tex.stackexchange.com/questions/439918/set-default-value-for-max-width-of-includegraphics
\usepackage[export]{adjustbox}
\usepackage{etoolbox}
\expandafter\patchcmd\csname Gin@ii\endcsname
  {\setkeys {Gin}{#1}}
  {%
    \setkeys {Gin}
      {max width=\textwidth,max height=.5\textwidth,keepaspectratio,#1}%
  }
  {}{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% Set default figure placement to htbp
\makeatletter
% Make use of float-package and set default placement for figures to H.
% The option H means 'PUT IT HERE' (as  opposed to the standard h option which means 'You may put it here if you like').
\usepackage{float}
\floatplacement{figure}{H}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{1}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother		
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
  {\begin{list}{}{%
   \setlength{\itemindent}{0pt}
   \setlength{\leftmargin}{0pt}
   \setlength{\parsep}{0pt}
   % turn on hanging indent if param 1 is 1
   \ifodd #1
    \setlength{\leftmargin}{\cslhangindent}
    \setlength{\itemindent}{-1\cslhangindent}
   \fi
   % set entry spacing
   \setlength{\itemsep}{#2\baselineskip}}}
  {\end{list}}
   
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
\ifLuaTeX																											
\usepackage[bidi=basic]{babel}
\else
\usepackage[bidi=default]{babel}
\fi
\babelprovide[main,import]{ngerman}
\ifPDFTeX
\else
\babelfont{rm}[]{Arial}
\fi
% get rid of language-specific shorthands (see #6817):
\let\LanguageShortHands\languageshorthands
\def\languageshorthands#1{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
% further includes and changes to the Eisvogel template
% Make use of float-package and set default placement for figures to H.
% The option H means 'PUT IT HERE' (as  opposed to the standard h option which means 'You may put it here if you like').
\usepackage{float}
\floatplacement{figure}{H}

\usepackage{xparse}
% if there is no minitoc
\let\oldchapter\chapter
\RenewDocumentCommand{\chapter}{ s O{#3} m}{%
	\IfBooleanTF{#1}{%
	  % chapter is starred, no \minitoc
    \oldchapter*{#3}%
    \markboth{#3}{#3}%
    %\addstarredchapter{#3}
    %\addcontentsline{toc}{chapter}{#3}%
	}{%
	  \oldchapter[#2]{#3}%
	}%
}
		

% Header Chapter mark
\automark{chapter}
%\automark*{section} % Section Titles in Header if \headmark is used

% check if KOMA Classes are being applied
	



	


\IfFileExists{images/fhnw.eps}{\renewcommand{\logo}{images/fhnw.eps}}{}

																			 
%%%% header-includes start					  
%\@ifpackageloaded{igeo}{}{
%	\usepackage[]{igeo}%check if option can be reset
%}
\definecolor{colShade}{HTML}{DCE6EB}% shade color - usually light grey 
\definecolor{colPrimary}{HTML}{227FA6} 
\definecolor{colSecondary}{HTML}{6E986A}      
\definecolor{colTertiary}{HTML}{CE8243}  
\usepackage{makeidx}
\makeindex     \makeatletter\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{plain}
\@ifundefined{c@chapter}{\newfloat{video}{h}{lovid}}{\newfloat{video}{h}{lovid}[chapter]}
\floatname{video}{Video}\newcommand*\listofvideos{\listof{video}{List of Videos}}\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Inhaltsverzeichnis}
\else
  \newcommand\contentsname{Inhaltsverzeichnis}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{Abbildungsverzeichnis}
\else
  \newcommand\listfigurename{Abbildungsverzeichnis}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{Tabellenverzeichnis}
\else
  \newcommand\listtablename{Tabellenverzeichnis}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Abb.}
\else
  \newcommand\figurename{Abb.}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Tab.}
\else
  \newcommand\tablename{Tab.}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{Listingverzeichnis}}
\captionsetup{labelsep=colon}
\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{exercise}{Ãbung}[chapter]
\theoremstyle{remark}
\AtBeginDocument{\renewcommand*{\proofname}{Beweis}}
\newtheorem*{remark}{Anmerkung}
\newtheorem*{solution}{LÃ¶sung}
\newtheorem{refremark}{Anmerkung}[chapter]
\newtheorem{refsolution}{LÃ¶sung}[chapter]
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tikz}{}{\usepackage{tikz}}
\makeatother
        \newcommand*\circled[1]{\tikz[baseline=(char.base)]{
          \node[shape=circle,draw,inner sep=1pt] (char) {{\scriptsize#1}};}}  
                  
%%%% header-includes end

% Quarto Environment codelisting mit caption z.B. Dateiname fÃ¼r ein Codebeispiel
% Listings ohne floatstyle "ruled" Ã¼berschreiben des Stils "plaintop"
% Folgender Befehl reicht nicht:
% reduziert den Abstand oberhalb der Bildunterschrift (nicht nur bei codelisting)
% \setlength{\abovecaptionskip}{0.5em} 
% Folglich den floatstyle: plaintop Ã¤ndern mit reduziertem Abstand zum Code
% http://mirrors.ctan.org/macros/latex/contrib/float/float.pdf Seite 11
\makeatletter
\renewcommand\fs@plaintop{\fs@plain
\def\@fs@mid{\vspace{-0.5em}\relax}%
\let\@fs@iftopcapt\iftrue}
\let\floatc@plaintop=\floatc@plain
\makeatother
\floatstyle{plaintop}
\restylefloat{codelisting}

% Line Breaks in Verbatim Environment https://github.com/jgm/pandoc/issues/4302
% addition of breknonspaceingroup and breakanywhere leads to error
%\usepackage{fancyvrb}
%\usepackage{fvextra}
%\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,breaknonspaceingroup, breakanywhere,fontsize=\small,commandchars=\\\{\}}
%\fvset{breaklines}
%\fvset{breaknonspaceingroup}
%\fvset{breakanywhere}


% redefine maketitle for scrbook as well, used only for printing single chapters left aligned
% similar to scrartcl 
% source https://tex.stackexchange.com/questions/494198/customising-the-koma-scrartcl-maketitle-environment
% Redefine \maketitle to be left-aligned
\renewcommand*{\maketitle}{
  \begin{flushleft}
    \vspace*{1em} % Adjust the vertical space as needed
    {\LARGE \bfseries \title} % Title in large bold font
    \vspace{1em} % Adjust the vertical space as needed
    \par
    {\large \author} % Author in large font
    \vspace{1em} % Adjust the vertical space as needed
    \par
    {\large \date} % Date in large font
  \end{flushleft}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={EinfÃ¼hrung in IoT},
  pdfauthor={Pia Bereuter},
  pdflang={de},
  colorlinks=true,
  linkcolor={gray},
  filecolor={default-filecolor},
  citecolor={default-citecolor},
  urlcolor={default-urlcolor},
  breaklinks=true,
  pdfcreator={LaTeX via pandoc with the Eisvogel template}}
\title{EinfÃ¼hrung in IoT\thanks{Thanks to the Quarto team for their
great work on this project.}}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{ModulÃ¼bergreifender Kurs Vertiefung II}
\author{Pia Bereuter}
\date{6. Oktober. 2024}




%%
%% added
%%


%
% for the background color of the title page
%

%
% break urls
%
\PassOptionsToPackage{hyphens}{url}

%
% When using babel or polyglossia with biblatex, loading csquotes is recommended
% to ensure that quoted texts are typeset according to the rules of your main language.
%
\usepackage{csquotes}

%
% captions
%
\definecolor{caption-color}{HTML}{777777}
\usepackage[font={stretch=1.2}, textfont={color=caption-color}, position=top, skip=4mm, labelfont=bf, singlelinecheck=false, justification=raggedright]{caption}
\setcapindent{0em}

%
% blockquote
%
\definecolor{blockquote-border}{RGB}{221,221,221}
\definecolor{blockquote-text}{RGB}{119,119,119}
\usepackage{mdframed}
\newmdenv[rightline=false,bottomline=false,topline=false,linewidth=3pt,linecolor=blockquote-border,skipabove=\parskip]{customblockquote}
\renewenvironment{quote}{\begin{customblockquote}\list{}{\rightmargin=0em\leftmargin=0em}%
\item\relax\color{blockquote-text}\ignorespaces}{\unskip\unskip\endlist\end{customblockquote}}

%
% Source Sans Pro as the default font family
% Source Code Pro for monospace text
%
% 'default' option sets the default
% font family to Source Sans Pro, not \sfdefault.
%
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
    \else % if not pdftex
    \fi

%
% heading color
%
\definecolor{heading-color}{RGB}{40,40,40}
\addtokomafont{section}{\color{heading-color}}
% When using the classes report, scrreprt, book,
% scrbook or memoir, uncomment the following line.
%\addtokomafont{chapter}{\color{heading-color}}

%
% variables for title, author and date
%
\usepackage{titling}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% customise settings for the titling package
% Redefine \maketitle to be left-aligned
\pretitle{\begin{flushleft}\vspace{-4em}\Huge\bfseries}
\posttitle{\par 
\par \huge\mdseries ModulÃ¼bergreifender Kurs Vertiefung II
\vspace{1em}\end{flushleft}}
\preauthor{\begin{flushleft}\large}
\postauthor{\par\vspace{-0.5em}\end{flushleft}}
\predate{\begin{flushleft}\large}
\postdate{\par\vspace{1.5em}\end{flushleft}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{EinfÃ¼hrung in IoT}
\author{Pia Bereuter}
\date{6. Oktober. 2024}

%
% tables
%

\definecolor{table-row-color}{HTML}{F5F5F5}
\definecolor{table-rule-color}{HTML}{999999}

%\arrayrulecolor{black!40}
\arrayrulecolor{table-rule-color}     % color of \toprule, \midrule, \bottomrule
\setlength\heavyrulewidth{0.3ex}      % thickness of \toprule, \bottomrule
\renewcommand{\arraystretch}{1.3}     % spacing (padding)


%
% remove paragraph indentation
%
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines

%
%
% Listings
%
%


%
% header and footer
%
\usepackage[headsepline,footsepline]{scrlayer-scrpage}

% \newpairofpagestyles{eisvogel-header-footer}{
  % \clearpairofpagestyles
  % \ihead*{EinfÃ¼hrung in IoT}
  % \chead*{}
  % \ohead*{6. Oktober. 2024}
  % \ifoot*{Pia Bereuter}
  % \cfoot*{}
  % \ofoot*{\thepage}
  % \addtokomafont{pageheadfoot}{\upshape}
% }
% \pagestyle{eisvogel-header-footer}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% header footer that work with two-sided layout
% header-footer 

\renewcommand*{\chaptermarkformat}{} % no numbers in header
\renewcommand*{\sectionmarkformat}[1]{}
%\automark{chapter}
\makeatletter%
\clearpairofpagestyles
\newpairofpagestyles{eisvogel-header-footer}{%chapter header-footer style
    \clearpairofpagestyles
    \lehead{\headerlogo} % twoside fix ->otherwise use \ihead[]{}
    \lohead{\headerlogo} % e=even, o=odd, l=left, c=center, r=right
    \rehead{\headmark}
    \rohead{\headmark}
    \rehead*{\headmark}
    \rohead*{\headmark}
    \ifoot[\thepage]{\@author} % twoside Jane Doe, John Snow
    \ofoot[\@author]{\thepage}
    %\ifoot[]{\@author} % twoside Jane Doe, John Snow
    %\ofoot[\@author]{}
}
\makeatother%
\pagestyle{eisvogel-header-footer}

\newpairofpagestyles{scrartcl-header-footer}{% style for scrartcl
    \clearpairofpagestyles
    \lehead{\headerlogo} % twoside fix ->otherwise use \ihead[]{}
    \lohead{\headerlogo} % e=even, o=odd, l=left, c=center, r=right
    \rehead{}
    \rohead{}
    \rehead*{}
    \rohead*{}
    \refoot[]{\thepage}% twoside Jane Doe, John Snow
    \rofoot[]{\thepage}
}



\deftripstyle{ChapterStyle}{}{}{}{}{\pagemark}{}
\renewcommand*{\chapterpagestyle}{ChapterStyle}
\renewcommand*{\chapterpagestyle}{eisvogel-header-footer}% Chapter Style schon initiieren

% Workaround da book.lua in quarto bei section noch zusÃ¤tzlich ein markright einfÃ¼gt sind die 
% header oben rechts wenn automark{chapter} definiert ist, dann doch die Sections, die manchmal
% zu lange sind und dann das Logo Ã¼berdecken
% siehe: https://github.com/quarto-dev/quarto-cli/blob/ddaaa39e6f30a72807ab14c1a634d9929cce229b/src/resources/filters/quarto-post/book.lua
% lokal ist dies in der Datei: main.lua
\renewcommand{\markright}[1]{\def\chaptertitle{#1}} % workaround for quarto book.lua
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%
%% end added
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\floatstyle{plain}
\usepackage{makeidx}
\makeindex
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% begin titlepage
% Original Eisvogel Titlepage removed
% % 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Cover Page
\clearpage
\thispagestyle{empty}
\makeatletter%
\fhnwcover[\@subtitle]{\@title}{images/background.jpg}
\makeatother%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% new impressum page
\clearpage
\thispagestyle{empty}
\vspace*{\fill}
{\footnotesize 
\textbf{Impressum} \\
5200 EinfÃ¼hrung in IoT\\
Herbstsemester 2023, 2024

Institut Geomatik, Fachhochschule Nordwestschweiz, Hofackerstrasse 30,
4132 Muttenz\\
Autorin: Prof.~Dr.~Pia Bereuter\\
EinfÃ¼hrung in IoT Â© 2024 von Pia Bereuter ist lizenziert unter
\href{https://creativecommons.org/licenses/by-nc/4.0/}{CC BY-NC 4.0}

Titelbild: Rasperry Pi mit Sensoren, 2022, Bereuter

\includegraphics[height=8mm]{images/fhnw.eps}}
\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% New title page
% % % prepend to lof,lot
% \setcounter{tocdepth}{1}% otherwise lof,lot result empty if depth is 0 for tableofcontents 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\frontmatter


\renewcommand*\contentsname{Inhaltsverzeichnis}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{1}
\tableofcontents
}

% https://tex.stackexchange.com/questions/291743/minitoc-of-wrong-chapter
%		


\mainmatter
\bookmarksetup{startatroot}

\chapter*{Inhalt}\label{inhalt}
\addcontentsline{toc}{chapter}{Inhalt}

\markboth{Inhalt}{Inhalt}

Internet of Things ermÃ¶glicht durch die Vernetzung physischer und
virtueller Objekte Infrastrukturen auszubauen die Echtzeit
Datenerfassung und Verarbeitung ermÃ¶glichen, was fÃ¼r die Geomatik und
GIS zunehmend an Bedeutung gewinnt. Vor allem in den Bereichen Smart
Cities oder Geomonitoring wird IoT eingesetzt um automatisiert
Sensordaten zu erfassen, diese zu analysieren und fÃ¼r
Entscheidungsprozesse zu nutzen. Dieser zunehmende Fokus spiegelt auch
den Bedarf an Geomatiker:innen, die sich in diese Themen vertiefen und
geeignete LÃ¶sungen entwickeln kÃ¶nnen.

In dieser EinfÃ¼hrung gibt einen Ãberblick Ã¼ber die Grundlagen von IoT
mit einem Fokus auf die Geomatik und Geoinformation und fÃ¼hrt
anwendungsbezogen mit praktischen Beispielen mit Raspberry Pi und
unterschiedlichen Sensoren in das Thema ein. Der Anhang bietet eine
EinfÃ¼hrung in Raspberry Pi mit den wichtigsten Befehlen und Anleitungen
fÃ¼r die Installation und Konfiguration. ZusÃ¤tzlich bietet er eine
praktische Anleitung fÃ¼r den Aufbau des vorkonfigurierten Image mit den
erforderlichen Installationen wie Python, Python Bibliotheken, MQTT,
Node-RED, InfluxDB und Grafana, deren Konfiguration und einfache
Funktionstests.

\section*{Aufbau}\label{aufbau}
\addcontentsline{toc}{section}{Aufbau}

\markright{Aufbau}

Das Skript fÃ¼hrt in Sensorik ein und zeigt typische Anwendungen zum
Thema IoT, des Weiteren zeigt es auf wie Sensordaten genutzt,
gespeichert, Ã¼bertragen und visualisiert werden kÃ¶nnen mittels
detaillierten Beispielen und Ãbungen.

Die begleitenden Ãbungen nutzen den Einplatinenrechner Raspberry Pi mit
unterschiedlichen Sensoren fÃ¼r die Datenerfassung, -analyse und
Visualisierung. Die Programmiersprache fÃ¼r diesen Kurs ist Python und
das genutzte Betriebssystem ist Raspberry Pi OS, eine fÃ¼r den Raspberry
Pi angepasste Distribution von Debian (Linux).

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{Lernziele:}

\begin{itemize}
\tightlist
\item
  Die Studierenden erfahren, wie IoT (Internet of Things) und
  Sensordaten in rÃ¤umlicher Analyse eingesetzt werden kÃ¶nnen.
\item
  Die Studierenden lernen, wie sie mit einem Einplatinenrechner
  Sensordaten erfassen, auswerten, kommunizieren und visualisieren
  kÃ¶nnen.
\end{itemize}

\end{boxtitle}

\section*{Kursvorbereitung}\label{kursvorbereitung}
\addcontentsline{toc}{section}{Kursvorbereitung}

\markright{Kursvorbereitung}

FÃ¼r den Kurs werden Raspberry Pi 4 mit dem Breakout Garden HAT und
passenden Sensoren zur VerfÃ¼gung gestellt. In den ComputerrÃ¤umen besteht
Zugang zu externen Bildschirmen, Tastatur und MÃ¤usen, mit denen die
Ãbungen mit dem Raspberry Pi durchgefÃ¼hrt werden kÃ¶nnen.

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_set.jpg}

}

\caption{Raspberry Pi Set: Raspberry Pi 4 mit Breakout Garden HAT und
Sensoren}

\end{figure}%

FÃ¼r den Fernzugriff auf den Raspberry Pi und entwickeln ist ein
SSH-Client (SSH Windows, Putty, Tabby), sowie eine entsprechende
Entwicklungsumgebung mit Python (Anaconda, Miniconda) und Visual Studio
Code empfohlen.

\begin{itemize}
\tightlist
\item
  SSH-Clients: \href{https://www.putty.org}{Putty},
  \href{https://tabby.sh/}{Tabby}
\item
  Python: \href{https://www.anaconda.com/download}{Anaconda},
  \href{https://docs.conda.io/projects/miniconda/en/latest/}{Miniconda},
  \href{https://www.python.org/}{Python}
\end{itemize}

\section*{Raspberry Pi Image
Kontoinformationen}\label{raspberry-pi-image-kontoinformationen}
\addcontentsline{toc}{section}{Raspberry Pi Image Kontoinformationen}

\markright{Raspberry Pi Image Kontoinformationen}

FÃ¼r die Ãbungen wird ein Raspberry Pi Image mit vorinstallierten Paketen
und Einstellungen verwendet. Die SD-Karte mit dem Image wird von der
Kursleitung zur VerfÃ¼gung gestellt. Das Image kann Ã¼ber Moodle bezogen
werden.

\begin{longtable}[]{@{}llll@{}}
\caption{Raspberry Pi Image Konto Einstellungen}\tabularnewline
\toprule\noalign{}
Konto & User & Passwort & Kommentar \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
Konto & User & Passwort & Kommentar \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Raspberry Pi & iot & \texttt{igeo@fhnw} & \\
influxdb & iot & \texttt{igeo@fhnw} & organisation: \texttt{fhnw} \\
grafana & admin & \texttt{igeo@fhnw} & \\
\end{longtable}

\section*{Ãbungsunterlagen}\label{uxfcbungsunterlagen}
\addcontentsline{toc}{section}{Ãbungsunterlagen}

\markright{Ãbungsunterlagen}

Die Ãbungsunterlagen werden auf dieser Kurswebseite EinfÃ¼hrung in IoT
zur VerfÃ¼gung gestellt und werden laufend aktualisiert.

\section*{Repository}\label{repository}
\addcontentsline{toc}{section}{Repository}

\markright{Repository}

Die Inhalte von ``EinfÃ¼hrung in IoT'' sind auf der
\href{https://314a.github.io/5200_IoT}{Kurswebseite} frei zugÃ¤nglich und
sind unter \href{https://creativecommons.org/licenses/by-nc/4.0/}{CC
BY-NC 4.0}'' lizenziert. Ideen, Ãnderungen und VorschlÃ¤ge sind
willkommen und kÃ¶nnen Ã¼ber das
\href{https://github.com/314a/5200_IoT}{GitHub Repository} eingebracht
werden. Die Kurswebseite wird mit \href{https://quarto.org/}{Quarto}
erstellt.

\part{Theorie}

\chapter{Internet of Things IoT}\label{internet-of-things-iot}

Das Internet der Dinge (IoT) bietet fÃ¼r die Geomatik und
Geoinformationswissenschaften zahlreiche Anwedungsgebiete, durch die
Automatisierung und Vernetzung von Sensoren in Echtzeit. Dies
ermÃ¶glichen effeziente und prÃ¤zise Ãberwachung von Prozessen und
Umgebung (Kontext) gerade im Bereich der Smart Cities oder
Geomonitoring. Beispielsweise bei Sanierungen BrÃ¼cken oder bei Neubauten
kÃ¶nnen Sensoren die Belastung und Verformung von Bauwerken Ã¼berwachen
und so frÃ¼hzeitig auf Probleme hinweisen. Vorteile wie Echtzeitdaten,
Automatisierung von Messprozessen, Genauigkeit und Repetition von
Messungen, Kosteneffizienz durch die Reduzierung von manuellen
Eingriffen und die Integration von mehreren Datenquellen unterstÃ¼tzen
die Entscheidungsfindung in Planung und DurchfÃ¼hrung von Projekten.
Dieses Kapitel gibt eine EinfÃ¼hrung in das Thema IoT und dessen
Bedeutung fÃ¼r die Geomatik und Geoinformationswissenschaften.

\section{Ubiquitous Computing}\label{ubiquitous-computing}

Aus dem Bestreben der 1980er Jahre, Technologie in den Hintergrund des
Alltags einzubetten, in dem entstehenden Forschungsgebiet
\emph{Ubiquitous Computing} definierte dies Weiser \emph{Ubiquitous
Computing} (\citeproc{ref-rogers2006}{Rogers, 2006}) als ``die physische
Welt, die reichhaltig und unsichtbar mit Sensoren, Aktoren, Anzeigen und
Computerelementen verwoben ist, die nahtlos in die alltÃ¤glichen Objekte
unseres Lebens eingebettet und durch ein kontinuierliches Netzwerk
verbunden ist'' mit dem Ziel im tÃ¤glichen Leben unterstÃ¼tzend zu sein
und nicht zu Ã¼berladen.

\begin{description}
\item[Ubiquitous Computing\index{Ubiquitous Computing}]
Vision der Informatik allgegenwÃ¤rtige Datenverarbeitung und Nutzung von
Systemen ohne Bedienungsanforderung und Hardwarebelastung fÃ¼r die
Nutzenden. UbiquitÃ¤re Systeme agieren quasi unsichtbar im Hintergrund
von Handlungsfelder (\citeproc{ref-wiegerling2013}{Wiegerling, 2013}).
\end{description}

Ethnographische Studien Ã¼ber den Alltag zeigen, dass der Kontext des
Alltags der Menschen viel subtiler, fliessender und eigenwilliger ist,
als das die Theorien Ã¼ber den Kontext glauben machen
(\citeproc{ref-salvador2003}{Salvador \& Anderson, 2003}). Dies
erschwert eine praktische Umsetzung und Vorhersage von BedÃ¼rfnissen auf
Basis von Kontextinformationen erheblich. ZusÃ¤tzlich stellen sich auch
ethische und soziale Fragen. Rogers (\citeproc{ref-rogers2006}{2006})
plÃ¤diert fÃ¼r einen proaktiven Ansatz weg von \emph{proactive Computing}
zu \emph{proactive people} und propagiert eine fachspezifische Nutzung
fÃ¼r bestimmte Bereiche wie beispielsweise Landwirtschaft oder
Umeltsanierung und weg von der Idee von \emph{pervasive Computing}. Zwei
Technologien sind kritisch fÃ¼r diese AnsÃ¤tze \emph{Cloud Computing} und
\emph{Internet of Things}.

\section{Internet of Things}\label{internet-of-things}

Es existiert keine einheitliche Definition fÃ¼r \emph{Internet of Things}
IoT oder das Internet der Dinge. Es ist eine Bezeichnung oder
Sammelbegriff fÃ¼r ein Netzwerk von physischen Objekten ``Things'', die
untereinander vernetzt sind, mit Sensoren, Software und
unterschiedlichen Technologien ausgestattet sind, und somit einen
direkten Datenaustausch ermÃ¶glichen. Dies reicht von Monitoringsystemen,
Ã¼ber Wildtierbeobachtungen, Smart City Anwendungen bis in die Haushalte
die mit IoT GerÃ¤ten ausgestattet sind.

Der Standardisierungsausschuss der International Telecommunication Union
(ITU) definiert IoT\index{IoT} als eine

\begin{quote}
.. a global~infrastructure~for the information society, enabling
advanced services by interconnecting~(physical and virtual)~Things based
on existing and evolving interoperable information and communication
technologies (\citeproc{ref-ITU2005}{ITU, 2005}).
\end{quote}

Ashton (\citeproc{ref-ashton2009}{2009}) beschrieb als frÃ¼her Ideengeber
zu Internets der Dinge im Kontext von Supply Chain Management folgendes:

\begin{quote}
.. Ideas and information are important, but things matter much more. Yet
today's information technology is so dependent on data originated by
people that our computers know more about ideas than things. If we had
computers that knew everything there was to know about things --- using
data they gathered without any help from us---we would be able to track
and count everything, and greatly reduce waste, loss and cost. We would
know when things needed replacing, repairing or recalling, and whether
they were fresh or past their best. We need to empower computers with
their own means of gathering information, so they can see, hear and
smell the world for themselves, in all its random glory. RFID and sensor
technology enable computers to observe, identify and understand the
world---without the limitations of human-entered data. {[}..{]} The
Internet of Things has the potential to change the world, just as the
Internet did. Maybe even more so.
\end{quote}

Die Kernidee von IoT ist, mit Computer Informationen, \emph{ohne}
menschliches zu tun zu erkennen. Wenn \emph{Dinge} eigenstÃ¤ndig Daten
sammeln, diese nach Art, Messung, Messzeit und Messort geordnet werden,
ermÃ¶glicht dies im Bereich der Geomatik spannende neue AnsÃ¤tze, Analysen
und Anwendungen. IoT ist ein multidisziplinÃ¤res Gebiet mit einem breiten
Spektrum an Technologien, Protokollen, Anwendungszenarien und
Disziplinen und bedingt Kenntnisse der elektronischen Komponenten,
Kommunikationsprotokollen, Echtzeitdatenanalysen, und der Lokalisierung
von Objekten und GerÃ¤ten (\citeproc{ref-granell2020}{Granell et al.,
2020}).

FÃ¼r das Konzept \emph{Ding} oder \emph{Thing} bestehen unterschiedliche
Definitionen. Charakteristisch ist, begrenzte Ressourcen (beispielsweise
geringe Rechenleistung), unzuverlÃ¤ssige Netwerkverbindung, geringe
Kosten fÃ¼r Hardware und DatenÃ¼bertragung, keine Stromversorgung dafÃ¼r
Batterienbetrieb und nicht im Office-Umfeld sondern im Feld. Aus
\textbf{Netzwerksicht} kann es als EntitÃ¤t mit der MÃ¶glichkeit sich mit
einem Netzwerk lokal oder dem Internet zu verbinden beschrieben werden.
Aus \textbf{\emph{ding-zentrierter} Sicht} sind die mit den Dingen
verbundenen Dienste zentral. Dienste, die Datenmengen, die von
intelligenten Objekten durch deren Interaktion mit der Umgebung erfasst
werden, verwalten.

\begin{figure}[H]

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{images/smartes_objekt.png}

}

\caption{Komponenten eines smarten Objekt ``Thing''
(\citeproc{ref-zaheeruddin2020}{Zaheeruddin \& Gupta, 2020})}

\end{figure}%

Das Internet entwickelt sich in ein Netzwerk,

\begin{itemize}
\tightlist
\item
  in welchem Objekte miteinander \textbf{verbunden} werden,
\item
  Informationen aus der Umwelt gesammelt werden (\textbf{Sensorik}),
\item
  mit der physischen Welt interagiert (\textbf{Steuerung}) werden und
\item
  bestehende \textbf{Standards} fÃ¼r Dienste fÃ¼r den Transfer, Analyse,
  Anwendung und Kommunikation genutzt werden.
\end{itemize}

Die drei wesentlichen technologischen IoT Komponenten sind folglich:

\begin{itemize}
\tightlist
\item
  Hardware mit Sensoren, Aktoren und integrierter
  Kommunikationstechnologie
\item
  Middleware bedarfsorientierte Speicher- und
  Datenverarbeitungswerkzeuge fÃ¼r die Datenanalyse
\item
  PrÃ¤sentation mit zugÃ¤nglichen und nutzerfreundlichen Visualisierungs-
  und Interpretationswerkzeuge Ã¼ber unterschiedliche Plattformen und
  Anwendungen
\end{itemize}

Betrachtet man die Dimensionen von IoT fÃ¼gt sich aus der Sicht der
Kommunikationstechnologie das \emph{thing} mit ein
(\citeproc{ref-ITU2005}{ITU, 2005}). Aus Sicht der Geoinformation, sind
diese drei Dimensionen sehr vertraut mit \emph{Zeit}, \emph{Ort} und
\emph{Objekt} dem \emph{thing}.

\begin{figure}[H]

{\centering \includegraphics[width=0.8\textwidth,height=\textheight]{images/iot_dimension.jpg}

}

\caption{Dimensionen der IoT, eine neue Dimension aus Sicht der
Kommunikationstechnologie}

\end{figure}%

IoT GerÃ¤te haben neben der wichtigsten Eigenschaft, dass sie mit dem
Netzwerk/Internet kommunizieren kÃ¶nnen, folgende typischen
Eigenschaften. Sie sind oft \textbf{funkbasiert} und oft
\textbf{batteriebetrieben}. Sie lassen sich daher einfach installieren,
jedoch muss im Betrieb dem Batteriebetrieb der Verbrauch berÃ¼cksichtigt
werden und nach Anforderung (Laufzeit vs hÃ¤ufige Updates) priorisiert
werden\footnote{Der Raspberry Pi ist insofern mit dem
  verhÃ¤ltnissmÃ¤ssigen hohen Stromverbrauch kein typisches IoT Device}.

\section{Digital Earth und IoT}\label{digital-earth-und-iot}

Der VizeprÃ¤sident der USA AL Gore fÃ¼hrte 1998 in seiner Rede das Konzept
der digitalen Erde ein mit der Vision die realer Erde mit einer
virtuellen Nachbildung zu erweitern, einem virtuellen Zwilling
(\citeproc{ref-gore1998}{Gore, 1998}).

\begin{quote}
I believe we need a ``Digital Earth''. A multi-resolution,
three-dimensional representation of the planet into which we can embed
vast quantities of geo-referenced data. Gore
(\citeproc{ref-gore1998}{1998})
\end{quote}

Die Umsetzung der Vision ``Digital Earth''\index{Digital Earth}
erfordert wie auch die IoT eine entsprechende Infrastruktur, die das
Auffinden, den Zugriff, die Analyse und die Verarbeitung von
raumbezogenen Daten ermÃ¶glicht. Granell et al.
(\citeproc{ref-granell2020}{2020}) fordern eine permanente und
verstÃ¤rkte Zusammenarbeit beider Bereiche. Betrachtet man die Rolle der
Netzwerke und Interaktion in beiden Bereichen, kann ein Worklow von (1)
der Auffindbarkeit, Erfassung und Kommunikation rÃ¤umlicher
Informationen, zu (2) VerstÃ¤ndnis rÃ¤umlicher Objekte und ihrer
Beziehungen, dann (3) Bestimmung des raum-zeitlichen Verhaltens und der
Simulationsregeln und dem (4) Handeln und Ergreifen fundierter MaÃnahmen
gezeichnet werden. Bei (1) kann IoT mit neuen Quellen und hÃ¶heren
Aufnahme- und Ãbertragungsfrequenzen den Workflow anreichern und (2)
erfordert eine kontinuierliche vertiefte Zusammenarbeit beider
Infrastrukturen. Im Bereich IoT werden rÃ¤umlichen Analysen wird aufgrund
der aufkommenden Edge-Fog-Cloud Paradigmen zunehmen.

\begin{figure}[H]

{\centering \includegraphics[width=0.5\textwidth,height=\textheight]{images/digital_earth_iot.png}

}

\caption{IoT und Digital Earth Workflow Granell et al.
(\citeproc{ref-granell2020}{2020})}

\end{figure}%

\textbf{Die Auffindbarkeit, Erfassung und Kommunikation} rÃ¤umlicher
Informationen erfordert das GerÃ¤te und ihre Daten auffindbar und
zugÃ¤nglich sind mit standardisierten Methoden in globalen
zentralisierten Sammlungen, oder Ã¼ber dezentralen oder hierarchischen
AnsÃ¤tzen. Viele dieser Dienste erfordern Fachkenntnisse und einfache
ZugÃ¤nge zu IoT Daten fehlen. Der OGC Standard Sensor Web Enablement SWE
standardisiert die Erkennung und der Zugriff auf Sensoren. Bei der
rÃ¤umlichen Datenerfassung in IoT haben Sensor-Metadaten eine hohe
Bedeutung, wobei der SensorML-Standard einer der wichtigsten ist
(\citeproc{ref-granell2020}{Granell et al., 2020}).

\begin{description}
\tightlist
\item[Sensor Model Language SensorML-Standard\index{SensorML-Standard}]
Der OGC \href{https://www.ogc.org/standard/sensorml}{SensorML-Standard}
beschreibt umfassend Sensor-Metadaten und bietet eine Schnittstelle, die
das Auffinden von Sensoren und Beobachtungen folglich das Erstellen von
Suchindizes erleichtert. Elemente sind Betreiber, Dienste, Standort,
beobachtetes PhÃ¤nomen und der zeitliche Verlauf.
\item[Sensor Web Enablement SWE standards
suite\index{Sensor Web Enablement SWE standards}]
Der OGC \href{https://www.ogc.org/standard/swes}{SWE Standard}
ermÃ¶glicht die Erkennung und den Zugriff auf Sensoren und zugehÃ¶rige
Beobachtungsdaten Ã¼ber Standardprotokolle und
Anwendungsprogrammierschnittstellen. Anwendung in der Erdbeobachtung,
beispielsweise fÃ¼r das Katastrophenmanagement wie BrÃ¤nde,
Ãberschwemmungen oder VulkanausbrÃ¼che. Wobei die UnterstÃ¼tzung der
Semantik eine SchwÃ¤che des Standards ist, \emph{Semantic Sensor Network
SSN} und Weiterentwicklungen wie \emph{Internet of Things Ontology
IoT-O} oder die \emph{Sensor, Observation, Sample, and Actuator (SOSA)
Ontology}, eine Zusammenarbeit zwischen W3C und OGC, nutzen Ontologien
um die Semantik in IoT besser abzubilden.
\end{description}

SWE umfasst zwei Suchtypen das Auffinden einzelner Sensorinstanzen und
Sensordienste, wobei ersteres sich auf einzelne GerÃ¤te oder
Sensornetzwerke bezieht und das Zweite die Dienste, die mit dem Sensor
interagieren. Die Suche kann grob in drei Gruppen unterteilt werden:

\begin{itemize}
\tightlist
\item
  \emph{thematisch}: Art der PhÃ¤nomene, die ein Sensor beobachtet, z. B.
  Temperatur, WindstÃ¤rke oder Luftdruck
\item
  \emph{rÃ¤umlich}: Ort, an dem der Sensor eingesetzt wird
\item
  \emph{zeitlich}: Zeitraum, in dem die Beobachtungen gemacht werden
\end{itemize}

Weiterentwicklungen im Bereich der Kommunikation zwischen \emph{things}
GerÃ¤ten brachte neue Schnittstellen und Ã¼ber die Zeit geringere Kosten
und Stromverbrauch der Kommunikationsschnittstellen wie \emph{Bluetooth,
Wi-Fi, ZigBee, 3G-5G} oder \emph{LORA}. WÃ¤hrend frÃ¼her einfache
Datenlogger nur Daten senden konnten verfÃ¼gen die GerÃ¤te heute Ã¼ber die
MÃ¶glichkeit Daten zu Senden und zu empfangen. Dies erlaubt die Steuerung
und Anpassung des Verhaltens der GerÃ¤te. Kommunikationsprotokolle die
auf Maschinenkommunikation ausgerichtet sind \emph{machine-to-machine
M2M} wurden entwickelt, wie das \emph{Advanced Message Queuing
Protokoll} (AMQP), \emph{MQTT} oder das \emph{streamingorientierte
Protokoll STOMP}. Folgende Ãbersicht zeigt unterschiedliche
Eigenschaften von Industriestandards fÃ¼r IoT Ã¼ber die
Ãbertragungsdistanz, Art der InformationsÃ¼bertragung und typische
Anwendungsbereiche.

\begin{figure}[H]

{\centering \includegraphics{images/iot_standards_range.png}

}

\caption{IoT Standards, Eigenschaften, Ãbertragungsdistanzen und
Anwendungen (\citeproc{ref-links2019}{Links, 2019})}

\end{figure}%

\section{IoT und GIS}\label{iot-und-gis}

\emph{Smarte} GerÃ¤te der erzeugen grosse DatenstrÃ¶me mit zeitlichen und
rÃ¤umlichen Merkmalen, fÃ¼r deren Analyse die Entfernung, FlÃ¤che, Volumen
oder Trajektorien entscheidend fÃ¼r die Datenanalyse von IoT GerÃ¤ten
sind. Die Vielfalt der GerÃ¤te bringt neue analytische Herausforderungen
mit sich, die in der Lage sein mÃ¼ssen rÃ¤umlich-zeitliche Echtzeitdaten
mit sehr heterogenen \emph{smarten} GerÃ¤ten verarbeiten zu kÃ¶nnen
(\citeproc{ref-trilles2017}{Trilles et al., 2017}). WÃ¤hrend Werkzeuge
fÃ¼r die Analyse von Echtzeitdaten existieren, stellt die rÃ¤umliche
Komponente eine Herausforderung dar. Der Raum, wie der Standort, die
Ausrichtung, Form und GrÃ¶sse spielen eine wesentliche Rolle in IoT, da
alle GerÃ¤te rÃ¤umliche Eigenschaften aufweisen und miteinander rÃ¤umlich
zu einander in Beziehung stehen (beispielsweise der Standort, die GrÃ¶sse
und Orientierung von einem Auto und einem Fahrrad auf der gleichen
Fahrbahn) (\citeproc{ref-granell2020}{Granell et al., 2020}). Erst Ã¼ber
den Raum kÃ¶nnen Sensoren in Beziehung zu einander gebracht werden.

AnsÃ¤tze zur rÃ¤umlichen-zeitlichen Datenanalyse in Echtzeit haben noch
keine standardisierten Prozeduren, die einfach und breit angewandt
werden kÃ¶nnen (\citeproc{ref-granell2020}{Granell et al., 2020}).
ZusÃ¤tzlich sollten Standards Echtzeitanalysen ermÃ¶glichen ohne grossen
zusÃ¤tzlichen Rechenaufwand fÃ¼r GerÃ¤te, die eine beschrÃ¤nkte
\emph{SpeicherkapazitÃ¤t} und \emph{KonnektivitÃ¤t} haben und oft mit
Batterie betrieben sind. Der OGC Sensor Observation Service SOS bedingt
eine eher rechenintensive Verarbeitung von XML-Dokumenten und weitere
AnsÃ¤tze sind in Erarbeitung, die dem Rechnung tragen.

Kamilaris \& Ostermann (\citeproc{ref-kamilaris2018}{2018}) klassieren
und geben eine Ãbersicht von IoT Anwendungen\index{IoT Anwendungen} und
Forschungsprojekte im Kontext der GIScience und IoT. Die Anwendungsbiete
sind vielfÃ¤ltig, wie in folgender Abbildung illustriert. In fast allen
aufgefÃ¼hrten Anwendungsgebieten sind Aussagen zum Standort relevant.

\begin{figure}[H]

{\centering \includegraphics[width=0.5\textwidth,height=\textheight]{images/iot_ecosystem_mobile.png}

}

\caption{Ãkosystem der Anwendungen in mobile Computing im Zusammenspiel
mit Sensoren von IoT GerÃ¤ten.}

\end{figure}%

Sie fÃ¼hren fÃ¼r die verschiedenen Anwendungsgebiete die benutzten
Methodenklassen der rÃ¤umlichen Analyse\index{RÃ¤umliche Analysemethoden}.

Wobei sie die Analysemethoden wie folgt gruppieren:

\begin{itemize}
\tightlist
\item
  \textbf{Geometric Measures}: distances and proximity of points,
  adjacency and connectivity
\item
  \textbf{Data Mining}: discovering patterns from large datasets
\item
  \textbf{Basic Analytical Operations}: methods such as buffering and
  overlay
\item
  \textbf{Basic Analytical Methods}: spatial analysis of point patterns
  and clusters, kernels and density analysis
\item
  \textbf{Network Analysis}: graph measures, least-cost shortest path
  problems and flow modeling
\item
  \textbf{Surface Analysis \& Geostatistics}: Analysis of surfaces and
  geostatistics deal with interpolation of surfaces and kriging.
\end{itemize}

Sie klassieren die Anwendungsgebiete und die rÃ¤umlichen Analysemethoden
in folgender Tabelle.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1795}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1154}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.0705}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1731}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1538}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.1026}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 12\tabcolsep) * \real{0.2051}}@{}}
\caption{IoT Forschungsgebiet und rÃ¤umliche Analysemethoden
(\citeproc{ref-kamilaris2018}{Kamilaris \& Ostermann,
2018}).}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
IoT Area
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Geometric Measures
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Data Mining
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Basic Analytical Operations
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Basic Analytical Methods
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Network Analysis
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Surface Analysis \& Geostatistics
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
IoT Area
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Geometric Measures
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Data Mining
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Basic Analytical Operations
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Basic Analytical Methods
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Network Analysis
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Surface Analysis \& Geostatistics
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Tourism & X & X & - & X & - & - \\
Utility Network & X & X & - & - & X & - \\
Disaster Monitoring & X & - & X & - & - & X \\
Health and disease detection & X & X & - & X & - & X \\
Transportation & X & X & - & X & X & - \\
Logistics and assets & - & X & - & - & X & - \\
Wildlife monitoring & - & X & - & X & X & X \\
Agriculture & X & - & - & X & X & X \\
Crime prediction & - & - & - & X & - & - \\
Sports and gaming & X & - & - & X & - & - \\
Environment & - & - & X & X & X & X \\
\end{longtable}

In einer zweiten tabellarischen Zusammenfassung fÃ¼hren sie IoT basierte
Methoden mit Beispielen von Generalisierung von Punktmessungen auf,
welche Aussagen in grÃ¶sseren MassstÃ¤ben ermÃ¶glichen. Diese sind nach
einzelnen IoT Methoden klassiert, wobei die ersten vier Methoden gerade
fÃ¼r Generalisierung\index{Generalisierung von Messdaten} am beliebtesten
sind.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.2762}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.7238}}@{}}
\caption{IoT Methoden fÃ¼r die Generalisierung von Analysen
(\citeproc{ref-kamilaris2018}{Kamilaris \& Ostermann,
2018}).}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
IoT-Based Method
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Examples of Generalizations
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
IoT-Based Method
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Examples of Generalizations
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Participatory sensing & Detecting emergency events at city scale
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B23-ijgi-07-00269}{1}{]},
promoting neighborhood identity and local services
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B24-ijgi-07-00269}{2}{]},
creating a noise map of a city
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B25-ijgi-07-00269}{3}{]},
detecting outbreaks of dengue fever
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B48-ijgi-07-00269}{4}{]},
developing heat maps from cyclists used for better city planning
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B45-ijgi-07-00269}{5}{]},
producing a global spatial distribution of malaria risk
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B65-ijgi-07-00269}{6}{]}. \\
Vehicular networks and transportation systems & Proactively performing
urban traffic monitoring
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B54-ijgi-07-00269}{7}{]},
travel planning based on real-time traffic information
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B12-ijgi-07-00269}{8}{]}. \\
Fixed IoT sensors & Urban decision-making assistance
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B13-ijgi-07-00269}{9}{]},
wildlife monitoring and understanding of herd behavior
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B60-ijgi-07-00269}{10}{]},
monitoring the area levels of air pollution
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B46-ijgi-07-00269}{11}{]},
creating air temperature and precipitation maps
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B70-ijgi-07-00269}{12}{]},
understanding fish-school characteristics around artificial reefs
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B67-ijgi-07-00269}{13}{]},
estimating the level variations of the sand layer of sandy beaches or
dunes
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B66-ijgi-07-00269}{14}{]}. \\
Satellite imagery & Understanding how invasive species respond to
landscape configuration relative to native species
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B49-ijgi-07-00269}{15}{]},
assessing how the livestock agriculture affects the physical environment
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B35-ijgi-07-00269}{16},\href{https://www.mdpi.com/2220-9964/7/7/269\#B50-ijgi-07-00269}{17}{]},
modeling forest fire risk zones
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B33-ijgi-07-00269}{18}{]},
earthquake risk assessment
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B34-ijgi-07-00269}{19}{]},
planning of tsunami evacuation
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B36-ijgi-07-00269}{20}{]},
creating digital maps with information about bacteria habitats
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B47-ijgi-07-00269}{21}{]},
delineating groundwater potential zones in hard rock terrain
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B39-ijgi-07-00269}{22}{]}. \\
Ground sensor sampling & Estimating the Grand Canyon height map
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B63-ijgi-07-00269}{23}{]},
generating high-risk floodplain maps
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B63-ijgi-07-00269}{24}{]},
creating soil fertility maps
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B72-ijgi-07-00269}{25}{]},
assessing the spatial variation of groundwater quality and producing
salinity hazard maps
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B69-ijgi-07-00269}{26}{]},
assessing the heavy metal pollution in soils
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B71-ijgi-07-00269}{27}{]},
estimating the zinc contamination concentrations around a lake
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B68-ijgi-07-00269}{28}{]}. \\
Web-based IoT datasets & Estimating traffic from historical traffic
flows
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B42-ijgi-07-00269}{29}{]},
optimizing routes of public transportation based on taxi rides
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B43-ijgi-07-00269}{30}{]},
exploring and analyzing attractive areas
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B38-ijgi-07-00269}{31}{]},
associating assault rates to measures of population and place
characteristics
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B41-ijgi-07-00269}{32}{]}. \\
Combination of IoT methods & Assessing damage in Haiti by earthquake and
facilitating emergency response
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B61-ijgi-07-00269}{33}{]},
infrastructure asset management
{[}\href{https://www.mdpi.com/2220-9964/7/7/269\#B58-ijgi-07-00269}{34}{]}. \\
\end{longtable}

\chapter{Sensoren}\label{sensoren}

\section{Sensoren in IoT}\label{sensoren-in-iot}

Einer der grossen Treiber von IoT ist die zuhnemende VerfÃ¼gbarkeit von
low-cost Sensoren fÃ¼r viele unterschiedliche Anwendungen. Standard
Sensoren sind beispielweise Umweltsensoren wie Temperatur,
Luftfeuchtigkeit, Luftdruck, Bewegungssensoren mit Beschleunigung, und
Magnetfeld, Neigung, Standort Sensoren wie GPS oder Kamera Licht,
Schall, Gas, FlÃ¼ssigkeit, wie auch Gesundheitssensoren wie
HerzfrequenzvariabilitÃ¤t sowie GSR (galvanische Hautreaktion oder
HautleitfÃ¤higkeit). Sensoren sind in der Regel mit einem Mikrocontroller
verbunden, der die Messwerte verarbeitet und an einen Computer oder ein
anderes GerÃ¤t Ã¼bertrÃ¤gt.

Der Trend geht hin zu Miniaturisierung und Multi-Sensor-GerÃ¤ten mit dem
Vorteil, dass Ã¼ber mehrere Sensoren zeitgleich(!) Messungen durchgefÃ¼hrt
werden kÃ¶nnen und so aus der Kombination von Messwerten Ã¼ber
Sensordatenfusion (sensor fusion)\index{Sensor Fusion} neue Erkenntnisse
gewonnen werden kÃ¶nnen, beispielsweise die Kombination von GPS und
Beschleunigungssensor fÃ¼r die Bestimmung der Position und der
Geschwindigkeit (Dead Reckoning, Kalman Filter).

Sensoren kÃ¶nnen in mehrere Kategorien gruppiert werden:
UmweltÃ¼berwachung (natÃ¼rliche und anthropogene), Biophysikalische
Sensoren und GesundheitsÃ¼berwachung, GebÃ¤ude- und Heimautomatisierung,
Automobil- und Transportanwendungen, Mobile Computing und tragbare
Elektronik etc.

Viele Sensoren sind in Smartphones integriert, wie z.B.
Beschleunigungssensoren, Gyroskope, Magnetometer, GPS, Lichtsensoren,
NÃ¤herungssensoren, Barometer, Temperatursensoren, Feuchtigkeitssensoren,
Mikrofone, Kameras, etc. Ihr Einsatz ist vielfÃ¤ltig, von der
Unterhaltung Ã¼ber die Navigation bis hin zur GesundheitsÃ¼berwachung. Mit
der Applikation \emph{\href{https://phyphox.org}{phyphox}\index{phyphox}
- physical phone experiments} einer digitalien Experimentierbox,
entwickelt von der RWTH Aachen University, kÃ¶nnen die Sensoren von
Smartphones fÃ¼r physikalische Experimente genutzt werden.

\begin{figure}[H]

{\centering \includegraphics{images/phyphox.png}

}

\caption{phyphox Anwendung fÃ¼r physikalische Experimente mit Sensoren in
Mobiletelefonen, Screenshot der Anwendung mit dem Menu und einzelnen
Experimenten am Beispiel von Magnetfeld, Licht und Beschleunigung.}

\end{figure}%

\begin{boxtitle}{Ãbung}{colPrimary}

\textbf{Sensorentest mit \emph{phyphox}}\\
Installiere auf deinem Smartphone die Applikation
\emph{\href{https://phyphox.org}{phyphox}} und teste die Sensoren deines
Smartphones, wie die Beschleunigung, Orientierung (Magnetfeld), Standort
oder Licht. FÃ¼hre ein Experiment durch und dokumentiere deine
Beobachtungen. Nutze die Anwendung fÃ¼r Vergleiche mit anderen Sensoren
wÃ¤hrend der Ãbungen.

\end{boxtitle}

\section{Sensoren}\label{sensoren-1}

Sensoren\index{Sensoren} sind technische Bauteile, die bestimmte
physikalische oder chemische Eigenschaften messen oder eine
Beschaffenheit der Umgebung qualitativ oder quantitativ erfasst.
Sensoren kÃ¶nnen unterschiedlich klassiert werden, nach der Art der
Erzeugung von Energie in passive und aktive Sensoren, nach dem
Messprinzip oder dem Verwendungszweck.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.2105}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.7895}}@{}}
\caption{Wirkprinzip von Sensoren Quelle:
\href{https://de.wikipedia.org/wiki/Sensor}{wikipedia}}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Wirkprinzip
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Beispiel
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Wirkprinzip
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Beispiel
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Mechanisch & Manometer, Dehnungshebel, Federwaage, Hebelwaage,
Thermometer \\
Thermoelektrisch & Thermoelement \\
Resistiv & Dehnungsmessungsstreifen, Hitzdraht, Halbleiter-DMS, Pt100 \\
Piezoelektrisch & Beschleunigungssensor \\
Kapazitiv & Drucksensor, Regensensor, Luftfeuchtesensor \\
Induktiv & Neigungssensor, Kraftsensor, Wegaufnehmer \\
Optisch & CCD-Sensor, Fotozelle \\
Akustisch & FÃ¼llstandssensor, Doppelbogenkontrolle,
Ultraschall-Durchflussmesser \\
Magnetisch & Hall-Sensoren, Reed-Kontakt \\
\end{longtable}

Die Wahl von Sensoren fÃ¼r IoT Projekte hÃ¤ngt von der Anwendung ab und
der dahinterstehenden Fragestellung. Die Fragestellung fÃ¼hrt zur
Bestimmung was gemessen wird und wie das was gemessen werden soll
operationalisiert wird. Die Operationalisierung definiert die
MessgrÃ¶ssen und der Wahl von einem oder mehreren Sensoren (Sensor
Fusion) in einem IoT Projekt. Bei der Wahl sind mehrere Faktoren zu
berÃ¼cksichtigen, wie beispielsweise:

\begin{itemize}
\tightlist
\item
  Welche MessgrÃ¶sse soll gemessen werden? Welche Genauigkeit ist
  erforderlich? Welche EinschrÃ¤nkungen gibt es?
\item
  Existiert ein Datenblatt mit den technischen Spezifikationen?\\
\item
  Wie wird der Sensor angeschlossen? Wie wird der Sensor angesteuert?\\
\item
  Gibt es eine EinschrÃ¤nkung bezÃ¼glich der Temperatur und anderen
  Faktoren wie Feuchtigkeit?
\item
  Wie genau ist die Messung und welche Messabweichungen gibt es?
\item
  Existiert es eine Library, welche die Ansteuerung des Sensors
  vereinfacht? Gibt es einfache Beispiele, welche die Ansteuerung des
  Sensors zeigen? etc.
\end{itemize}

FÃ¼r die Auswahl von Sensoren sind unter anderem folgende Aspekte zu
beachten:

\begin{itemize}
\tightlist
\item
  Anwendung (z.B. UmweltÃ¼berwachung, GesundheitsÃ¼berwachung, GebÃ¤ude-
  und Heimautomatisierung, Automobil- und Transportanwendungen, Mobile
  Computing und tragbare Elektronik)
\item
  MessgrÃ¶sse (z.B. Temperatur, Luftfeuchtigkeit, Luftdruck, Bewegung,
  Standort, Licht, Schall, Gas etc.) und Kombination von MessgrÃ¶ssen
  (Sensor Fusion)
\item
  Messprinzip (z.B. mechanisch, thermoelektrisch, resistiv,
  piezoelektrisch, kapazitiv, induktiv, optisch, akustisch, magnetisch)
\item
  EinschrÃ¤nkungen (z.B. Temperatur, Abschirmung)
\item
  Messgenauigkeit (z.B. AuflÃ¶sung, Messbereich)
\item
  Bibliotheken (z.B. Programmiersprache, Dokumentation, Community,
  Beispiele, AktualitÃ¤t)
\item
  Montage (Schnittstelle, LÃ¶ten, HAT)
\item
  Datenschnittstelle (I2C, UART)
\item
  Platzbedarf
\item
  Stromversorgung (z.B. Batterie, Solarzelle, USB)
\item
  Kosten
\item
  VerfÃ¼gbarkeit (z.B. Lagerbestand, Lieferzeit)
\item
  etc.
\end{itemize}

FÃ¼r Prototypenentwicklung kÃ¶nnen Ã¼ber verschiedene Hersteller und
Distributoren Sensoren bezogen werden. Die folgende Liste gibt eine
Ãbersicht Ã¼ber einige Hersteller und Distributoren von Sensoren.

\begin{itemize}
\tightlist
\item
  \href{https://www.pi-shop.ch}{Pi-Shop} ist ein Schweizer Online
  HÃ¤ndler fÃ¼r Raspberry Pi und ZubehÃ¶r.
\item
  \href{https://www.distrelec.ch}{Distrilec} ist ein Distributor fÃ¼r
  elektronische Bauteile in der Schweiz und Europa.
\item
  \href{https://www.adafruit.com}{Adafruit Industries} (2005, New York,
  USA) ist ein Hersteller von Elektronik fÃ¼r Maker gegrÃ¼ndet von der
  MIT-Ingenieurin Limor ``Ladyada'' Fried.
\item
  \href{https://www.sparkfun.com}{Sparkfun Electronics} (2003, Colorado,
  USA) ist Open Source Elektronik Hersteller und produziert und verkauft
  Mikrocontroller-Plattformen, Sensoren und andere
  Elektronik-Komponenten.
\item
  \href{https://www.seeedstudio.com}{Seeed Technology} (2008, Shenzhen,
  China) ist eine IoT-Innovationsplattform das sich auf
  Hardware-Forschung, -Produktion und -Vertrieb fÃ¼r Edge-Computing,
  Netzwerkkommunikation und Smart-Sensing-Anwendungen spezialisiert hat
  und viele Produkte fÃ¼r Maker anbietet.
\item
  \href{https://shop.pimoroni.com}{Pimoroni} 2012 ist ein Reseller von
  Raspberry Pi, Adafruit, Micro:bit, Arduino, Sparkfun, etc. Produkten
  und stellt auch eigene Elektronikprodukte und Kits her\footnote{Trivia:
    Pimoroni steht fÃ¼r Pirate, Monkey, Robot, Ninja.}.
\end{itemize}

\begin{boxtitle}{Ãbung}{colPrimary}

\textbf{Sensoren}\\
Suche Dir auf den aufgelisteten Websites fÃ¼r elektronische Bauteile und
Kits, wie dem Raspberry Pi, welche Art von Sensoren existieren.

Suche drei bis vier interessante Sensoren aus und Ã¼berlege anhand der
aufgefÃ¼hrten Aspekte zur Sensorauswahl, was alles benÃ¶tigt wird um diese
zu betreiben und was die EinschrÃ¤nkungen sind.

\end{boxtitle}

\chapter{DatenÃ¼bertragung}\label{datenuxfcbertragung}

Drahtlose Kommunikationstechnologien basieren heutzutage auf IEEE
802.15.4 sowie IEEE 802.15.4e Ãbertragungsprotokoll
(\citeproc{ref-celebi2020}{Celebi et al., 2020}). Das Protokoll
beschreibt den die untersten beiden Schichten des OSI Modells
(Abb.~\ref{fig-osimodell}), die BitÃ¼bertragung und den MAC-Layer fÃ¼r
Wireless Personal Area Networks (WPAN).

Einige der relevanten Technologien fÃ¼r die DatenÃ¼bertragung sind, Wi-Fi,
Bluetooth, ZigBee, LoRa, RFID, SigFox und Mobilfunk. Die Technologien
unterscheiden sich in der Reichweite, der Datenrate, der
Energieeffizienz und der Anzahl der GerÃ¤te, die angeschlossen werden
kÃ¶nnen. Die Wahl der Technologie hÃ¤ngt von der Anwendung ab. FÃ¼r die
Ãbertragung von Sensordaten Ã¼ber kurze Distanzen eignet sich Bluetooth,
ZigBee oder WiFi. FÃ¼r die Ãbertragung von Sensordaten Ã¼ber lange
Distanzen eignet sich LoRa oder Mobilfunk. FÃ¼r die Ãbertragung von
Sensordaten Ã¼ber kurze Distanzen mit hoher Datenrate eignet sich Wi-Fi.
FÃ¼r die Ãbertragung von Sensordaten Ã¼ber kurze Distanzen mit geringer
Datenrate eignet sich RFID.

Je nach Anwendungsfall (Use Case) sind die Werte fÃ¼r die Latenzzeit
(Latency), VerlÃ¤sslichkeit (Reliability), GrÃ¶Ãe der Datenmenge (Data
size), Reichweite (Range) fÃ¼r die Wahl der Kommunikationstechnologie
relevant.

\begin{figure}

\centering{

\includegraphics[width=0.6\textwidth,height=\textheight]{images/osi-modell.png}

}

\caption{\label{fig-osimodell}Das ISO OSI Schichtenmodell mit einer
Auswahl von Protokollen fÃ¼r die jeweilige Schicht. Das MQTT Protokoll
ist in der Schichten der Darstellungs- und Anwendungsschicht angesiedelt
und nutzt TCP/IP fÃ¼r die DatenÃ¼bertragung Ã¼ber die IP Adressen der IoT
GerÃ¤te.}

\end{figure}%

\begin{description}
\tightlist
\item[ISO OSI Schichtenmodell\index{ISO/OSI Schichtenmodell}]
Das ISO OSI Schichtenmodell (Open Systems Interconnection Model) ist ein
konzeptuelles Referenzmodell welches die Funktionsweise von
Netzwerksystemen beschreibt mit dem Ziel Kommunikation Ã¼ber die
unterschiedlichen Technologien hinweg zu beschreiben von der Ãbertragung
von einzelnen Bits Ã¼ber den Datentransport bis hin zur Anwendung
beispielsweise HTTPS oder FTP (\citeproc{ref-iso1994}{ISO, 1994}). Das
ISO/OSI Schichtenmodell besteht aus sieben hierarchisch aufgebauten
Schichten und jeder einzelnen Schicht ist eine Aufgabe zugeordnet, wobei
das Ãbertragungsmedium nicht definiert ist. Die Schichten eins bis vier
sind transportorientierte Schichten und die Schichten fÃ¼nf bis sieben
sind anwendungsorientierte Schichten.
\item[Long Range Wide Area Network (LoRaWAN) oder LoRa\index{LoRaWAN}]
LoRaWan, Long Range Wide Area Network ermÃ¶glicht ein energieeffizientes
Ã¼bertragen von kleinen Datenmengen Ã¼ber grosse Distanzen (bis 10km).
\end{description}

\section{Kommunikation}\label{kommunikation}

Zwei Kommunikationsparadigmen kommen in IoT Systemen zum Einsatz,
\emph{Publish-Subscribe} und \emph{Request-Response}. Je nach Szenario
und Anwendungsfall kommt der eine oder andere Ansatz zum Einsatz. In der
\emph{Publish-Subscribe} Kommunikation sind zwei EntitÃ¤ten involviert,
der Publisher, der die Daten publiziert und der Subscriber, der die
Daten konsumiert, eine \emph{one-to-many Kommunication}. Dies ist gerade
in IoT Systemen von Vorteil, wo mehrere GerÃ¤te die Daten von einem GerÃ¤t
konsumieren kÃ¶nnen ohne, dass zu jedem einzelnen GerÃ¤t eine Verbindung
aufgebaut werden muss. Eine one-to-one Kommunikation ist hingehen eine
\emph{Request-Response} Kommunikation, in der Daten zwischen zwei
EntitÃ¤ten ausgetauscht werden, wobei hier der EmpfÃ¤nger (Adresse) der
Nachricht oder der Daten bekannt sein muss. In der
\emph{Request-Response} Kommunikation ist der Server zentraler
Bestandteil der Kommunikation, wohingegen in der
\emph{Publish-Subscribe} Kommunikation der Broker zentraler Bestandteil
der Kommunikation ist (\citeproc{ref-hirmer2023}{Hirmer, 2023}). Bei
\emph{Publish-Subscribe} muss der Broker bekannt sein wohingegen die
IndentitÃ¤t der Publisher und Subscriber nicht erforderlich ist.

\begin{figure}[H]

{\centering \includegraphics{images/publish-subcribe_request-response.png}

}

\caption{Kommunikationsparadigmen in der IoT Request-Response versus
Publish-Subscribe}

\end{figure}%

Die zentrale Komponente beim Publish-Subscribe Modells ist der Message
Broker, der fÃ¼r das Empfangen, Zwischenspeichern und die Vermittlung der
Nachrichten zu den Subscriber verantwortlich ist. Die Nachrichten oder
Datenpakete werden Topics (Themen) zugeordnert die hierarchisch
strukturiert sind. So kÃ¶nnen Subscriber gewisse Topics oder Untertopics
subscriben, wie beispielweise den Temperaturdaten einer Wetterstation
mit \emph{stationA/temperature}.

Message Broker kÃ¶nnen \emph{Quality of Service} parameter definieren,
die die ZuverlÃ¤ssigkeit der NachrichtenÃ¼bertragung definieren, ob
beispielsweise die Nachricht genau oder mindestens einmal zugestellt
werden soll. Dies geht jedoch zu Lasten der Performance, was gerade bei
Echtzeitkommunikation relevant ist. Einer der wesentlichen Vorteile des
Publish-Subscribe Modells ist, dass Publisher und Subscriber nicht
gleichzeitig online sein mÃ¼ssen, da der Broker die Nachrichten
zwischenspeichert und diese bei der nÃ¤chsten Verbindung zustellt. Dies
ist ermÃ¶glicht eine asynchrone Kommunikation in Echtzeit, eine wichtige
Anforderung von IoT. Dies ist vorallem bei batteriebetriebenen GerÃ¤ten
sinnvoll, die energiefizient arbeiten und folglich nicht kontinuierlich
online sind. Eines der verbreitesten Protokolle, die
\emph{Publish-Subscribe} umsetzen ist MQTT. In \textbf{GeoMQTT} kann
eine Nachricht mit einem Zeitstempel oder Interval und einer Geometrie
zusÃ¤tzlich dem Topic name hinzugefÃ¼gt werden. Dies ermÃ¶glicht dem
Subscriber zeitliche oder rÃ¤umliche Filter zusÃ¤tzlich zu den
thematischen \emph{Topic} Filter zu nutzen HerlÃ© et al.
(\citeproc{ref-herle2019}{2019}). Ein umfangreicherer offener Standard
ist AMQP, seit 2010, der auch \emph{request-response} Kommunikation
ermÃ¶glicht\footnote{Diese Protokolle sind nach dem Entwurfsmuster
  (Design Pattern) Beobachter (Observer) implementiert}.

Eine weitere wichtige Anforderung an IoT ist die asynchrone
Kommunikation in Echtzeit. Synchrone Kommunikation in Echtzeit bedingt,
dass die Uhren synchron sind und beide zur gleichen Zeit kommunizieren,
was in vielen AnwendungsfÃ¤llen der IoT nicht wÃ¼nschenswert ist.

\section{MQTT - Message Queuing Telemetry Transport
Protocol}\label{mqtt---message-queuing-telemetry-transport-protocol}

Das MQTT Protokoll mit dem \emph{Publisher-Subscriber} Ansatz ermÃ¶glich
asynchrone Kommunikation von Events in Echtzeit in dem zwischen
Subscriber und Publisher ein \emph{Broker}-Server in der Kommunikation
dazwischen steht, der die Nachrichten zwischenspeichert. MQTT ist ein
Protokoll fÃ¼r die Kommunikation zwischen GerÃ¤ten und Servern und wurde
ursprÃ¼nglich fÃ¼r eine schlanke DatenÃ¼bertragung Ã¼ber
Satellitenkommunikation entwickelt. MQTT ist ein offenes Protokoll, das
seit 1999 entwickelt wird, auf TCP/IP basiert und ab der Version 3.1
geÃ¶ffnet wurde.

Der Publisher sendet \emph{publish} eine Nachricht zu einem Topic
(beispielsweise \emph{gebauede1/labor1/temperature}) mit einem
bestimmten \emph{Quality of Service} (at most once, at least once,
exactly once) Parameter. Der Broker speichert die Nachricht und sendet
diese an alle Subscriber, die dieses Topic abonnieren \emph{subscribe}.
\href{https://mosquitto.org}{Mosquitto} ist ein quelloffener Message
Broker, der die MQTT implementiert. Mosquitto ist schlank und eignet
sich fÃ¼r den Einsatz auf allen GerÃ¤ten, von stromsparenden
Einplatinencomputern bis hin zu kompletten Servern. Eclipse Paho ist
eine quelloffene Implementierung von MQTT und bietet Bibliotheken in
verschiedenen Programmiersprachen wie Python, C++ oder Java an.

\section{Cloud, Edge und Fog}\label{cloud-edge-und-fog}

Mit zunehmender Rechenleistung auf IoT GerÃ¤ten kÃ¶nnen diese vermehrt
selbst Daten prozessieren, was eine Verlagerung der Analyse ermÃ¶glicht.
Die Begriffe Cloud, Edge und Fog bezeichnen im wesentlichen wo in
Infrastrukturen die Datenprozessierung durchgefÃ¼hrt wird. In
\textbf{Cloud} Infrastrukturen erfolgt die Prozessierung zentralisiert
in der Cloud und grossen Recheninfrastrukturen, wohingegen
\textbf{Edge}-Computing eine Infrastruktur bezeichnet, in der die
lokalen GerÃ¤te selbst einen Teil der Daten dezentral und mÃ¶glichst lokal
verarbeiten. Fog - ein von Cisco eingefÃ¼hrter Begriff - bezeichnet Cloud
Computing im lokalen Netzwerk, beispielsweise kÃ¶nnte ein
Transportunternehmen die Verwaltung der Datenprozessierung in der
eigenen Cloud durchfÃ¼hren.

\begin{figure}[H]

{\centering \includegraphics[width=0.5\textwidth,height=\textheight]{images/gartner_hypecycle_2023.png}

}

\caption{Im Gartner Hype Cycle for Emerging Technologies 2023 erreicht
der ``Hype'' \emph{Cloud-Out to Edge} den Peak of Inflated Expectations
(\citeproc{ref-gartner2023}{Gartner, 2023})}

\end{figure}%

\chapter*{Literatur}\label{literatur}
\addcontentsline{toc}{chapter}{Literatur}

\markboth{Literatur}{Literatur}

\phantomsection\label{refs}
\begin{CSLReferences}{1}{0}
\bibitem[\citeproctext]{ref-ams2022}
AMS OSRAM Group. (2022). \emph{Datasheet {AS7262} 6-{Channel Visible
Spectral}\_{ID Device} with {Electronic Shutter} and {Smart Interface}}.
AMS OSRAM Group.

\bibitem[\citeproctext]{ref-ariza2022}
Ariza, J. Ã., \& Baez, H. (2022). Understanding the Role of Single-Board
Computers in Engineering and Computer Science Education: {A} Systematic
Literature Review. \emph{Computer Applications in Engineering
Education}, \emph{30}(1), 304--329.
\url{https://doi.org/10.1002/cae.22439}

\bibitem[\citeproctext]{ref-ashton2009}
Ashton, K. (2009). That {âInternet of Things``} Thing. \emph{RFID
journal}, \emph{22}(7), 97--114.

\bibitem[\citeproctext]{ref-celebi2020}
Celebi, H. B., Pitarokoilis, A., \& Skoglund, M. (2020). Wireless
{Communication} for the {Industrial IoT}. In I. Butun (Hrsg.),
\emph{Industrial {IoT} : {Challenges}, {Design Principles},
{Applications}, and {Security}} (S. 57--94). Springer International
Publishing. \url{https://doi.org/10.1007/978-3-030-42500-5_2}

\bibitem[\citeproctext]{ref-EclipseFoundation2021}
Eclipse Foundation. (2021). Authentication Methods. In \emph{Eclipse
Mosquitto}. https://mosquitto.org/documentation/authentication-methods/.

\bibitem[\citeproctext]{ref-gartner2023}
Gartner. (2023). 4 {Exciting New Trends} in the {Gartner Emerging
Technologies Hype Cycle}. In \emph{Gartner}.
https://www.gartner.com/en/articles/what-s-new-in-the-2023-gartner-hype-cycle-for-emerging-technologies.

\bibitem[\citeproctext]{ref-bosch2022}
Gas Sensor {BME688}. (o.~J.). In \emph{Bosch Sensortec}.
https://www.bosch-sensortec.com/products/environmental-sensors/gas-sensors/bme688/.

\bibitem[\citeproctext]{ref-gore1998}
Gore, A. (1998). The {Digital Earth}. \emph{Australian Surveyor},
\emph{43}(2), 89--91.
\url{https://doi.org/10.1080/00050348.1998.10558728}

\bibitem[\citeproctext]{ref-granell2020}
Granell, C., Kamilaris, A., Kotsev, A., Ostermann, F. O., \& Trilles, S.
(2020). Internet of {Things}. In H. Guo, M. F. Goodchild, \& A. Annoni
(Hrsg.), \emph{Manual of {Digital Earth}} (S. 387--423). Springer.
\url{https://doi.org/10.1007/978-981-32-9915-3_11}

\bibitem[\citeproctext]{ref-grimm2023}
Grimm, D. (2023). \emph{2030 {Geod{Ã¤}tische Messtechnik GMT I}}.

\bibitem[\citeproctext]{ref-herle2019}
HerlÃ©, S., Bill, R., \& Blankenbach, J. M. (2019). \emph{{A
GeoEvent-driven architecture based on GeoMQTT for the Geospatial IoT}}
(phdthesis RWTH-2019-10695). Dissertation, Rheinisch-Westf{Ã¤}lische
Technische Hochschule Aachen, 2019.

\bibitem[\citeproctext]{ref-hirmer2023}
Hirmer, P. (2023). Foundations. In P. Hirmer (Hrsg.), \emph{Model-{Based
Approaches} to the {Internet} of {Things}} (S. 7--15). Springer
International Publishing.
\url{https://doi.org/10.1007/978-3-031-18884-8_2}

\bibitem[\citeproctext]{ref-Hollingworth2024}
Hollingworth, G. (2024). Raspberry {Pi Connect}. In \emph{Raspberry Pi}.

\bibitem[\citeproctext]{ref-influxdata2023}
influxdata. (2023). \emph{Get Started with {InfluxDB} {\textbar}
{InfluxDB OSS} v2 {Documentation}}.
https://docs.influxdata.com/influxdb/v2/get-started/.

\bibitem[\citeproctext]{ref-tdk2021}
InvenSense, T. (2021). \emph{{ICM-20948 World}'s {Lowest Power} 9-{Axis
MEMS MotionTracking}â¢ {Device}}.

\bibitem[\citeproctext]{ref-iso1994}
ISO. (1994). {ISO}/{IEC} 7498-1:1994. In \emph{ISO}.
https://www.iso.org/standard/20269.html.

\bibitem[\citeproctext]{ref-ITU2005}
ITU. (2005). \emph{{ITU Internet Reports} 2005: {The Internet} of
{Things}}. International Telecommunication Union.

\bibitem[\citeproctext]{ref-Jensen2020}
Jensen, K. (2020). \emph{White {Paper Chip-scale} Spectral Sensing:
Understanding the New Uses for Ultra-Precise Light-Source Measurement}
(S. 10) {[}White \{\{Paper\}\}{]}. AMS.

\bibitem[\citeproctext]{ref-kamilaris2018}
Kamilaris, A., \& Ostermann, F. O. (2018). Geospatial {Analysis} and the
{Internet} of {Things}. \emph{ISPRS International Journal of
Geo-Information}, \emph{7}(7), 269.
\url{https://doi.org/10.3390/ijgi7070269}

\bibitem[\citeproctext]{ref-laska2018}
Laska, M., Herle, S., Klamma, R., \& Blankenbach, J. (2018). A {Scalable
Architecture} for {Real-Time Stream Processing} of {Spatiotemporal IoT
Stream Data}---{Performance Analysis} on the {Example} of {Map
Matching}. \emph{ISPRS International Journal of Geo-Information},
\emph{7}(7), 238. \url{https://doi.org/10.3390/ijgi7070238}

\bibitem[\citeproctext]{ref-leicageosystems2022}
Leica Geosystems. (2022). \emph{Leica {TS60}/{MS60}/{TM60
Gebrauchsanweisung}}.

\bibitem[\citeproctext]{ref-links2019}
Links, C. (2019). \emph{{IoT Standards}: {The End Game} - {Qorvo}}.
https://www.qorvo.com/design-hub/blog/iot-standards-the-end-game.

\bibitem[\citeproctext]{ref-maximintegrated2020}
maxim integrated. (2020). \emph{{MAX30101 High-Sensitivity Pulse
Oximeter} and {Heart-Rate Sensor} for {Wearable Health}}.

\bibitem[\citeproctext]{ref-melexis2019}
Melexis. (2019). \emph{{MLX90640} 32x24 {IR} Array {Datasheet}}.

\bibitem[\citeproctext]{ref-RaspberryPiLtd2024}
Raspberry Pi Ltd. (2024a). Raspberry {Pi Connect Beta} - {Access} Your
{Raspberry Pi} from Anywhere. In \emph{Raspberry Pi}.
https://www.raspberrypi.com/software/connect/.

\bibitem[\citeproctext]{ref-RaspberryPiLtd2024a}
Raspberry Pi Ltd. (2024b). Raspberry {Pi Documentation} Config.Txt. In
\emph{Raspberry Pi}.
https://www.raspberrypi.com/documentation/computers/config\_txt.html.

\bibitem[\citeproctext]{ref-rogers2006}
Rogers, Y. (2006). Moving on from {Weiser}'s {Vision} of {Calm
Computing}: {Engaging UbiComp Experiences}. In P. Dourish \& A. Friday
(Hrsg.), \emph{{UbiComp} 2006: {Ubiquitous Computing}} (S. 404--421).
Springer. \url{https://doi.org/10.1007/11853565_24}

\bibitem[\citeproctext]{ref-salvador2003}
Salvador, T., \& Anderson, K. (2003). Practical {Considerations} of
{Context} for {Context Based Systems}: {An Example} from an
{Ethnographic Case Study} of a {Man Diagnosed} with {Early Onset
Alzheimer}'s {Disease}. In A. K. Dey, A. Schmidt, \& J. F. McCarthy
(Hrsg.), \emph{{UbiComp} 2003: {Ubiquitous Computing}} (S. 243--255).
Springer. \url{https://doi.org/10.1007/978-3-540-39653-6_19}

\bibitem[\citeproctext]{ref-sliney2016}
Sliney, D. H. (2016). What Is Light? {The} Visible Spectrum and Beyond.
\emph{Eye}, \emph{30}(2), 222--229.
\url{https://doi.org/10.1038/eye.2015.252}

\bibitem[\citeproctext]{ref-st2021}
STMicroelectronics. (2021). \emph{{VL53L5CX} - {Datasheet} -
{Time-of-Flight} 8x8 Multizone Ranging Sensor with Wide Field of View}.

\bibitem[\citeproctext]{ref-st2023}
STMicroelectronics. (2023). \emph{Description of the Fields of View of
{STMicroelectronics}' {Time-of-Flight} Sensors}.

\bibitem[\citeproctext]{ref-trilles2017}
Trilles, S., Belmonte, Ã., Schade, S., \& Huerta, J. (2017). A
Domain-Independent Methodology to Analyze {IoT} Data Streams in
Real-Time. {A} Proof of Concept Implementation for Anomaly Detection
from Environmental Data. \emph{International Journal of Digital Earth},
\emph{10}(1), 103--120.
\url{https://doi.org/10.1080/17538947.2016.1209583}

\bibitem[\citeproctext]{ref-upton2022}
Upton, E. (2022). Supply Chain Update - It's Good News! In
\emph{Raspberry Pi}.

\bibitem[\citeproctext]{ref-wiegerling2013}
Wiegerling, K. (2013). {Ubiquitous Computing}. In A. Grunwald \& M.
Simonidis-Puschmann (Hrsg.), \emph{{Handbuch Technikethik}} (S.
374--378). J.B. Metzler.
\url{https://doi.org/10.1007/978-3-476-05333-6_71}

\bibitem[\citeproctext]{ref-zaheeruddin2020}
Zaheeruddin, \& Gupta, H. (2020). Foundation of {IoT}: {An Overview}. In
M. Alam, K. A. Shakil, \& S. Khan (Hrsg.), \emph{Internet of {Things}
({IoT}): {Concepts} and {Applications}} (S. 3--24). Springer
International Publishing.
\url{https://doi.org/10.1007/978-3-030-37468-6_1}

\bibitem[\citeproctext]{ref-Zamorano2016}
Zamorano, J., GarcÃ­a, C., Tapia, C., Miguel, A. S. de, Pascual, S., \&
Gallego, J. (2016). {STARS4ALL Night Sky Brightness Photometer}.
\emph{International Journal of Sustainable Lighting}, \emph{18}, 49--54.
\url{https://doi.org/10.26607/ijsl.v18i0.21}

\end{CSLReferences}

\part{Praktika}

\chapter{LuftqualitÃ¤tmessung}\label{luftqualituxe4tmessung}

Diese Ãbung zeigt wie Sensoren mit dem Raspberry Pi genutzt werden
kÃ¶nnen am Beispiel des BME688 Sensors. Dieser Sensor erfasst Temperatur,
Luftdruck, Luftfeuchtigkeit und Gas Scanner VOC. Die Ãbung zeigt wie der
Sensor angeschlossen wird, wie die Sensordaten ausgelesen werden und wie
die Sensordaten in einer Datei gespeichert werden kÃ¶nnen.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung}

Ziel dieser ersten Ãbung ist es den BME688 Sensor kennen zu lernen und
die Sensordaten auszulesen. Der BME688 ist ein 4-in-1 Sensor fÃ¼r
Temperatur, Luftdruck, Luftfeuchtigkeit und Gas Scanner VOC. Der Sensor
verfÃ¼gt Ã¼ber eine I2C Schnittstelle, die mit der Python Library
\href{https://github.com/pimoroni/bme680-python}{bme680-python}
angesteuert und die Sensordaten ausgelesen werden kÃ¶nnen.

\textbf{Unterlagen:} \emph{ E01\_Luftqualitaet.zip}

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Lest das Kapitel im Anhang zu \href{A1_Rasperry_Pi.qmd}{Raspberry Pi}

  \begin{itemize}
  \tightlist
  \item
    Konzentriere Dich auf die wichtigsten Details zur Inbetriebnahme des
    Raspberry Pi
  \end{itemize}
\item
  Lest die Dokumentation zum BME688 Sensor {âGas Sensor {BME688}``}
  (\citeproc{ref-bosch2022}{o.~J.})

  \begin{itemize}
  \tightlist
  \item
    Konzentriere Dich auf die Beschreibung der Schnittstelle und
    technische Spezifikation auf dem Datenblatt
  \end{itemize}
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/youtube_bosch_bme688.png}

}

\caption{Youtube Video: How gas sensing gets intelligent with BME688 and
BME AI-Studio \href{https://www.youtube.com/embed/4vdliMRtxBY}{Youtube
Video}}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.2083}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.7917}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Unterlagen}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Produkt &
\href{https://shop.pimoroni.com/products/bme688-breakout}{BME688 4-in-1
Air Quality Breakout} \\
Datenblatt &
\href{https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme688-ds000.pdf}{Bosch
Datasheet BME 688} \\
GitHub & \href{https://github.com/pimoroni/bme680-python}{bme680-python
Library mit Beispielen} \\
Tutorial &
\href{https://learn.pimoroni.com/article/getting-started-with-bme680-breakout}{Getting
started with BME680 Breakout} \\
\end{longtable}

\section{\texorpdfstring{BME688\index{BME688}}{BME688}}\label{bme688}

BME688 - Bosch Sensor fÃ¼r Temperatur, Luftdruck, Luftfeuchtigkeit, Gas
Scanner VOC (Abb.~\ref{fig-bme688})

\begin{itemize}
\tightlist
\item
  Temperatur +/-0.5Â°C (-40Â° .. -85Â°)
\item
  Luftdruck +/-0.12hPa (300\ldots1100hPa)
\item
  Luftfeuchtigkeit +/-3\% (0 \ldots100\%)
\item
  Gas Scanner VOC, VSCs (AI)
\item
  Python, C Library
\item
  Raspberry Pi Pins 1,3,5,7,9
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/BME688_wide.jpg}

}

\caption{\label{fig-bme688}BME688 Bosch Sensor fÃ¼r LuftqualitÃ¤tsmessung
mit Referenzbild fÃ¼r den GrÃ¶ssenvergleich}

\end{figure}%

\section{Ãbungsaufbau}\label{uxfcbungsaufbau}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{BME688}, in welchem Du Ãnderungen und neue Dateien fÃ¼r
  diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{BME688} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle an.
\end{itemize}

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{Sensor Ausrichtung beachten}

Beim Anschliessen der Sensoren in die Schnittstellen des Breakout Garden
\textbf{unbedingt} die korrekte Ausrichtung beachten! Die Beschriftung
der AnschlÃ¼sse auf dem Sensor und dem Breakout Garden mÃ¼ssen
Ã¼bereinstimmen!

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_correct_sensor_mount.png}

}

\caption{Sensor links korrekt angeschlossen, rechts falsch ausgerichtet
angeschlossen.}

\end{figure}%

\end{boxtitle}

\subsection{Kontrolle der Hardware}\label{kontrolle-der-hardware}

Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
Pi mit dem Sensor verbunden ist und der Raspberry Pi Zugriff auf den
Sensor hat. Erscheint eine Zahl, dann hat der Raspberry Pi den Sensor
auf dem I2C Bus erkannt. Falls Du mehr Ã¼ber das Program und den Befehl
wissen mÃ¶chtest, kannst Du mit dem Befehl \texttt{man\ i2cdetect} das
Manual \texttt{man} aufrufen.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{i2cdetect} \AttributeTok{{-}y}\NormalTok{ 1}
     \ExtensionTok{0}\NormalTok{  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f}
\ExtensionTok{00:}                         \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{10:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{20:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{30:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{40:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{50:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{60:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} 
\ExtensionTok{70:} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}} \AttributeTok{{-}{-}}\NormalTok{ 76 }\AttributeTok{{-}{-}}  
\end{Highlighting}
\end{Shaded}

\texttt{i2cdetect} installieren, falls das Programm nicht existiert:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sudo}\NormalTok{ apt{-}get update }
\FunctionTok{sudo}\NormalTok{ apt install python3{-}smbus}
\FunctionTok{sudo}\NormalTok{ apt install i2c{-}tools}
\end{Highlighting}
\end{Shaded}

\textbf{Hinweis:} Damit der Befehl \texttt{i2cdetect} funktioniert, muss
der I2C Bus aktiviert sein. Dies kann mit dem Befehl
\texttt{sudo\ raspi-config} im MenÃ¼ \texttt{Interfacing\ Options} und
\texttt{I2C} aktiviert werden.

\subsection{Kontrolle der
Installation}\label{kontrolle-der-installation}

Teste ob die fÃ¼r die Ãbung erforderlichen Python Libraries installiert
sind.

\phantomsection\label{annotated-cell-5}%
\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python} \AttributeTok{{-}c} \StringTok{"import math"}
\ExtensionTok{0} \hspace*{\fill}\NormalTok{\circled{1}}
\ExtensionTok{python} \AttributeTok{{-}c} \StringTok{"import numpy"}
\ExtensionTok{Traceback} \ErrorTok{(}\ExtensionTok{most}\NormalTok{ recent call last}\KeywordTok{)}\BuiltInTok{:} \hspace*{\fill}\NormalTok{\circled{2}}
  \ExtensionTok{File} \StringTok{"\textless{}string\textgreater{}"}\NormalTok{, line 1, in }\OperatorTok{\textless{}}\NormalTok{module}\OperatorTok{\textgreater{}} 
\ExtensionTok{ImportError:}\NormalTok{ No module named numpy }
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
\texttt{math} Modul existiert
\item[\circled{2}]
\texttt{numpy} Modul existiert nicht
\end{description}

Installiere das Modul mit folgendem Befehl, falls es nicht installiert
ist. Aktiviere die virtuelle Umgebung (hier unter
\texttt{\textasciitilde{}/.env}) und installiere das Modul\footnote{In
  dieser Ãbung wird die Python Virtual Environment \texttt{.env} im
  Homeordner \texttt{\textasciitilde{}/} erstellt und aktiviert. Diese
  kann auch an einem Ort erstellt werden, beispielweise projektbasiert.
  Erstellen einer Virtual Environment:
  \texttt{python\ -m\ venv\ \textasciitilde{}/Development/Projekt1/env}}.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{source}\NormalTok{ \textasciitilde{}/.env/bin/activate}
\ExtensionTok{pip}\NormalTok{ install bme680}
\end{Highlighting}
\end{Shaded}

\subsection{Kopiere (Clone) die Library mit den Beispielen auf den
Raspberry
Pi}\label{kopiere-clone-die-library-mit-den-beispielen-auf-den-raspberry-pi}

Wechsle in den Ordner \emph{Documents} und kopiere mit folgenden
Befehlen die Library auf Deinen Raspberry Pi.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ Documents}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/bme680{-}python }
\BuiltInTok{cd}\NormalTok{ bme680{-}python/examples}
\end{Highlighting}
\end{Shaded}

\section{Aufgabe 1: Sensormessungen
ausfÃ¼hren}\label{aufgabe-1-sensormessungen-ausfuxfchren}

Teste das Beispiel \texttt{read-all.py} im Ordner \emph{examples}.
Dieses Beispiel gibt die Temperatur, Luftdruck und Luftfeuchtigkeit des
Sensors BME 688 aus.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ read{-}all.py}
\end{Highlighting}
\end{Shaded}

Mit \texttt{Ctrl+c} kann das Script wieder gestopppt werden. Die Ausgabe
sollte in etwa so aussehen (gekÃ¼rzt):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Output Beispiel}
\ExtensionTok{read{-}all.py} \AttributeTok{{-}}\NormalTok{ Displays temperature, pressure, humidity, and gas.}
\ExtensionTok{Press}\NormalTok{ Ctrl+C to exit!}

\ExtensionTok{Calibration}\NormalTok{ data:}
\ExtensionTok{par\_gh1:} \AttributeTok{{-}10}
\ExtensionTok{â¦}

\ExtensionTok{Initial}\NormalTok{ reading:}
\ExtensionTok{gas\_index:}\NormalTok{ 0}
\ExtensionTok{gas\_resistance:}\NormalTok{ 1338124.79581836}
\ExtensionTok{heat\_stable:}\NormalTok{ False}
\ExtensionTok{humidity:}\NormalTok{ 44.397}
\ExtensionTok{meas\_index:}\NormalTok{ 0}
\ExtensionTok{pressure:}\NormalTok{ 990.82}
\ExtensionTok{status:}\NormalTok{ 32}
\ExtensionTok{temperature:}\NormalTok{ 28.89}

\ExtensionTok{Polling:}
\ExtensionTok{28.89}\NormalTok{ C,990.82 hPa,44.39 \%RH}
\ExtensionTok{28.91}\NormalTok{ C,990.82 hPa,44.37 \%RH,5684.846331497602 Ohms}
\ExtensionTok{28.94}\NormalTok{ C,990.80 hPa,44.31 \%RH,5684.846331497602 Ohms}
\ExtensionTok{28.97}\NormalTok{ C,990.81 hPa,44.24 \%RH,5684.846331497602 Ohms}
\ExtensionTok{29.00}\NormalTok{ C,990.81 hPa,44.19 \%RH,5684.846331497602 Ohms}
\ExtensionTok{29.03}\NormalTok{ C,990.82 hPa,44.12 \%RH,5684.846331497602 Ohms}
\end{Highlighting}
\end{Shaded}

Folgendes Code Snippet zeigt eine gekÃ¼rtzte Version des read-all.py
Python Beispiels, der die \emph{Temperatur}, \emph{Luftdruck} und
\emph{Luftfeuchtigkeit} mit der BME680 Library ausgibt.

\phantomsection\label{annotated-cell-10}%
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/env python}
\ImportTok{import}\NormalTok{ bme680}
\ControlFlowTok{try}\NormalTok{:                                               }
\NormalTok{    sensor }\OperatorTok{=}\NormalTok{ bme680.BME680(bme680.I2C\_ADDR\_PRIMARY) }\hspace*{\fill}\NormalTok{\circled{1}}
\ControlFlowTok{except}\NormalTok{ (}\PreprocessorTok{RuntimeError}\NormalTok{, }\PreprocessorTok{IOError}\NormalTok{):}
\NormalTok{    sensor }\OperatorTok{=}\NormalTok{ bme680.BME680(bme680.I2C\_ADDR\_SECONDARY) }

\CommentTok{\# Oversampling Einstellungen}
\NormalTok{sensor.set\_humidity\_oversample(bme680.OS\_2X) }\hspace*{\fill}\NormalTok{\circled{2}}
\NormalTok{sensor.set\_pressure\_oversample(bme680.OS\_4X) }
\NormalTok{sensor.set\_temperature\_oversample(bme680.OS\_8X) }
\NormalTok{sensor.set\_filter(bme680.FILTER\_SIZE\_3) }

\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}Sensordaten:\textquotesingle{}}\NormalTok{)}
\ControlFlowTok{try}\NormalTok{:}
    \ControlFlowTok{while} \VariableTok{True}\NormalTok{:}
        \ControlFlowTok{if}\NormalTok{ sensor.get\_sensor\_data(): }\hspace*{\fill}\NormalTok{\circled{3}}
\NormalTok{            output }\OperatorTok{=} \StringTok{\textquotesingle{}}\SpecialCharTok{\{0:.2f\}}\StringTok{ C,}\SpecialCharTok{\{1:.2f\}}\StringTok{ hPa,}\SpecialCharTok{\{2:.3f\}}\StringTok{ \%RH\textquotesingle{}}\NormalTok{.}\BuiltInTok{format}\NormalTok{( }
\NormalTok{                sensor.data.temperature, }
\NormalTok{                sensor.data.pressure, }
\NormalTok{                sensor.data.humidity) }
            \BuiltInTok{print}\NormalTok{(output)}
\ControlFlowTok{except} \PreprocessorTok{KeyboardInterrupt}\NormalTok{:}
    \ControlFlowTok{pass}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Testen der beiden mÃ¶glichen I2C Adressen
\item[\circled{2}]
Oversampling Einstellungen kÃ¶nnen Messungen durch Mitteln verbessern und
das Rauschen und Drifts reduzieren
\item[\circled{3}]
Sensordaten auslesen
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-luftqualitaet}{}\label{exr-luftqualitaet}

\textbf{BME 688}\\
Studiert die Python Skripte und online Tutorial zum Sensor

\begin{itemize}
\tightlist
\item
  Wie wird auf den Sensor zugegriffen?
\item
  Wie reagiert der Feuchtigkeitssensor auf Ãnderungen?
\item
  Wie hoch sind die Werte fÃ¼r den Luftdruck, was sind Vergleichswerte?
\item
  Wie kÃ¶nnt Ihr einfach Sensorwerte in eine Datei schreiben?
\end{itemize}

\end{exercise}

\section{Aufgabe 2: Berechnung der AtmosphÃ¤renkorrektur fÃ¼r
Distanzmessungen
(optional)}\label{aufgabe-2-berechnung-der-atmosphuxe4renkorrektur-fuxfcr-distanzmessungen-optional}

GeÃ¶dÃ¤tische Distanzmessverfahren wie bei der Tachymetrie
(Totalstationen) und Laserscanning benÃ¶tigen eine Korrektur der
Messwerte, um die Distanz zwischen zwei Punkten auf der Erde zu
berechnen. Ãber eine \emph{Massstabskorrektur} (ppm {[}mm/km{]}) kÃ¶nnen
distanzproportionale Reduzierungen berÃ¼cksichtigt werden, die
\emph{Projektionsverzerrung}, \emph{Reduktion auf MeereshÃ¶he} und die
\emph{AtmophÃ¤renkorrektur} berÃ¼cksichtigen. Die Luftfeichtigkeit
beeinflusst Distanzmessungen in feuchtem und heissen Klima. Diese muss
den zur Messzeit geltenden atmosphÃ¤rischen Bedingungen angepasst werden.

Die Korrektur wird als \emph{AtmosphÃ¤renkorrektur} bezeichnet und ist
abhÃ¤ngig von der \emph{Temperatur}, dem \emph{Luftdruck} und der
\emph{Luftfeuchtigkeit}. Die Korrektur wird in ppm (parts per million
{[}mm/km{]}) angegeben und kann mit folgender
Gleichung~\ref{eq-atmosphaerenkorrektur} berechnet werden
(\citeproc{ref-grimm2023}{Grimm, 2023};
\citeproc{ref-leicageosystems2022}{Leica Geosystems, 2022, S. 87}) und
gilt fÃ¼r die Distanzmessung mit sichtbaren roten Laser

\begin{equation}\phantomsection\label{eq-atmosphaerenkorrektur}{
\Delta D_1 = 286.338 - \begin{bmatrix}\frac{0.29535 \cdot p}{(1+\alpha \cdot t)}-\frac{4.126 \cdot 10^{-4} \cdot h}{(1+\alpha \cdot t)} \cdot 10^x\end{bmatrix}
}\end{equation}

\[\begin{aligned}
& \Delta D_1 && \text{AtmosphÃ¤rische Korrektur} && [ppm]\\
& p && \text{Luftdruck} && [mbar]\\
& t && \text{Lufttemperatur} && [Â°C]\\
& h && \text{relative Luftfeuchte} && [\%]\\
& \alpha && = \frac{1}{273.15} \\
& x && = (7.5 \cdot \frac{t}{237.3 +t}) + 0.7857 \\
\end{aligned}
\]

Folgende Funktion in Python berechnet die AtmosphÃ¤renkorrektur fÃ¼r
GeodÃ¤tische Distanzmessverfahren basierend auf der
Gleichung~\ref{eq-atmosphaerenkorrektur}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ math}
\KeywordTok{def}\NormalTok{ calculate\_atmospheric\_correction(temperature, air\_pressure, humidity):}
    \CommentTok{\# Constants}
\NormalTok{    ALPHA }\OperatorTok{=} \DecValTok{1} \OperatorTok{/} \FloatTok{273.15}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ (}\FloatTok{7.5} \OperatorTok{*}\NormalTok{ temperature }\OperatorTok{/}\NormalTok{ (}\FloatTok{237.3} \OperatorTok{+}\NormalTok{ temperature)) }\OperatorTok{+} \FloatTok{0.7857}

    \CommentTok{\# Interim results}
\NormalTok{    denominator }\OperatorTok{=} \DecValTok{1} \OperatorTok{+}\NormalTok{ ALPHA }\OperatorTok{*}\NormalTok{ temperature}

\NormalTok{    formula0 }\OperatorTok{=} \FloatTok{286.338}
\NormalTok{    formula1 }\OperatorTok{=} \FloatTok{0.29535} \OperatorTok{*}\NormalTok{ air\_pressure }\OperatorTok{/}\NormalTok{ denominator}
\NormalTok{    formula2 }\OperatorTok{=} \FloatTok{4.126} \OperatorTok{*} \DecValTok{10} \OperatorTok{**}\NormalTok{ (}\OperatorTok{{-}}\DecValTok{4}\NormalTok{) }\OperatorTok{*}\NormalTok{ humidity }\OperatorTok{/}\NormalTok{ denominator}
\NormalTok{    formula3 }\OperatorTok{=} \DecValTok{10} \OperatorTok{**}\NormalTok{ X}

    \CommentTok{\# ppm{-}calculation}
\NormalTok{    correction\_ppm }\OperatorTok{=} \BuiltInTok{round}\NormalTok{(formula0 }\OperatorTok{{-}}\NormalTok{ (formula1 }\OperatorTok{{-}}\NormalTok{ formula2 }\OperatorTok{*}\NormalTok{ formula3), }\DecValTok{2}\NormalTok{)}

    \CommentTok{\# Return important values as a dictionary}
\NormalTok{    result }\OperatorTok{=}\NormalTok{ \{}
        \StringTok{"temperature"}\NormalTok{: temperature,}
        \StringTok{"air\_pressure"}\NormalTok{: air\_pressure,}
        \StringTok{"humidity"}\NormalTok{: humidity,}
        \StringTok{"correction\_ppm"}\NormalTok{: correction\_ppm}
\NormalTok{    \}}
    \ControlFlowTok{return}\NormalTok{ result}
\end{Highlighting}
\end{Shaded}

FÃ¼r Distanzmessungen hÃ¶chster Genauigkeit sollte die atmosphÃ¤rische
Korrektur auf \(1 ppm\) genau bestimmt werden, folglich sollten die
Messwerte mindestens folgenden Genauigkeit aufweisen: die Temperatur auf
\(1Â°C\), der Luftdruck auf \(3 mbar\) (\(1 Millibar= 1 hPa\)) und die
Luftfeuchtigkeit auf \(20 %
\) genau bestimmt werden (\citeproc{ref-leicageosystems2022}{Leica
Geosystems, 2022, S. 87}).

\begin{exercise}[]\protect\hypertarget{exr-atmosphaerenkorrektur}{}\label{exr-atmosphaerenkorrektur}

\textbf{AtmosphÃ¤renkorrektur}\\
Nutzt die Funktion \texttt{calculate\_atmospheric\_correction} um eine
atmosphÃ¤rische Korrektur mit den momentan gemessenen amtmosphÃ¤rischen
Bedingungen zu berechnen.

\begin{itemize}
\tightlist
\item
  Wie hoch ist die Korrektur mit den Werten des BME688 Sensors?
\item
  Wie hoch ist dieselbe Korrektur bei doppelter Luftfeuchtigkeit?
\item
  Wie hoch ist die Korrektur bei 20Â°C, 1000hPa und 50\% sowie 100\%
  Luftfeuchtigkeit?
\item
  ErfÃ¼llt der BME688 Sensor die Anforderungen fÃ¼r Distanzmessungen
  hÃ¶chster Genauigkeit?
\end{itemize}

\end{exercise}

\chapter{Spektralmessung}\label{spektralmessung}

Diese Ãbung fÃ¼hrt einen Spektralsensor ein und zeigt wie
Spektralmessungen durchgefÃ¼hrt werden kÃ¶nnen. Der AS7262 Spektralsensor
misst Ã¼ber 6-KanÃ¤le im sichtbaren Bereich und kann fÃ¼r spektroskopische
Messungen eingesetzt werden.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung-1}

Ziel dieser Ãbung ist es den AS7262 Spektralsensor kennen zu lernen und
die Sensordaten auszulesen. Der \emph{AS7262} ist ein Spektralsensor,
der Ã¼ber eine I2C Schnittstelle mit dem Raspberry Pi verbunden wird und
einer Python Library angesteuert werden kann.

\textbf{Unterlagen:} \emph{ E02\_Spektralmessung.zip}

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Schaut das Video von AMS zum
  \href{https://www.youtube.com/embed/KKyHxXyaVPM?si=hvO1IVbdwbjnDI40}{AS7262
  Spektralsensor} (bis Minute 2:20)
\item
  Lest das White Paper von Jensen (\citeproc{ref-Jensen2020}{2020}) Ã¼ber
  Spektralsensoren

  \begin{itemize}
  \tightlist
  \item
    Konzentriere Dich da auf die Beschreibung der \emph{Multi-channel
    spectral sensors} und in welchen Gebieten diese Sensoren eingesetzt
    werden.
  \end{itemize}
\item
  Studiert das Datenblatt zum AS7262 Spektralsensor AMS OSRAM Group
  (\citeproc{ref-ams2022}{2022})

  \begin{itemize}
  \tightlist
  \item
    In welchen Temperaturbereichen kann der Sensor eingesetzt werden?
  \end{itemize}
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/youtube_ams_as7262.png}

}

\caption{ams Spectral ID iSPI Eval Kit
\href{https://www.youtube.com/embed/4vdliMRtxBY}{Youtube Video}}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.1429}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.8571}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Unterlagen}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Produkt &
\href{https://shop.pimoroni.com/products/as7262-6-channel-spectral-sensor-spectrometer-breakout}{AS7262
Breakout} \\
Datenblatt &
\href{https://ams.com/documents/20143/36005/AS7262_DS000486_5-00.pdf}{AS7262} \\
GitHub &
\href{https://github.com/pimoroni/as7262-python}{as7262-python} \\
Video & \href{https://www.youtube.com/watch?v=KKyHxXyaVPM}{ams Spectral
ID iSPI Eval Kit} \\
\end{longtable}

\section{Spektrometer}\label{spektrometer}

Spektrometer, sind Sensoren, die das Licht auf einzelne BÃ¤nder der
WellenlÃ¤nge (in Nanometer nm) messen. FÃ¼r das menschliche Auge wird das
sichtbare Spektrum zwischen 360nm bis 830nm angegeben, wobei sich der
Bereich unter optimalen Bedingungen in UV und NIR erstrecken kann
(\citeproc{ref-sliney2016}{Sliney, 2016}).

Auf kleinen Chip verbaute Spektralsensoren ermÃ¶glichen zahlreiche neue
Anwendungen, die frÃ¼her mit grossen Spektroskopen durchgefÃ¼hrt wurden.
Die Spektralsensorsysteme finden Anwendung wie Farbbestimmung,
Authentifizierung und Spektralanalyse von Substanzen, Materialien,
Lebensmitteln und FlÃ¼ssigkeiten und werden in den Bereichen von
KonsumgÃ¼tern, Industrie und Medizin eingesetzt.

Ein Multispektralsensor liefert die Antwort auf die Frage, ob eine
orangefarbene Probe eine Mischung aus Rot und Gelb oder ein reines
Orange ist. Multispektralsensoren teilen das gewÃ¤hlte Spektrum in
SpektralkanÃ¤le auf (siehe Abb.~\ref{fig-as7262}) und sind so angeordnet,
dass die SpektralkanÃ¤le kontinuierlich gut abgedeckt sind. Die Messung
erfolgt im sichtbaren Bereich radiometrisch
(\citeproc{ref-Jensen2020}{Jensen, 2020}). Das heiÃt, der Sensor misst
die spektrale Leistungsverteilung der Messung.

\section{\texorpdfstring{AS7262
Multispektralsensor\index{AS7262}}{AS7262 Multispektralsensor}}\label{as7262-multispektralsensor}

Der AS7262 ist ein sehr kompakter Multispektralsensor, der Ã¼ber 6
SpektralkanÃ¤le im sichtbaren Bereich misst. Der Sensor eignet sich fÃ¼r
spektroskopische Messungen wie \emph{Farbmessung, Absorption,
BestrahlungsstÃ¤rke, Reflexion} und \emph{Transmission}. Der Sensor ist
auf einem Breakout Board verbaut und kann Ã¼ber die I2C Schnittstelle mit
dem Raspberry Pi verbunden werden, zusÃ¤tzlich sind zwei LEDs verbaut,
die den Messbereich fÃ¼r Messungen beleuchten kÃ¶nnen.

AS7262 - 6-Kanal Spektral Sensor (Abb.~\ref{fig-as7262})

\begin{itemize}
\tightlist
\item
  6 SpektralkanÃ¤le (450, 500, 550, 570, 600, 650nm)
\item
  2 on-board Beleuchtungs-LEDs
\item
  I2C interface~(address: 0x49)
\item
  Python Library
\item
  werkseitig kalibriert
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/AS7262_wide.jpg}

}

\caption{\label{fig-as7262}links: Spektrale SensitivitÃ¤t des AS7262,
oben: AS7262 Breakout von Pimoroni, unten: AS7262 Photodioden Array}

\end{figure}%

\section{Ãbungsaufbau}\label{uxfcbungsaufbau-1}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{AS7262}, in welchem Du Ãnderungen und neue Dateien fÃ¼r
  diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{AS7262} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle korrekt an (siehe
  \href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t}), so dass die
  Beschriftung der AnschlÃ¼sse am Sensor und bei der Schnittstelle
  Ã¼bereinstimmen.
\item
  Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
  Pi mit dem Sensor verbunden ist. Der Sensor sollte auf der Adresse
  \texttt{0x49} erkannt werden.
\item
  Kontrolliere, ob die Library \texttt{as7262} installiert ist mit
  \texttt{python\ -c\ "import\ as7262"}. Installiere die Library mit in
  der aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ as7262}, falls sie nicht installiert ist.
\end{itemize}

Wechsle in den Ordner \emph{Documents} und kopiere mit folgenden
Befehlen die Library auf Deinen Raspberry Pi.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ Documents}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/as7262{-}python}
\BuiltInTok{cd}\NormalTok{ as7262{-}python/examples}
\end{Highlighting}
\end{Shaded}

\section{Aufgabe 1: Spektralmessungen
durchfÃ¼hren}\label{aufgabe-1-spektralmessungen-durchfuxfchren}

Teste das Beispiel \texttt{spectrum.py} im Ordner \emph{examples}.
Dieses Beispiel gibt die Messungen der einzelnen SpektralkÃ¤nale aus.

Startet das Script mit \texttt{python\ spectrum.py}\footnote{Nicht
  vergessen zuerst die korrekte virtuelle Environment mit den
  installierten Libraries Ã¼ber
  \texttt{source\ \textasciitilde{}/.env/bin/activate} zu starten}. Mit
\texttt{Ctrl+c} kann das Script wieder gestopppt werden. Die Ausgabe
sollte in etwa so aussehen (gekÃ¼rzt):

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ spectrum.py}
\ExtensionTok{Orange:}\NormalTok{ 30.22943878173828}
\ExtensionTok{Red:}\NormalTok{    14.262250900268555}
\ExtensionTok{Orange:}\NormalTok{ 22.67207908630371}
\ExtensionTok{Yellow:}\NormalTok{ 14.271308898925781}
\ExtensionTok{Green:}\NormalTok{  13.56598949432373}
\ExtensionTok{Blue:}\NormalTok{   6.527451515197754}
\ExtensionTok{Violet:}\NormalTok{ 7.2663960456848145}
\end{Highlighting}
\end{Shaded}

Folgendes Code Snippet zeigt eine gekÃ¼rzte Version des
\texttt{spectrum.py} Python Beispiels fÃ¼r die Ausgabe der
Spektralmessungen der 6 KanÃ¤le:

\phantomsection\label{annotated-cell-15}%
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/env python}
\ImportTok{from}\NormalTok{ as7262 }\ImportTok{import}\NormalTok{ AS7262}
\NormalTok{as7262 }\OperatorTok{=}\NormalTok{ AS7262()}
\NormalTok{as7262.set\_gain(}\DecValTok{64}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{as7262.set\_integration\_time(}\FloatTok{17.857}\NormalTok{) }
\NormalTok{as7262.set\_measurement\_mode(}\DecValTok{2}\NormalTok{) }
\NormalTok{as7262.set\_illumination\_led(}\DecValTok{1}\NormalTok{) }

\ControlFlowTok{try}\NormalTok{:}
    \ControlFlowTok{while} \VariableTok{True}\NormalTok{:}
\NormalTok{        values }\OperatorTok{=}\NormalTok{ as7262.get\_calibrated\_values() }\hspace*{\fill}\NormalTok{\circled{2}}
        \BuiltInTok{print}\NormalTok{(}\StringTok{"""}
\StringTok{Red:    }\SpecialCharTok{\{\}}
\StringTok{Orange: }\SpecialCharTok{\{\}}
\StringTok{Yellow: }\SpecialCharTok{\{\}}
\StringTok{Green:  }\SpecialCharTok{\{\}}
\StringTok{Blue:   }\SpecialCharTok{\{\}}
\StringTok{Violet: }\SpecialCharTok{\{\}}\StringTok{"""}\NormalTok{.}\BuiltInTok{format}\NormalTok{(}\OperatorTok{*}\NormalTok{values))}

\ControlFlowTok{except} \PreprocessorTok{KeyboardInterrupt}\NormalTok{:}
\NormalTok{    as7262.set\_measurement\_mode(}\DecValTok{3}\NormalTok{)}
\NormalTok{    as7262.set\_illumination\_led(}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Sensor konfigurieren, setzen des Gains, der Integrationszeit, des
Messmodus und der Beleuchtungs LED
\item[\circled{2}]
Kalibrierte Messwerte auslesen und darstellen
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-spektralmessung}{}\label{exr-spektralmessung}

\textbf{AS7262 Messwerte interpretieren}\\
FÃ¼hrt einige Messungen mit unterschiedlichen Lichtquellen und
Materialien durch und notiert Euch die Messwerte. Was beobachtet Ihr?

\begin{itemize}
\tightlist
\item
  Messung mit Tageslicht
\item
  Messung mit LED-Taschenlampe des Smartphones
\item
  Messung mit LED-Taschenlampe und Farbfilter (MÃ¤ppli)
\item
  Messung mit weissem Papier
\end{itemize}

\end{exercise}

\section{Aufgabe 2: Spektralmessungen mit Visualisierung in der
Konsole}\label{aufgabe-2-spektralmessungen-mit-visualisierung-in-der-konsole}

Das Beispiel \texttt{bargraph.py} zeigt die Messwerte der SpektralkanÃ¤le
in einem Balkendiagramm an. Die Messwerte werden in der Konsole
ausgegeben, nach einem Weissabgleich. Der Weissabgleich wird benÃ¶tigt
damit der Sensoren die Messwerte korrekt in Referenz zu Weiss
interpretiert.

FÃ¼r diese Aufgabe benÃ¶tigt Ihr ein weisse Blatt Papier, mit welchem der
Sensor den Weissabgleich durchfÃ¼hrt. DafÃ¼r hÃ¤lt ihr dieses circa 5cm vor
den Sensor, drÃ¼ckt eine Taste und der Sensor fÃ¼hrt den Weissabgleich
durch. Danach kÃ¶nnt Ihr das Papier wieder wegnehmen und die Messungen
durchfÃ¼hren.

\begin{exercise}[]\protect\hypertarget{exr-spektralmessung-graph}{}\label{exr-spektralmessung-graph}

\textbf{Verteilung der SpektralkanÃ¤le untersuchen}

\begin{itemize}
\tightlist
\item
  FÃ¼hrt verschiedene Messungen durch mit unterschiedlichen Lichtquellen
  und Materialien und interpretiert die Ausgabe des
  \texttt{bargraph.py}.
\item
  Studiert den Code und versucht die Funktionsweise zu verstehen.
\end{itemize}

\end{exercise}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ bargraph.py }
\ExtensionTok{Setting}\NormalTok{ white point baseline.}

\ExtensionTok{Hold}\NormalTok{ a white sheet of paper \textasciitilde{}5cm in front of the sensor and press a key...}

\ExtensionTok{Baseline}\NormalTok{ set. Press a key to continue...   }
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{images/as7262_bargraph.png}

}

\caption{Beispiel Ausgabe von \texttt{bargraph.py} Spectrometer Bar
Graph}

\end{figure}%

\chapter{Bewegungsmessung}\label{bewegungsmessung}

Bewegungssensoren werden heute fast allgegenwÃ¤rtig in vielen Bereichen
eingesetzt, wie in Smartphones oder auch vielen MessgerÃ¤ten der
Geomatik. Diese Ãbung fÃ¼hrt in die Funktionsweise von MEMS
Bewegungssensoren ein und zeigt wie Bewegungsmessungen mit einem
ICM20948 9DoF Motion Sensor durchgefÃ¼hrt werden kÃ¶nnen.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung-2}

Ziel dieser Ãbung ist es Bewegungsmessung mit inertialen Messeinheiten
(IMU)\index{IMU} Ã¼ber den ICM20948 Bewegungssensor kennen zu lernen und
die Sensordaten auszulesen und testen. Der \emph{ICM20948} ist ein 9DoF
Bewegungssensor, der Ã¼ber eine I2C Schnittstelle mit dem Raspberry Pi
verbunden wird und einer Python Library angesteuert werden kann.

\textbf{Unterlagen:} \emph{ E03\_Bewegungsmessung.zip}

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Schaut das Video zur Funktionsweise von MEMS Bewegungssensoren

  \begin{itemize}
  \tightlist
  \item
    Video:
    \href{https://www.youtube.com/embed/eqZgxR6eRjo?si=u28t9yfD4BLPeYGd}{How
    MEMS Accelerometer Gyroscope Magnetometer Work} (bis Minute 2:50),
    sowie folgendes
  \item
    Video:
    \href{https://www.youtube.com/embed/swCTbz5sIQM?si=Uga2sPKfiQW7EO6z}{Bosch
    Funktionsprinzip eines Beschleunigungssensors}
  \end{itemize}
\item
  Studiere das Datenblatt zum ICM-20948
  (\citeproc{ref-tdk2021}{InvenSense, 2021})

  \begin{itemize}
  \tightlist
  \item
    In welchen Temperaturbereichen kann der Sensor eingesetzt werden?
  \end{itemize}
\item
  Installiere auf deinem Smartphone die Applikation
  \emph{\href{https://phyphox.org}{phyphox}} und teste die
  Beschleunigungssensoren deines Smartphones.
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/youtube_bosch_beschleunigungssensor.png}

}

\caption{How MEMS Accelerometer Gyroscope Magnetometer Work \& Arduino
Tutorial
\href{https://www.youtube.com/embed/swCTbz5sIQM?si=Uga2sPKfiQW7EO6z}{Youtube
Video}}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.1429}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.8571}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Unterlagen}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Produkt & \href{https://shop.pimoroni.com/products/icm20948}{ICM20948
Breakout} \\
Datenblatt &
\href{https://www.invensense.com/wp-content/uploads/2016/06/DS-000189-ICM-20948-v1.3.pdf}{ICM
20948} \\
GitHub &
\href{https://github.com/pimoroni/icm20948-python}{icm20948-python} \\
\end{longtable}

\section{Beschleunigungssensoren IMU}\label{beschleunigungssensoren-imu}

Beschleunigungssensoren, oder inertiale Messeinheit (inertial
measurement unit IMU) messen die Beschleunigung von Objekten mit dem
Messprinzip der TrÃ¤gheit und erfassen die Kraft die auf die Masse des
Objekt wirkt, wenn dieses beschleunigt wird.

FÃ¼r die Erfassung der sechs kinematischen Freiheitsgrade werden drei
Achsen der Beschleunigung (Accelerometer) und drei Achsen der Rotation
(Gyroskop) gemessen, die die Beschleunigungsmessung und
Winkelgeschwindigkeit der Drehraten ausgeben. FÃ¼r die Erfassung der
Orientierung im Raum wird ein Magnetometer eingesetzt, welches die
Ausrichtung des Objekts im Magnetfeld der Erde misst, um die Ausrichtung
im Raum zu bestimmen. Wenn alle drei Sensoren kombiniert werden, spricht
man von 9DoF Motion Sensoren, der neun Freiheitsgrade (9 Degrees of
Freedom) misst.

Beschleunigungssensoren werden in vielen Anwendungen eingesetzt, wie
z.B. in der Automobilindustrie (AuslÃ¶sen von Airbags), der Luft- und
Raumfahrt, der Medizintechnik (Beschleunigungssensoren in
Herzschrittmachern) und der Unterhaltungselektronik (Smartphones fÃ¼r die
Ausrichtung des Bildschirms).

\section{\texorpdfstring{ICM20948 9DoF Motion
Sensor\index{ICM20948}}{ICM20948 9DoF Motion Sensor}}\label{icm20948-9dof-motion-sensor}

Der ICM-20948 von
\href{https://invensense.tdk.com/products/motion-tracking/9-axis/icm-20948}{TDK
InvenSense} (Abb.~\ref{fig-icm20948}) ist ein 9-Achsen MEMS
Bewegungssensor, mit einem 3-Achsen Gyroskop, einem 3-Achsen
Beschleunigungssensor und einem 3-Achsen Magnetometer und sehr geringem
Stromverbrauch. Er enthÃ¤lt zwei Chip, einen fÃ¼r die Bewegungsmessung mit
Gyroskop und Beschleunigungssensor und einen zweiten fÃ¼r das
Magnetometer.

MEMS\index{MEMS} sind mikroelektromechanische Systeme, die aus
mikroskopisch kleinen mechanischen und elektrischen Komponenten
bestehen. Diese werden meist aus Silicium hergestellt und sind im Falle
von Beschleunigungssensoren sehr kleine Massen, die sich bei
Beschleunigung bewegen und die Ãnderung der elektrischen KapazitÃ¤t
messen.

9DoF Motion Accelero-, Gyro-, Magnetometer

\begin{itemize}
\tightlist
\item
  Â±2/Â±4/Â±8/Â±16 g 3-axis accelerometer
\item
  Â±250/Â±500/Â±1000/Â±2000 DPS (degrees per second) 3-axis gyroscope
\item
  3-axis compass with wide range up to Â±4900 Î¼T
\item
  Python, C Library
\item
  I2C interface~(address: 0x68 or0x69)
\item
  Qw/ST (Qwiic/STEMMA QT) connector
\item
  I2C interface (address 0x68/0x69 (cut trace))
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/ICM20948_wide.jpg}

}

\caption{\label{fig-icm20948}a) schematische Darstellung eines MEMS
Beschleunigungssensors Quelle: Bosch, b) raw, pitch, roll bei
Flugzeugen, c) ICM-20948 Breakout von Pimoroni, d) Orientierung von IMU
Sensoren.}

\end{figure}%

\section{Ãbungsaufbau}\label{uxfcbungsaufbau-2}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{ICM20948}, in welchem Du Ãnderungen und neue Dateien
  fÃ¼r diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{ICM20948} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle korrekt an (siehe
  \href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t}), so dass die
  Beschriftung der AnschlÃ¼sse am Sensor und bei der Schnittstelle
  Ã¼bereinstimmen.
\item
  Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
  Pi mit dem Sensor verbunden ist. Der Sensor sollte auf der Adresse
  \texttt{0x68} erkannt werden.
\item
  Kontrolliere, ob die Library \texttt{icm20948} installiert ist mit
  \texttt{python\ -c\ "import\ icm20948"}. Installiere die Library mit
  in der aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ icm20948}, falls sie nicht installiert ist.
\end{itemize}

Wechsle in den Ordner \emph{Documents} und kopiere mit folgenden
Befehlen die Library auf Deinen Raspberry Pi.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ Documents}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/icm20948{-}python}
\BuiltInTok{cd}\NormalTok{ icm20948{-}python/examples}
\end{Highlighting}
\end{Shaded}

\section{Aufgabe 1: Bewegungsmessungen
durchfÃ¼hren}\label{aufgabe-1-bewegungsmessungen-durchfuxfchren}

Teste das Beispiel \texttt{read-all.py} im Ordner \emph{examples}.
Dieses Beispiel gibt die Messungen der einzelnen Bewegungsmessungen aus,
der Beschleunigung, Winkelgeschwindigkeit und Orientierung mit dem
Accelerometer, Gyrometer und Magnetometer.

Startet das Script mit \texttt{python\ read-all.py}\footnote{Nicht
  vergessen zuerst die korrekte virtuelle Environment mit den
  installierten Libraries Ã¼ber
  \texttt{source\ \textasciitilde{}/.env/bin/activate} zu starten}. Mit
\texttt{Ctrl+c} kann das Script wieder gestopppt werden. Die Ausgabe
sollte in etwa so aussehen (gekÃ¼rzt):

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ read{-}all.py}
\ExtensionTok{read{-}all.py}
\ExtensionTok{Reads}\NormalTok{ all ranges of movement: accelerometer, gyroscope and compass heading.}
\ExtensionTok{Press}\NormalTok{ Ctrl+C to exit!}

\ExtensionTok{Accel:}\NormalTok{ 01.01 }\AttributeTok{{-}0.02}\NormalTok{ 00.01}
\ExtensionTok{Gyro:}  \AttributeTok{{-}0.42}\NormalTok{ 01.73 00.01}
\ExtensionTok{Mag:}   \AttributeTok{{-}86.85}\NormalTok{ 57.45 34.05}

\ExtensionTok{Accel:}\NormalTok{ 01.01 }\AttributeTok{{-}0.02}\NormalTok{ 00.02}
\ExtensionTok{Gyro:}  \AttributeTok{{-}0.40}\NormalTok{ 01.50 }\AttributeTok{{-}0.16}
\ExtensionTok{Mag:}   \AttributeTok{{-}85.35}\NormalTok{ 55.50 34.80}
\end{Highlighting}
\end{Shaded}

Folgendes Code Snippet zeigt eine gekÃ¼rzte Version des
\texttt{read-all.py} Python Beispiels fÃ¼r die Ausgabe der
Beschleunigungsmessung.

\phantomsection\label{annotated-cell-20}%
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/env python}
\ImportTok{import}\NormalTok{ time}
\ImportTok{from}\NormalTok{ icm20948 }\ImportTok{import}\NormalTok{ ICM20948}

\NormalTok{imu }\OperatorTok{=}\NormalTok{ ICM20948()}

\ControlFlowTok{while} \VariableTok{True}\NormalTok{:}
\NormalTok{    x, y, z }\OperatorTok{=}\NormalTok{ imu.read\_magnetometer\_data() }\hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{    ax, ay, az, gx, gy, gz }\OperatorTok{=}\NormalTok{ imu.read\_accelerometer\_gyro\_data() }\hspace*{\fill}\NormalTok{\circled{2}}

    \BuiltInTok{print}\NormalTok{(}\StringTok{""" \# \textless{}3\textgreater{}}
\StringTok{Accel: }\SpecialCharTok{\{:05.2f\}}\StringTok{ }\SpecialCharTok{\{:05.2f\}}\StringTok{ }\SpecialCharTok{\{:05.2f\}}
\StringTok{Gyro:  }\SpecialCharTok{\{:05.2f\}}\StringTok{ }\SpecialCharTok{\{:05.2f\}}\StringTok{ }\SpecialCharTok{\{:05.2f\}}
\StringTok{Mag:   }\SpecialCharTok{\{:05.2f\}}\StringTok{ }\SpecialCharTok{\{:05.2f\}}\StringTok{ }\SpecialCharTok{\{:05.2f\}}\StringTok{"""}\NormalTok{.}\BuiltInTok{format}\NormalTok{(}
\NormalTok{        ax, ay, az, gx, gy, gz, x, y, z}
\NormalTok{        ))}

\NormalTok{    time.sleep(}\FloatTok{0.25}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{4}}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Auslesen des Magnetometers (x,y,z)
\item[\circled{2}]
Auslesen des Accelerometers (ax,ay,az) und Gyrometers (gx,gy,gz)
\item[\circled{3}]
Messwerte auf der Konsole ausgeben
\item[\circled{4}]
Warten 0.25 Sekunden (damit die Ausgabe nicht zu schnell ist)
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-bewegungsmessung}{}\label{exr-bewegungsmessung}

\textbf{Bewegungsmessung}\\

\begin{itemize}
\tightlist
\item
  FÃ¼hre das Beispiel \texttt{read-all.py} aus und beobachte die
  Messwerte.
\item
  Versuche den Sensor jeweils leicht in eine Richtung zu bewegen, zu
  drehen, zu kippen und beobachte die Messwerte.
\item
  Versuche den Sensor zu leicht zu schÃ¼tteln und beobachte die
  Messwerte.
\item
  Vergleiche die Messwerte mit den Messwerten deines Smartphones mit der
  App \emph{phyphox}.
\item
  Versucht zu eruieren wie die Achsen orientiert sind und vergleicht mit
  anderen Gruppen.
\item
  Schreibe die Messwerte in eine Datei und visualisiere diese mit einem
  Plot, modifiziere dazu das Beispiel \texttt{read-all.py} und speichere
  die Datei als \texttt{read-csv.py}, so dass die Messungen zeilenweise
  mit einem Separator gespeichert werden. Ausgaben aus einem Plot kÃ¶nnen
  mit dem Befehl
  \texttt{python\ read-csv.py\ \textgreater{}\ imu\_horizontal.csv} in
  eine Datei geschrieben werden. Nun kÃ¶nnt ihr verschiedene Versuche mit
  der IMU durchfÃ¼hren und in einer Datei speichern. Die Datei kÃ¶nnt ihr
  beispielsweise mit \emph{LibreOffice Calc} oder \emph{Excel} Ã¶ffnen
  und die Daten visualisieren.
\end{itemize}

\end{exercise}

\section{Aufgabe 2: Magnetometer}\label{aufgabe-2-magnetometer}

Das Beispiel \texttt{bargraph.py} zeigt die Messwerte des Magnetometers
in einem Balkendiagramm an und zeigt die Orientierung des Sensors an je
nach dem Ã¼ber welche Achse gemessen wird. Der Befehl
\texttt{python\ bargraph.py\ -\/-help} zeigt die Optionen des Skripts
an.

Die Ausgabe sollte fÃ¼r die Option \texttt{-\/-graph} in etwa so
aussehen:

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ bargraph.py }\AttributeTok{{-}{-}graph}
\ExtensionTok{bargraph.py} \AttributeTok{{-}}\NormalTok{ Convert raw values to heading}

\ExtensionTok{Rotate}\NormalTok{ the sensor through 360 degrees to calibrate.}

\ExtensionTok{Press}\NormalTok{ Ctrl+C to exit!}

\ExtensionTok{043.5}\NormalTok{ âââââââââââââ                                                                                                     }
\end{Highlighting}
\end{Shaded}

\begin{exercise}[]\protect\hypertarget{exr-bewegungsmessung-heading}{}\label{exr-bewegungsmessung-heading}

\textbf{Bar graph}

\begin{itemize}
\tightlist
\item
  Kalibriere den Sensor und vergleiche die Orientierung des Sensors mit
  den Himmelsrichtungen
\item
  Vergleiche die Ausgaben auch mit der Orientierung des Smartphones und
  den Messwerten der App \emph{\href{https://phyphox.org}{phyphox}}.
\item
  Studiert den Code und versucht die Funktionsweise zu verstehen.
\end{itemize}

\end{exercise}

\chapter{Distanzmessung}\label{distanzmessung}

Distanzmessungen sind essentiell im Bereich der Geomatik.
Unterschiedliche Messverfahren ermÃ¶glichen Distanzmessungen unter
anderem Time-of-Flight Sensoren, die in dieser Ãbung praktisch genutzt
und getestet werden.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung-3}

Ziel dieser Ãbung ist es Distanzmessungen mit dem VL53L5CX Sensor kennen
zu lernen und die Sensordaten auszulesen und testen. Der \emph{VL53L5CX}
ist ein 8x8 Time of Flight (ToF) Array Sensor, der Ã¼ber eine I2C
Schnittstelle mit dem Raspberry Pi verbunden wird und einer Python
Library angesteuert werden kann.

\textbf{Unterlagen:} \emph{ E04\_Distanzmessung.zip}

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Schaut folgende von Video von Adafruit Industries zur Funktionsweise
  des VL53L5CX Sensors an:
  \href{https://www.youtube.com/embed/nf527vcKRSE?si=Q2Wm_pS2O1n99-ha}{EYE
  ON NPI - ST VL53L5CX Time-of-Flight Ranging Sensor}
\item
  Studiere das Datenblatt zum VL53L5CX
  (\citeproc{ref-st2021}{STMicroelectronics, 2021}), sowie die
  \emph{Application Note} (\citeproc{ref-st2023}{STMicroelectronics,
  2023})

  \begin{itemize}
  \tightlist
  \item
    In welchen Temperaturbereichen kann der Sensor eingesetzt werden?
  \item
    Welches ist die hÃ¶chste Abtastrate fÃ¼r die Distanzfeldmessungen?
  \item
    Was sind Anwendungsgebiete fÃ¼r diesen Sensor?
  \end{itemize}
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/youtube_adafruit_VL53L5CX.png}

}

\caption{Adafruit - EYE ON NPI - ST VL53L5CX Time-of-Flight Ranging
Sensor
\href{https://www.youtube.com/embed/nf527vcKRSE?si=Q2Wm_pS2O1n99-ha}{Youtube
Video}}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.1429}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.8571}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Unterlagen}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Produkt &
\href{https://shop.pimoroni.com/products/vl53l5cx-time-of-flight-tof-sensor-breakout}{VL53L5CX
Breakout} \\
Datenblatt &
\href{https://cdn.shopify.com/s/files/1/0174/1800/files/vl53l5cx.pdf}{VL53L5CX} \\
GitHub &
\href{https://github.com/pimoroni/vl53l5cx-python}{vl53l5cx-python} \\
\end{longtable}

\section{\texorpdfstring{VL53L5CX 8x8 Time of Flight (ToF) Array
Sensor\index{VL53L5CX}}{VL53L5CX 8x8 Time of Flight (ToF) Array Sensor}}\label{vl53l5cx-8x8-time-of-flight-tof-array-sensor}

Der VL53L5CX ist hochentwickelter Distanzsensor mit einer
8x8-Multizonenmessung und einem groÃen Sichtfeld, ideal fÃ¼r Roboter und
fortschrittliche Bewegungserkennung. Der mit die Entfernung mit Time of
Flight (ToF), also mit der Laufzeit von Licht, indem er einen
Infrarotlaser mit geringer Leisten auf ein Ziel schickt und die Zeit
misst, die das Licht benÃ¶tigt, um zurÃ¼ckzukehren.

Dieser Sensor hat eine hohe Genauigkeit und Abtastfrequenz (bis zu 60
Hz) und einen groÃen Erfassungsbereich (von 2 cm bis 4 m). Besonders
interessant ist, dass der Sensor nicht nur eine Messung durchfÃ¼hrt,
sondern eine 8x8 Matrix mit Messwerten zurÃ¼ckgibt. Das bedeutet, das
Bewegungen aus bestimmten Richtungen erkannt werden kÃ¶nnen oder der
Sensor benutzt werden kann um Kollisionen zu vermeiden oder Objekte zu
verfolgen ohne dass mehrere Sensoren benÃ¶tigt werden.

VL53L5CX 8x8 Time of Flight (ToF) Array Sensor Breakout

\begin{itemize}
\tightlist
\item
  8x8 Multizone readings
\item
  Distance 2cm - 4m
\item
  I2C interface, with address: 0x52
\item
  Python, C Library
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/VL53L5CX_wide.jpg}

}

\caption{\label{fig-vl53l5cx}links: VL53L5CX Breakout von Pimoroni,
rechts: schematische Darstellung TOF Moduls Quelle: STMicroelectronics
(\citeproc{ref-st2023}{2023})}

\end{figure}%

\section{Ãbungsaufbau}\label{uxfcbungsaufbau-3}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{VL53L5CX}, in welchem Du Ãnderungen und neue Dateien
  fÃ¼r diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{VL53L5CX} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle korrekt an (siehe
  \href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t}), so dass die
  Beschriftung der AnschlÃ¼sse am Sensor und bei der Schnittstelle
  Ã¼bereinstimmen.
\item
  Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
  Pi mit dem Sensor verbunden ist. Der Sensor sollte auf der Adresse
  \texttt{0x29} erkannt werden.
\item
  Kontrolliere, ob die Library \texttt{vl53l5cx\_ctypes} installiert ist
  mit \texttt{python\ -c\ "import\ vl53l5cx\_ctypes"}. Installiere die
  Library mit in der aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ st7789}, falls sie nicht installiert ist
\end{itemize}

Wechsle in den Ordner \emph{Documents} und kopiere mit folgenden
Befehlen die Library auf Deinen Raspberry Pi.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ Documents}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/vl53l5cx{-}python}
\BuiltInTok{cd}\NormalTok{ vl53l5cx{-}python/examples}
\end{Highlighting}
\end{Shaded}

\section{Aufgabe 1: Distanzmessung
Konsole}\label{aufgabe-1-distanzmessung-konsole}

Teste das Beispiel \texttt{test.py} im Ordner \emph{examples}. Dieses
Beispiel liest die Werte der 8x8 Time of Flight Messung aus mit Werten
zu \emph{motion, distance, reflectance} und \emph{status} aus.

\begin{boxtitle}{Hinweis}{colPrimary}

Das Script startet langsam, da die Library jeweils die Firmware beim
Starten lÃ¤dt.

\end{boxtitle}

Startet das Script mit \texttt{python\ test.py}. Mit \texttt{Ctrl+C}
kann das Script wieder gestopppt werden. Die Ausgabe sollte in etwa so
aussehen (gekÃ¼rzt):

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python3}\NormalTok{ test.py }
\ExtensionTok{Uploading}\NormalTok{ firmware, please wait...}
\ExtensionTok{Done!}
\KeywordTok{[[}\NormalTok{  36   26 2356  }\ErrorTok{543}\ExtensionTok{]}
 \BuiltInTok{[}\NormalTok{  38   62 1943 }\ErrorTok{3847}\ExtensionTok{]}
 \BuiltInTok{[}\NormalTok{  27   68  530 }\ErrorTok{6744}\ExtensionTok{]}
 \BuiltInTok{[}\NormalTok{  14   18   66  }\ErrorTok{458]]} \ExtensionTok{[[1254}\NormalTok{  308  406 2042  365  377  314  237]}
 \ExtensionTok{[1275}\NormalTok{  351  397  413  404  403  354  228]}
 \ExtensionTok{[1297}\NormalTok{  357  375  432  427  422  391  241]}
 \ExtensionTok{[1250}\NormalTok{  348  385  389  415  437  398  315]}
 \ExtensionTok{[1273}\NormalTok{  358  358  385  405  429  400  363]}
 \ExtensionTok{[1238}\NormalTok{  336 2240  368  424  417  379  336]}
 \ExtensionTok{[1262}\NormalTok{  226 2215  180  188  218  202  190]}
 \BuiltInTok{[}\NormalTok{ 108  110  113  }\ErrorTok{117}  \ExtensionTok{116}\NormalTok{  120  120  124]] [[23  1  2 30 11  8 27 41]}
 \ExtensionTok{[16}\NormalTok{  1  3  4  4 17 43 35]}
 \ExtensionTok{[23}\NormalTok{  1  2  6  5 21 58 32]}
 \ExtensionTok{[21}\NormalTok{  1  2  4  6 32 62 52]}
 \ExtensionTok{[27}\NormalTok{  1  3  5  9 36 65 71]}
 \ExtensionTok{[27}\NormalTok{  1 59  5 16 47 52 46]}
 \ExtensionTok{[26}\NormalTok{  1 39  6  9 20 20 21]}
 \ExtensionTok{[13}\NormalTok{ 13 14 14 15 16 17 20]] [[False False False  True False False  True  True]}
 \BuiltInTok{[}\NormalTok{ True False False }\ErrorTok{False} \ExtensionTok{False}\NormalTok{  True  True  True]}
 \BuiltInTok{[}\NormalTok{ True False False }\ErrorTok{False} \ExtensionTok{False}\NormalTok{  True  True  True]}
 \BuiltInTok{[}\NormalTok{ True False False }\ErrorTok{False} \ExtensionTok{False}\NormalTok{  True  True  True]}
 \BuiltInTok{[}\NormalTok{ True False False }\ErrorTok{False} \ExtensionTok{False}\NormalTok{  True  True  True]}
 \BuiltInTok{[}\NormalTok{ True False  True }\ErrorTok{False}  \ExtensionTok{True}\NormalTok{  True  True  True]}
 \BuiltInTok{[}\NormalTok{ True False False  }\ErrorTok{True}  \ExtensionTok{True}\NormalTok{  True  True  True]}
 \BuiltInTok{[}\NormalTok{ True  True  True  }\ErrorTok{True}  \ExtensionTok{True}\NormalTok{  True  True  True]]}
\end{Highlighting}
\end{Shaded}

Folgendes Code Snippet zeigt eine gekÃ¼rzte Version des \texttt{test.py}
Python Beispiels fÃ¼r die Ausgabe der Distanzmatrix.

\phantomsection\label{annotated-cell-25}%
\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ time}
\ImportTok{import}\NormalTok{ numpy}
\ImportTok{import}\NormalTok{ vl53l5cx\_ctypes }\ImportTok{as}\NormalTok{ vl53l5cx}
\ImportTok{from}\NormalTok{ vl53l5cx\_ctypes }\ImportTok{import}\NormalTok{ STATUS\_RANGE\_VALID, STATUS\_RANGE\_VALID\_LARGE\_PULSE}

\BuiltInTok{print}\NormalTok{(}\StringTok{"Uploading firmware, please wait..."}\NormalTok{)                                      }
\NormalTok{vl53 }\OperatorTok{=}\NormalTok{ vl53l5cx.VL53L5CX() }\hspace*{\fill}\NormalTok{\circled{1}}
\BuiltInTok{print}\NormalTok{(}\StringTok{"Done!"}\NormalTok{)                                                                   }
\NormalTok{vl53.set\_resolution(}\DecValTok{8} \OperatorTok{*} \DecValTok{8}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{2}}
\NormalTok{vl53.enable\_motion\_indicator(}\DecValTok{8} \OperatorTok{*} \DecValTok{8}\NormalTok{) }
\CommentTok{\# vl53.set\_integration\_time\_ms(50)}
\CommentTok{\# Enable motion indication at 8x8 resolution}
\NormalTok{vl53.enable\_motion\_indicator(}\DecValTok{8} \OperatorTok{*} \DecValTok{8}\NormalTok{) }
\CommentTok{\# Default motion distance is quite far, set a sensible range}
\CommentTok{\# eg: 40cm to 1.4m}
\NormalTok{vl53.set\_motion\_distance(}\DecValTok{400}\NormalTok{, }\DecValTok{1400}\NormalTok{) }
\NormalTok{vl53.start\_ranging() }\hspace*{\fill}\NormalTok{\circled{3}}

\ControlFlowTok{while} \VariableTok{True}\NormalTok{:}
    \ControlFlowTok{if}\NormalTok{ vl53.data\_ready():}
\NormalTok{        data }\OperatorTok{=}\NormalTok{ vl53.get\_data() }\hspace*{\fill}\NormalTok{\circled{4}}
        \CommentTok{\# 2d array of motion data (always 4x4?)}
\NormalTok{        motion }\OperatorTok{=}\NormalTok{ numpy.flipud(numpy.array(data.motion\_indicator.motion[}\DecValTok{0}\NormalTok{:}\DecValTok{16}\NormalTok{]).reshape((}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{)))}
        \CommentTok{\# 2d array of distance}
\NormalTok{        distance }\OperatorTok{=}\NormalTok{ numpy.flipud(numpy.array(data.distance\_mm).reshape((}\DecValTok{8}\NormalTok{, }\DecValTok{8}\NormalTok{)))}
        \CommentTok{\# 2d array of reflectance}
\NormalTok{        reflectance }\OperatorTok{=}\NormalTok{ numpy.flipud(numpy.array(data.reflectance).reshape((}\DecValTok{8}\NormalTok{, }\DecValTok{8}\NormalTok{)))}
        \CommentTok{\# 2d array of good ranging data}
\NormalTok{        status }\OperatorTok{=}\NormalTok{ numpy.isin(numpy.flipud(numpy.array(data.target\_status).reshape((}\DecValTok{8}\NormalTok{, }\DecValTok{8}\NormalTok{))), (STATUS\_RANGE\_VALID, STATUS\_RANGE\_VALID\_LARGE\_PULSE))}
        \BuiltInTok{print}\NormalTok{(motion, distance, reflectance, status)}
\NormalTok{    time.sleep(}\FloatTok{0.1}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{5}}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Sensor initialisieren und Firmware laden
\item[\circled{2}]
Sensor konfigurieren (AuflÃ¶sung, Bewegungserkennung, Messbereich)
\item[\circled{3}]
Messung initialisieren
\item[\circled{4}]
Warten 0.1 Sekunden (damit die Ausgabe nicht zu schnell ist)
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-distanzmessung}{}\label{exr-distanzmessung}

\textbf{Bewegungsmessung}

\begin{itemize}
\tightlist
\item
  FÃ¼hre das Beispiel \texttt{test.py} aus und beobachte die Messwerte.
\item
  FÃ¼hre unterschiedliche Tests durch, indem Du ein Objekt vor den Sensor
  hÃ¤ltst und bewegst.
\item
  Vergleiche die Messwerte und kontrolliere die gemessenen Distanzen.
\item
  Untersuche die einzelnen Matrizen und versuche die Bedeutung der
  einzelnen Werte zu verstehen.
\end{itemize}

\end{exercise}

\section{Aufgabe 2: Distanzmessung mit LCD
Bildschirm}\label{aufgabe-2-distanzmessung-mit-lcd-bildschirm}

Folgende Aufgabe nutzt den 1.54'' LCD Bildschirm mit einer 240x240 Pixel
AuflÃ¶sung. Die Library \texttt{vl53l5cx\_ctypes} enthÃ¤lt mehrere
Beispiele, die die Distanzmatrizen fÃ¼r die \emph{Distanz-},
\emph{Bewegungs-} und \emph{Reflektanzmessung} auf dem Bildschirm
anzeigen. Die Beispiele sind im Ordner \texttt{examples} zu finden.

\begin{figure}

\centering{

\includegraphics{images/VL53L5CX_LCD.jpg}

}

\caption{\label{fig-vl53l5cx-LCD}Aufbau der Versuchsanordnung fÃ¼r die
Distanzmessung mit dem LCD Bildschirm montiert im dem \emph{hinteren}
SPI Slot}

\end{figure}%

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Kontrolliert mit \texttt{python\ -c\ "import\ st7789"} ob die Library
  \emph{st7789} installiert ist. Testet auch, ob die Bibliotheken
  \texttt{numpy} und \texttt{matplotlib} installiert sind und
  installiert diese ansonsten mit
  \texttt{sudo\ apt\ install\ python3-matplotlib\ python3-numpy}.
\item
  Kontrolliere, ob der Raspberry Pi den \emph{Breakout Garden HAT} mit
  den 2 SPI AnschlÃ¼ssen und 4 I2C AnschlÃ¼ssen bestÃ¼ckt ist
  (Abb.~\ref{fig-vl53l5cx-LCD}).
\item
  Montiere den Bildschirm im hinteren SPI Slot des \emph{Breakout Garden
  HAT}s wie in Abb.~\ref{fig-vl53l5cx-LCD}, da er sonst die Messung des
  VL53L5CX Sensors verdeckt.
\end{itemize}

FÃ¼hrt nun folgende Scripts aus und beobachtet die Ausgabe auf dem LCD
Bildschirm. Auch hier braucht es etwas Geduld, da die Firmware beim
Starten geladen wird.

\begin{itemize}
\tightlist
\item
  \texttt{python\ distance\_240x240\_lcd.py}
\item
  \texttt{python\ motion\_240x240\_lcd.py}
\item
  \texttt{python\ reflectance\_240x240\_lcd.py}
\item
  \texttt{python\ motion\_tracking.py}
\end{itemize}

\begin{exercise}[]\protect\hypertarget{exr-distanzmessung-LCD}{}\label{exr-distanzmessung-LCD}

\textbf{Distanzmessung}

\begin{itemize}
\tightlist
\item
  FÃ¼hre die Beispiele aus und beobachte die Ausgabe auf dem LCD
  Bildschirm.
\item
  Untersuche die einzelnen Matrizen und versuche die Bedeutung der
  einzelnen Werte zu verstehen.
\item
  FÃ¼hre unterschiedliche Tests durch, indem Du ein Objekt vor den Sensor
  hÃ¤lst und bewegst.
\item
  Was passiert wenn Du ein Objekt vor den Sensor hÃ¤ltst? Ist die Form
  erkennbar?
\item
  Was passiert wenn Du ein Objekt vor den Sensor hÃ¤ltst und bewegst?
\item
  Studiere den Code der Beispiele und versuche die Funktionsweise zu
  verstehen.
\item
  Ãberlege Dir AnwendungsfÃ¤lle fÃ¼r diesen Sensor allgemein und im
  speziellen fÃ¼r die Geomatik.
\end{itemize}

\end{exercise}

\chapter{Thermale Aufnahmen}\label{thermale-aufnahmen}

In der Fernerkundung sind Thermalkameras ein wichtiges Instrument zur
Erfassung von WÃ¤rmebildern, beispielsweise fÃ¼r die ZÃ¤hlung von
TierbestÃ¤nden oder auch fÃ¼r Untersuchungen von GebÃ¤udeisolationen. Diese
Ãbung nutzt die MLX90640 Thermalkamera und zeigt wie thermale Aufnahmen
mit dem Raspberry Pi gemacht werden kÃ¶nnen.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung-4}

Ziel dieser Ãbung ist es thermale Kamera mit der MLX90640 Kamera kennen
zu lernen und die thermalen Bilddaten auszulesen und testen. Die
\emph{MLX90640} ist eine weitwinkel Kamera mit einer AuflÃ¶sung von 24x32
Pixel. Sie wird Ã¼ber eine I2C Schnittstelle mit dem Raspberry Pi
verbunden und kann Ã¼ber eine Python Library angesteuert werden.

\textbf{Unterlagen:} \emph{ E05\_Thermalkamera.zip}

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Schaut folgende von Video von Melexis zur Funktionsweise der MLX90640
  Thermalkamera an:
  \href{https://www.youtube.com/embed/WSZ3GGDusTk?si=WTfxZ3m2axljCwDG}{Far
  Infrared (IR) Thermal Sensor Array 32x24 RES (MLX90640)}
\item
  Studiere das Datenblatt zum VL53L5CX
  (\citeproc{ref-melexis2019}{Melexis, 2019}) und beantworte folgende
  Fragen:

  \begin{itemize}
  \tightlist
  \item
    In welchen Temperaturbereichen kann der Sensor eingesetzt werden?
  \item
    Welches ist die hÃ¶chste Abtastrate fÃ¼r die Distanzfeldmessungen?
  \item
    Was sind Anwendungsgebiete fÃ¼r diesen Sensor?
  \end{itemize}
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/youtube_adafruit_VL53L5CX.png}

}

\caption{Far Infrared (IR) Thermal Sensor Array 32x24 RES (MLX90640)
\href{https://www.youtube.com/embed/WSZ3GGDusTk?si=WTfxZ3m2axljCwDG}{Youtube
Video}}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.1429}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.8571}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Unterlagen}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Produkt &
\href{https://shop.pimoroni.com/products/mlx90640-thermal-camera-breakout?variant=12549161746515}{MLX90640
Breakout} \\
Datenblatt &
\href{https://www.melexis.com/-/media/files/documents/datasheets/mlx90640-datasheet-melexis.pdf}{MLX90640} \\
GitHub &
\href{https://github.com/pimoroni/mlx90640-library}{mlx90640-library},
\href{https://github.com/adafruit/Adafruit_CircuitPython_MLX90640}{Adafruit
MLX90640} \\
\end{longtable}

\section{\texorpdfstring{MLX90640
Thermalkamera\index{MLX90640}}{MLX90640 Thermalkamera}}\label{mlx90640-thermalkamera}

Der MLX90640 ist eine Thermalkamera mit einer AuflÃ¶sung von 32x24 Pixel
mit einem Sichtfeld von 55Â°. Die Kamera misst in einem Temperaturbereich
von -40Â° - 300Â°C mit einer Genauigkeit von etwa 1Â°C und mit einer
Aufnahmerate von bis zu 64 FPS. Die Anwendungsbereiche sind vielfÃ¤ltig,
von der Temperatur der Kaffeetasse, Hitzeentwicklung in elektronischen
GerÃ¤ten bis hin zur Ãberwachung von GebÃ¤uden und Anlagen.

MLX90640 Thermal Camera

\begin{itemize}
\tightlist
\item
  Melexis MLX90640 far-infrared sensor array
\item
  Brennweite: 55Â°
\item
  32x24 pixels
\item
  I2C interface (address 0x33)
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/MLX90640_wide.jpg}

}

\caption{\label{fig-MLX90640}links: MLX90640 Thermalkamera, oben:
schematische Darstellung der Kamera und ihrer AnschlÃ¼sse rechts:
Pixelpositionaufbau Quelle: STMicroelectronics
(\citeproc{ref-st2023}{2023})}

\end{figure}%

\section{Ãbungsaufbau}\label{uxfcbungsaufbau-4}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{MLX90640}, in welchem Du Ãnderungen und neue Dateien
  fÃ¼r diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{MLX90640} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle korrekt an (siehe
  \href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t}), so dass die
  Beschriftung der AnschlÃ¼sse am Sensor und bei der Schnittstelle
  Ã¼bereinstimmen.
\item
  Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
  Pi mit dem Sensor verbunden ist. Der Sensor sollte auf der Adresse
  \texttt{0x33} erkannt werden.
\item
  Kontrolliere, ob folgende Libraries
  \texttt{adafruit-blinka},\texttt{adafruit-circuitpython-mlx90640} und
  \texttt{RPI.GPIO} installiert sind mit
  \texttt{python\ -c\ "import\ adafruit\_mlx90640"}. Installiere die
  Library mit in der aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ RPI.GPIO\ adafruit-blinka} und
  \texttt{pip\ install\ adafruit-circuitpython-mlx90640}, falls sie
  nicht installiert ist
\end{itemize}

Wechsle in den Ordner \emph{Documents} und kopiere in diesen den Ordner
\emph{MLX90640} mit den Code Beispielen.

\section{Aufgabe 1: Punktuelle
Temperaturmessung}\label{aufgabe-1-punktuelle-temperaturmessung}

Teste das Beispiel \texttt{average\_temperature.py} im Ordner
\emph{examples}. Dieses Beispiel liest die Werte aus der Matrix der
Thermalkamera und gibt den Mittelwert der Temperatur aus. Die Ausgabe
sollte in etwa so aussehen (gekÃ¼rzt):

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ average\_temperature.py }
\ExtensionTok{Average}\NormalTok{ MLX90640 Temperature: 23.6C }\ErrorTok{(}\ExtensionTok{74.5F}\KeywordTok{)}
\end{Highlighting}
\end{Shaded}

Folgendes Code Snippet zeigt eine gekÃ¼rzte Version des
\texttt{average\_temperature.py} Python Beispiels fÃ¼r die Ausgabe der
Distanzmatrix.

\phantomsection\label{annotated-cell-28}%
\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ time,board,busio}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ adafruit\_mlx90640}

\NormalTok{i2c }\OperatorTok{=}\NormalTok{ busio.I2C(board.SCL, board.SDA) }\hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{mlx }\OperatorTok{=}\NormalTok{ adafruit\_mlx90640.MLX90640(i2c) }
\NormalTok{mlx.refresh\_rate }\OperatorTok{=}\NormalTok{ adafruit\_mlx90640.RefreshRate.REFRESH\_2\_HZ }

\NormalTok{frame }\OperatorTok{=}\NormalTok{ np.zeros((}\DecValTok{24}\OperatorTok{*}\DecValTok{32}\NormalTok{,)) }\hspace*{\fill}\NormalTok{\circled{2}}
\ControlFlowTok{while} \VariableTok{True}\NormalTok{:}
    \ControlFlowTok{try}\NormalTok{:}
\NormalTok{        mlx.getFrame(frame) }\hspace*{\fill}\NormalTok{\circled{3}}
        \ControlFlowTok{break}
    \ControlFlowTok{except} \PreprocessorTok{ValueError}\NormalTok{:}
        \ControlFlowTok{continue} \hspace*{\fill}\NormalTok{\circled{4}}

\CommentTok{\# print out the average temperature from the MLX90640}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}Average MLX90640 Temperature: }\SpecialCharTok{\{0:2.1f\}}\StringTok{C (}\SpecialCharTok{\{1:2.1f\}}\StringTok{F)\textquotesingle{}}\NormalTok{.\textbackslash{}   }
      \BuiltInTok{format}\NormalTok{(np.mean(frame),(((}\FloatTok{9.0}\OperatorTok{/}\FloatTok{5.0}\NormalTok{)}\OperatorTok{*}\NormalTok{np.mean(frame))}\OperatorTok{+}\FloatTok{32.0}\NormalTok{))) }\hspace*{\fill}\NormalTok{\circled{5}}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Setup von I2C, Initialisierung des MLX90640 Sensors und Setzen der
Abtastrate auf 2 Hz
\item[\circled{2}]
Numpy Array fÃ¼r das Speichern der 768 Temperaturwerte (24x32 Pixel)
erstellen
\item[\circled{3}]
MLX Temperaturwerte in das Numpy Array speichern
\item[\circled{4}]
Falls ein Fehler eintritt, nochmals versuchen den Sensor auszulesen
\item[\circled{5}]
Temperaturmittelwert ausgeben
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-thermalkamera}{}\label{exr-thermalkamera}

\textbf{Einzelne Temperaturmessung}

\begin{itemize}
\tightlist
\item
  FÃ¼hre das Beispiel \texttt{average\_temperature.py} aus und beobachte
  die Messwerte.
\item
  Teste das Script mit unterschiedlichen warmen Objekten (z.B.
  Kaffeetasse, Hand, etc.).
\end{itemize}

\end{exercise}

\section{Aufgabe 2: Thermale Aufnahme mit LCD
Bildschirm}\label{aufgabe-2-thermale-aufnahme-mit-lcd-bildschirm}

Folgende Aufgabe nutzt den 1.54'' LCD Bildschirm mit einer 240x240 Pixel
AuflÃ¶sung. Der Ordner enthÃ¤lt mehrere Beispiele zur Thermalkamera, die
die Temperaturmatrix auf dem Bildschirm anzeigen. Die Beispiele sind im
Ordner \texttt{MLX90640} zu finden.

\begin{figure}

\centering{

\includegraphics{images/MLX90640_LCD.jpg}

}

\caption{\label{fig-mlx90640-LCD}Aufbau der Versuchsanordnung fÃ¼r die
Distanzmessung mit dem LCD Bildschirm montiert im dem \emph{hinteren}
SPI Slot}

\end{figure}%

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Kontrolliert mit \texttt{python\ -c\ "import\ st7789"} ob die Library
  \emph{st7789} installiert ist. Installiere die Library mit in der
  aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ st7789}, falls sie nicht installiert ist. Testet
  auch, ob die Bibliotheken \texttt{numpy} und \texttt{matplotlib}
  installiert sind und installiert diese ansonsten mit
  \texttt{sudo\ apt\ install\ python3-matplotlib\ python3-numpy}.
\item
  Kontrolliere, ob der Raspberry Pi den \emph{Breakout Garden HAT} mit
  den 2 SPI AnschlÃ¼ssen und 4 I2C AnschlÃ¼ssen bestÃ¼ckt ist
  (Abb.~\ref{fig-mlx90640-LCD}).
\item
  Montiere den Bildschirm im vorderen SPI Slot des \emph{Breakout Garden
  HAT}s wie in Abb.~\ref{fig-mlx90640-LCD}, oder passe das Script, an so
  dass die Werte der hinteren SPI Schnittstelle verwendet werden.
\item
  Teste die Beispiele im Ordner \texttt{MLX90640} und beobachte die
  Ausgabe auf dem LCD Bildschirm.
\end{itemize}

\begin{exercise}[]\protect\hypertarget{exr-thermalkamera-LCD}{}\label{exr-thermalkamera-LCD}

\textbf{Experimente mit der Thermalkamera und dem LCD Bildschirm}

\begin{itemize}
\tightlist
\item
  Teste mit unterschiedlichen Objekten die Temperaturmessung und
  beobachte die Ausgabe auf dem LCD Bildschirm.
\item
  Wie gut lassen sich Objekte mit unterschiedlichen Temperaturen
  unterscheiden?
\item
  Wie gut lassen sich Objekte erkennen, die sich in der Temperatur nur
  wenig oder stark unterscheiden?
\item
  Studiere den Code der Beispiele und versuche die Funktionsweise zu
  verstehen.
\item
  Ãberlege Dir, wie Du die Beispiele erweitern kÃ¶nntest.
\end{itemize}

\end{exercise}

\chapter{Biometrie}\label{biometrie}

Biometrische Messungen ermÃ¶glichen die Erfassung von physiologischen
Daten wie Herzfrequenz oder SauerstoffsÃ¤ttigung. WÃ¤hrend diese Sensoren
nicht typische Sensoren fÃ¼r IoT Projekte sind, kÃ¶nnen sie fÃ¼r spezielle
Anwendungen wie GesundheitsÃ¼berwachung oder Fitness eingesetzt werden.
Diese Ãbung fÃ¼hrt in die biometrischen Messungen mit dem MAX30101 Sensor
ein und zeigt wie die Herzfrequenz gemessen werden kann.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung-5}

Ziel dieser Ãbung ist es biometrische Messungen mit dem \emph{MAX30101}
Sensor durchzufÃ¼hren und den Sensor in seiner funktionsweise zu
untersuchen. Der \emph{MAX30101} ist ein Sensor zur Messung der
Herzfrequenz und der SauerstoffsÃ¤ttigung im Blut und ein
Rauch-/Partikelsensor. Er verfÃ¼gt Ã¼ber eine I2C Schnittstelle und kann
Ã¼ber eine Python Library angesteuert werden.

\textbf{Unterlagen:} \emph{ E06\_Biometrie.zip}

\textbf{Vorbereitung}

\begin{itemize}
\tightlist
\item
  Schaut Euch folgendes von Video von Peter Charlton zur Funktionsweise
  der Herzfrequenzmessung an:
  \href{https://www.youtube.com/embed/HnXDvN4WNX8?si=EeIAlSWW2Z1SJBof}{Photoplethysmography
  in a minute (and a bit) - Peter Charlton}
\item
  Studiere das Datenblatt zum MAX30101
  (\citeproc{ref-maximintegrated2020}{maxim integrated, 2020})

  \begin{itemize}
  \tightlist
  \item
    In welchen Temperaturbereichen kann der Sensor eingesetzt werden?
  \item
    Welches ist die hÃ¶chste Abtastrate fÃ¼r die Sauerstoffmessungen?
  \item
    Was sind Anwendungsgebiete fÃ¼r diesen Sensor?
  \end{itemize}
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/youtube_photoplethysmography.png}

}

\caption{Photoplethysmography in a minute (and a bit) - Peter Charlton
\href{https://www.youtube.com/embed/HnXDvN4WNX8?si=EeIAlSWW2Z1SJBof}{Youtube
Video}}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.1429}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.8571}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Unterlagen}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Produkt &
\href{https://shop.pimoroni.com/products/max30101-breakout-heart-rate-oximeter-smoke-sensor}{MAX30101
Breakout} \\
Datenblatt &
\href{https://datasheets.maximintegrated.com/en/ds/MAX30101.pdf}{MAX30101} \\
GitHub &
\href{https://github.com/pimoroni/max30105-python}{max30105-python} \\
\end{longtable}

\section{\texorpdfstring{MAX30101 Breakout Heart Rate, Oximeter, Smoke
Sensor\index{MAX30101}}{MAX30101 Breakout Heart Rate, Oximeter, Smoke Sensor}}\label{max30101-breakout-heart-rate-oximeter-smoke-sensor}

Der MAX30101 ist hochentwickelter Herzfrequenz-, Oximeter- und
Rauch-/Partikelsensor. Der Sensor verfÃ¼gt Ã¼ber drei LEDs (rot, grÃ¼n, IR)
und Photodetektoren. Mit der Photoplethysmographie (photoplethysmography
PPG) kann Ã¼ber die FarbverÃ¤nderung der Haut bei jedem Herzschlag dieser
detektiert werden, wenn der Sensor leicht auf den Finger gedrÃ¼ckt wird.
Der Sensor kann auch dazu benutzt werden um Partikel in der Luft wie
rauch zu erkennen, in dem er die Lichtmenge, die von Partikeln in der
Luft zurÃ¼ckgeworfen wird misst.

MAX30101 Breakout - Heart Rate, Oximeter, Smoke Sensor Breakout

\begin{itemize}
\tightlist
\item
  MAX30101 - heart rate, oximeter, smoke sensor
\item
  Green, red, and infra-red LEDs
\item
  Photodetectors
\item
  Ambient light rejection
\item
  Temperature sensor
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/MAX30101_wide.jpg}

}

\caption{\label{fig-MAX30101}links: MAX30101 Breakout von Pimoroni,
rechts: funktionale Diagram des MAX30101 Moduls Quelle: maxim integrated
(\citeproc{ref-maximintegrated2020}{2020})}

\end{figure}%

\section{Ãbungsaufbau}\label{uxfcbungsaufbau-5}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{MAX30101}, in welchem Du Ãnderungen und neue Dateien
  fÃ¼r diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{MAX30101} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle korrekt an (siehe
  \href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t}), so dass die
  Beschriftung der AnschlÃ¼sse am Sensor und bei der Schnittstelle
  Ã¼bereinstimmen.
\item
  Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
  Pi mit dem Sensor verbunden ist. Der Sensor sollte auf der Adresse
  \texttt{0x29} erkannt werden.
\item
  Kontrolliere, ob die Library \texttt{vl53l5cx\_ctypes} installiert ist
  mit \texttt{python\ -c\ "import\ vl53l5cx\_ctypes"}. Installiere die
  Library mit in der aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ vl53l5cx\_ctypes}, falls sie nicht installiert
  ist
\end{itemize}

Wechsle in den Ordner \emph{Documents} und kopiere mit folgenden
Befehlen die Library auf Deinen Raspberry Pi.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ Documents}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/max30105{-}python}
\BuiltInTok{cd}\NormalTok{ max30105{-}python/examples}
\end{Highlighting}
\end{Shaded}

\section{Aufgabe 1: Biometriemessung
Konsole}\label{aufgabe-1-biometriemessung-konsole}

Teste das Beispiel \texttt{read-heartbeat.py} im Ordner \emph{examples}.
Dieses Beispiel liest die PulsschlÃ¤ge pro Minute in PPM (beats per
minute). Ein erkannter Pulsschlag wird mit einem \texttt{\textless{}3}
angezeigt.

Startet das Script mit \texttt{python\ read-heartbeat.py}. Mit
\texttt{Ctrl+c} kann das Script wieder gestopppt wrden. Die Ausgabe
sollte in etwa so aussehen (gekÃ¼rzt):

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ read{-}heartbeat.py }
\ExtensionTok{NOTE!}\NormalTok{ This code should not be used for medical diagnosis. }
\ExtensionTok{...}
\ExtensionTok{Starting}\NormalTok{ readings in 10 seconds...}

   \ExtensionTok{BPM:}\NormalTok{ 0.00  AVG: 0.00}
   \ExtensionTok{BPM:}\NormalTok{ 0.00  AVG: 0.00}
   \ExtensionTok{BPM:}\NormalTok{ 0.00  AVG: 0.00}
   \ExtensionTok{BPM:}\NormalTok{ 0.00  AVG: 0.00}
   \ExtensionTok{BPM:}\NormalTok{ 45.55  AVG: 45.96}
\OperatorTok{\textless{}}\NormalTok{3 }\ExtensionTok{BPM:}\NormalTok{ 55.75  AVG: 59.90}
   \ExtensionTok{BPM:}\NormalTok{ 55.75  AVG: 59.90}
\OperatorTok{\textless{}}\NormalTok{3 }\ExtensionTok{BPM:}\NormalTok{ 59.64  AVG: 70.65}
   \ExtensionTok{BPM:}\NormalTok{ 59.64  AVG: 70.65}
\end{Highlighting}
\end{Shaded}

Folgendes Code Snippet zeigt eine gekÃ¼rtzte Version des
\texttt{read-heartbeat.py} Python Beispiels fÃ¼r die Ausgabe des
Herzschlags.

\phantomsection\label{annotated-cell-32}%
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/usr/bin/env python}

\CommentTok{\# }\AlertTok{NOTE}\CommentTok{! This code should not be used for medical diagnosis. It\textquotesingle{}s}
\CommentTok{\# for fun/novelty use only, so bear that in mind while using it.}

\ImportTok{import}\NormalTok{ time}
\ImportTok{from}\NormalTok{ max30105 }\ImportTok{import}\NormalTok{ MAX30105, HeartRate}

\NormalTok{max30105 }\OperatorTok{=}\NormalTok{ MAX30105() }\hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{max30105.setup(leds\_enable}\OperatorTok{=}\DecValTok{2}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{2}}
\NormalTok{max30105.set\_led\_pulse\_amplitude(}\DecValTok{1}\NormalTok{, }\FloatTok{0.2}\NormalTok{) }
\NormalTok{max30105.set\_led\_pulse\_amplitude(}\DecValTok{2}\NormalTok{, }\FloatTok{12.5}\NormalTok{) }
\NormalTok{max30105.set\_led\_pulse\_amplitude(}\DecValTok{3}\NormalTok{, }\DecValTok{0}\NormalTok{) }
\NormalTok{max30105.set\_slot\_mode(}\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{) }
\NormalTok{max30105.set\_slot\_mode(}\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}ir\textquotesingle{}}\NormalTok{) }
\NormalTok{max30105.set\_slot\_mode(}\DecValTok{3}\NormalTok{, }\StringTok{\textquotesingle{}off\textquotesingle{}}\NormalTok{) }
\NormalTok{max30105.set\_slot\_mode(}\DecValTok{4}\NormalTok{, }\StringTok{\textquotesingle{}off\textquotesingle{}}\NormalTok{) }

\KeywordTok{def}\NormalTok{ display\_heartrate(beat, bpm, avg\_bpm): }\hspace*{\fill}\NormalTok{\circled{3}}
    \BuiltInTok{print}\NormalTok{(}\StringTok{"}\SpecialCharTok{\{\}}\StringTok{ BPM: }\SpecialCharTok{\{:.2f\}}\StringTok{  AVG: }\SpecialCharTok{\{:.2f\}}\StringTok{"}\NormalTok{.}\BuiltInTok{format}\NormalTok{(}\StringTok{"\textless{}3"} \ControlFlowTok{if}\NormalTok{ beat }\ControlFlowTok{else} \StringTok{"  "}\NormalTok{,}
\NormalTok{          bpm, avg\_bpm))}
\NormalTok{hr }\OperatorTok{=}\NormalTok{ HeartRate(max30105) }\hspace*{\fill}\NormalTok{\circled{4}}

\NormalTok{delay }\OperatorTok{=} \DecValTok{10} \hspace*{\fill}\NormalTok{\circled{5}}
\BuiltInTok{print}\NormalTok{(}\StringTok{"Starting readings in }\SpecialCharTok{\{\}}\StringTok{ seconds...}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{.}\BuiltInTok{format}\NormalTok{(delay)) }
\NormalTok{time.sleep(delay) }

\ControlFlowTok{try}\NormalTok{:}
\NormalTok{    hr.on\_beat(display\_heartrate, average\_over}\OperatorTok{=}\DecValTok{4}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{6}}
\ControlFlowTok{except} \PreprocessorTok{KeyboardInterrupt}\NormalTok{:}
    \ControlFlowTok{pass}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Sensor initialisieren
\item[\circled{2}]
Sensor konfigurieren (LED Pulse Amplitude, Slot Mode der LED)
\item[\circled{3}]
Funktion zur Darstellung des Herzschlags in der Konsole
\item[\circled{4}]
Initialisierung des Herzschlagdetektors
\item[\circled{5}]
10 Sekeunden warten und dann die HerzschlÃ¤ge ausgeben
\item[\circled{6}]
Bei einem erkannten Herzschlag wird die Funktion
\texttt{display\_heartrate} aufgerufen und der Herzschlag wird Ã¼ber 4
Sekunden gemittelt in der Konsole ausgegeben.
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-pulsmessung}{}\label{exr-pulsmessung}

\textbf{Pulsmessung}

\begin{itemize}
\tightlist
\item
  FÃ¼hre das Beispiel \texttt{read-heartbeat.py} aus und beobachte die
  Messwerte.
\item
  FÃ¼hre unterschiedliche Tests durch und behandle den Sensor freundlich.
\item
  Vergleiche die Messwerte und kontrolliere die Werte in dem Du den
  eigenen Puls misst oder mit einem Sportuhr vergleichst.
\item
  Studiere den Code der Beispiele und versuche die Funktionsweise zu
  verstehen.
\end{itemize}

\end{exercise}

\chapter{IoT Monitoring}\label{iot-monitoring}

IoT Monitoring ermÃ¶glicht die Erfassung von Sensordaten, die
Kommunikation und Visualisierung von Daten in Echtzeit. Dies erfordert
eine Architektur, die die Daten erfasst, Echtzeitkommunikation,
asynchroner Kommunikation, Datenspeicherung und Visualisierung
ermÃ¶glicht. Diese Ãbung baut einen typischen IoT Stack auf mit MQTT,
Node-Red, InfluxDB und Grafana und zeigt wie Sensordaten Ã¼ber MQTT
publiziert und abonniert werden kÃ¶nnen.

\hfill\break

\section{EinfÃ¼hrung}\label{einfuxfchrung-6}

Ein IoT Datenfluss erstreckt sich Ã¼ber verschiedene Instanzen, die fÃ¼r
die einzelnen Prozesse zustÃ¤ndig sind, von der Erfassung von
Sensormesswerten im IoT GerÃ¤t Ã¼ber die Kommunikation der Messwerte bis
zur Datenverarbeitung, Speicherung und Visualisierung
(Abb.~\ref{fig-iotpipeline}). Hierbei kÃ¶nnen alle Schritte auf einem
GerÃ¤t durchgefÃ¼hrt werden oder jeder einzelne Ã¼ber ein anderes GerÃ¤t
oder Server. In der Abbildung aufgezeigt sind typische
Softwarekomponenten, die in IoT eingesetzt werden, wie Node-Red fÃ¼r die
Datenverarbeitung, die InfluxDB Datenbank, welche fÃ¼r das Speichern von
Zeitreihendaten entwickelt wurde und Grafana eine
Visualisierungsplattform, die fÃ¼r Messdaten optimiert ist. Es sind
Werkzeuge die Ã¼ber ihre graphische OberflÃ¤che einen guten Einstieg
ermÃ¶glichen, sogenannte \emph{low-code} Tools, die sich gut eignen fÃ¼r
die Entwicklung von Prototypen mit geringem zeitlichen Aufwand. Je nach
Anwendung kÃ¶nnen die einzelnen Prozessschritte auch gut in einer
Scriptsprache wie Python durchgefÃ¼hrt oder eine andere Datenbank
verwendet werden.

\begin{figure}

\centering{

\includegraphics{images/mqtt-node-red-inffluxdb-grafana.jpg}

}

\caption{\label{fig-iotpipeline}Typischer IoT Datenfluss und
Verarbeitung Ã¼ber diverse Instanzen, von dem IoT GerÃ¤t mit Sensorik,
Datenkommunikation mit MQTT und dem MQTT Broker, zur Datenprozessierung
mit Node-Red, Datenspeicherung und und Visalisierung.}

\end{figure}%

Ziel dieser Ãbung ist es MQTT nÃ¤her kennenzulernen und die MQTT
Kommunikation mit dem Raspberry Pi zu testen. MQTT ist ein
leichtgewichtiges Kommunikationsprotokoll, welches das
\emph{Publish-Subscribe} Muster verwendet und sich gut fÃ¼r die Anwendung
in IoT Projekten geeignet.

\textbf{Unterlagen:} \emph{ E07\_MQTT.zip}

\section{Ãbungsaufbau}\label{uxfcbungsaufbau-6}

\begin{itemize}
\tightlist
\item
  Schliesse den Raspberry Pi an Monitor, Keyboard und Maus an oder
  verbinde Dich mit diesem Ã¼ber SSH (und SFTP).
\item
  Erstelle auf dem Raspberry Pi im \texttt{Documents} Ordner einen neuen
  Ordner \texttt{mqtt}, in welchem Du Ãnderungen und neue Dateien fÃ¼r
  diese Ãbung speichern kannst.
\item
  Schliesse den Sensor \textbf{BME688} an den Raspberry Pi Ã¼ber die
  Breakout Garden \textbf{I2C} Schnittstelle korrekt an (siehe
  \href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t}), so dass die
  Beschriftung der AnschlÃ¼sse am Sensor und bei der Schnittstelle
  Ã¼bereinstimmen.
\item
  Kontrolliere mit dem Befehl \texttt{i2cdetect\ -y\ 1} ob der Raspberry
  Pi mit dem Sensor verbunden ist. Der Sensor sollte auf der Adresse
  \texttt{0x76} erkannt werden.
\item
  Kontrolliere, ob die Library \texttt{bme680} installiert ist mit
  \texttt{python\ -c\ "import\ bme680"}. Installiere die Library mit in
  der aktivierten virtuellen Environment
  \texttt{source\ \textasciitilde{}/.env/bin/activate} mit
  \texttt{pip\ install\ bme680}, falls sie nicht installiert ist.
\item
  Wechsle in den Ordner \emph{Documents} und erstelle einen Ordner
  \emph{mqtt} fÃ¼r diese Ãbung.
\end{itemize}

\section{Aufgabe 1: MQTT
kennenlernen}\label{aufgabe-1-mqtt-kennenlernen}

\href{https://mosquitto.org}{Mosquitto} ist eine kompakter open-source
Message Broker der Eclipse Foundation, welcher das MQTT Protokoll
implementiert und auf Produktionsserver, wie auch auf stromsparenden
GerÃ¤ten wie dem Raspberry Pi eingesetzt werden kann. Wir testen die
Kommunikation mit dem MQTT Broker und den Clients auf dem Raspberry Pi.
Der Mosquitto Broker ist auf dem Raspberry Pi Image vorkonfiguriert und
lÃ¤uft als Service im Hintegrund. Die Clients \texttt{mosquitto\_pub} und
\texttt{mosquitto\_sub} sind ebenfalls installiert und kÃ¶nnen fÃ¼r das
Testen der Kommunikation MQTT verwendet werden. Mosquitto Dokumentation:
\url{https://mosquitto.org/documentation}

\begin{figure}[H]

{\centering \includegraphics{images/mqtt-publish-subscribe.jpg}

}

\caption{MQTT Device publiziert an den MQTT Broker Ã¼ber ein definiertes
Topic Messdaten. Der Broker publiziert die Daten Ã¼ber die definierten
Topics. Diese werden vom Subscriber abonniert und empfangen mit dem
Vorteil, dass keines der GerÃ¤te zur gleichen Zeit synchron senden und
empfangen muss.}

\end{figure}%

Erstelle einen Subscriber der fÃ¼r das Topic \texttt{iot/temperature}
eine Subscription erstellt.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{mosquitto\_sub} \AttributeTok{{-}h}\NormalTok{ 127.0.0.1 }\AttributeTok{{-}v} \AttributeTok{{-}t} \StringTok{\textquotesingle{}iot/temperature\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Ãffne ein zweite Shell und erstelle einen Publisher fÃ¼r dasselbe Topic

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{mosquitto\_pub} \AttributeTok{{-}h}\NormalTok{ 127.0.0.1 }\AttributeTok{{-}t} \StringTok{\textquotesingle{}iot/temperature\textquotesingle{}} \AttributeTok{{-}m} \StringTok{\textquotesingle{}Aussentemperatur: 22Â° Celsius\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[MQTT Message]
Die MQTT Nachrichten (Messages) bestehen aus einem \emph{Topic} (Thema)
und einer \emph{Payload} dem Nachrichteninhalt.
\item[MQTT Topics]
MQTT verwendet Themen (Topic) und hierarchische Themenebenden getrennt
Ã¼ber einem SchrÃ¤gstrich \texttt{/} Ã¤hnlich einem Ordnersystem auf einem
Computer. Dies ermÃ¶glicht eine Strukturierung und auch Filterung der
Messages. Topics sind case-sensitive, sollten nicht mit einem
\texttt{/}, \texttt{\$} beginnen und keine Leerzeichen enthalten, sowie
kurz und aussagekrÃ¤ftig sein. Filtern von Topics ist mit dem Wildcard
\texttt{+} fÃ¼r ein einzelnes Thema und \texttt{\#} fÃ¼r alle Themen
mÃ¶glich\footnote{Topics, die mit \texttt{\$} beginnen sind reserviert
  fÃ¼r interne Informationen des Brokers und Clientstatistiken, oft in
  der Form \texttt{\$SYS/}. Beispielsweise zeigt
  \texttt{\$SYS/broker/clients/connected} die Anzahl der verbundenen
  Clients. Mit dem Wildcard \texttt{\#} Filter kÃ¶nnt Ihr mit
  \texttt{\$SYS/\#} alle Systeminformationen der Brokers anzeigen
  lassen.}.
\item[MQTT Payload]
Die Nachrichten (Messages) die Ã¼ber MQTT Ã¼bertragen werden, werden als
Payload bezeichnet. Diese Payload ist nicht an eine bestimmte Struktur
gebunden und kann ein Text- oder BinÃ¤rformat sein. Eine festgelegte
Struktur fÃ¼r die Payload ist jedoch sinnvoll fÃ¼r eine reibungslose
Datenverarbeitung beispielsweise im JSON Format. Ãbliche Fromate sind
Text, JSON, BinÃ¤rdaten, Hex Strings oder auch Protocol Buffer.
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-mqtt}{}\label{exr-mqtt}

~

\begin{itemize}
\tightlist
\item
  Teste nun den MQTT mit unterschiedlichen Topics und Nachrichten.
\item
  Teste einen weiteren Mosquitto Server auf einem anderen Raspberry Pi
  und teste die Kommunikation. Hierbei muss die IP Adresse entsprechend
  angepasst werden.
\item
  Einigt Euch auf einen MQTT Broker und eine Topic-Struktur
  beispielweise \texttt{iot/temperature} und \texttt{iot/humidity} und
  publiziert und abonniert Nachrichten. Was fÃ¤llt Euch auf, wenn Ihr die
  Nachrichten empfÃ¤ngt?
\item
  Welche Angaben sollten zusÃ¤tzlich zu den Messwerten in der Payload der
  Nachrichten enthalten sein?
\end{itemize}

\end{exercise}

Falls der Mosquitto Brokers und Clients nicht installiert sind, kÃ¶nnen
diese mit folgenden Befehlen installiert werden.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sudo}\NormalTok{ apt install mosquitto }\AttributeTok{{-}y}
\FunctionTok{sudo}\NormalTok{ apt install mosquitto{-}clients }\AttributeTok{{-}y}
\FunctionTok{sudo}\NormalTok{ systemctl enable mosquitto.service}
\FunctionTok{sudo}\NormalTok{ systemctl status mosquitto}
\end{Highlighting}
\end{Shaded}

\begin{boxtitle}{Hinweis}{colPrimary}

\href{https://apps.microsoft.com/detail/9NBLGGH55JZG}{MQTTBox} und
\href{https://mqtt-explorer.com}{MQTT Explorer} sind zwei MQTT Clients,
die fÃ¼r die Entwicklung und das Testen von MQTT Applikationen verwendet
werden kÃ¶nnen. Jedoch scheinen diese nicht mehr oder eher sporadisch
weiterentwickelt zu werden.

\end{boxtitle}

\section{Aufgabe 2: MQTT mit Python
verwenden}\label{aufgabe-2-mqtt-mit-python-verwenden}

Nun verwenden wir die Bibliothek \texttt{paho-mqtt} in Python um MQTT
Messages zu senden oder empfangen. Folgende zwei Code Snippets zeigen
wie ein Publisher und Subscriber in Python minimal implementiert werden
kÃ¶nnen.

\begin{figure}[H]

{\centering \includegraphics{images/mqtt-sensor-subscribe.jpg}

}

\caption{Device sendet Sensordaten und Topic an den MQTT Broker, ein
weiteres GerÃ¤t abonniert (subscribe) dieses Topic und kann so die
gesendeten Daten an das entsprechende Topic empfangen. In dieser Ãbung
Ã¼ber ein Python Script fÃ¼r \emph{Publish} und \emph{Subscribe}}

\end{figure}%

\textbf{Script 1:} \texttt{mqtt\_sub.py} - Subscriber

\phantomsection\label{annotated-cell-37}%
\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ paho.mqtt.client }\ImportTok{as}\NormalTok{ mqtt }
\NormalTok{ip }\OperatorTok{=} \StringTok{"127.0.0.1"} \hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{topic }\OperatorTok{=} \StringTok{"iot/temperature"} \hspace*{\fill}\NormalTok{\circled{2}}

\CommentTok{\# Callback Funktion fÃ¼r den Verbindungsaufbau}
\KeywordTok{def}\NormalTok{ on\_connect(client, userdata, flags, rc): }\hspace*{\fill}\NormalTok{\circled{3}}
    \BuiltInTok{print}\NormalTok{(}\StringTok{"Connected {-} code: "}\OperatorTok{+}\BuiltInTok{str}\NormalTok{(rc)) }
\NormalTok{    client.subscribe(topic) }\hspace*{\fill}\NormalTok{\circled{4}}
  
\CommentTok{\# Callback Funktion fÃ¼r eingehende Nachrichten}
\KeywordTok{def}\NormalTok{ on\_message(client, userdata, msg): }\hspace*{\fill}\NormalTok{\circled{5}}
    \BuiltInTok{print}\NormalTok{(msg.topic}\OperatorTok{+}\StringTok{" "}\OperatorTok{+}\BuiltInTok{str}\NormalTok{(msg.payload)) }
  
\CommentTok{\# Erstellen des MQTT Clients}
\NormalTok{client }\OperatorTok{=}\NormalTok{ mqtt.Client() }\hspace*{\fill}\NormalTok{\circled{6}}
\NormalTok{client.on\_connect }\OperatorTok{=}\NormalTok{ on\_connect }
\NormalTok{client.on\_message }\OperatorTok{=}\NormalTok{ on\_message }
\NormalTok{client.}\ExtensionTok{connect}\NormalTok{(ip, }\DecValTok{1883}\NormalTok{, }\DecValTok{60}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{7}}
\NormalTok{client.loop\_forever() }
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
IP Adresse des MQTT Brokers
\item[\circled{2}]
Topic auf welches der Subscriber hÃ¶rt
\item[\circled{3}]
Callback Funktion on\_connect wird ausgefÃ¼hrt, wenn die Verbidnung steht
\item[\circled{4}]
Subscription fÃ¼r das Topic
\item[\circled{5}]
Callback Funktion on\_publish wird ausgefÃ¼hrt, wenn eine Nachricht
empfangen (publish) wird
\item[\circled{6}]
Erstellen eines MQTT Clients und Zuweisung der Callback Funktionen
\item[\circled{7}]
Verbindung zum MQTT Broker herstellen und auf eingehende Nachrichten
warten (loop\_forever)
\end{description}

\textbf{Script 2: }\texttt{mqtt\_pub.py} - Publisher

\phantomsection\label{annotated-cell-38}%
\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ paho.mqtt.publish }\ImportTok{as}\NormalTok{ publish }
\NormalTok{ip }\OperatorTok{=} \StringTok{"127.0.0.1"} \hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{topic }\OperatorTok{=} \StringTok{"iot/temperature"} 
\NormalTok{publish.single(topic, }\StringTok{"22.0"}\NormalTok{, hostname}\OperatorTok{=}\NormalTok{ip, port}\OperatorTok{=}\DecValTok{1883}\NormalTok{) }\hspace*{\fill}\NormalTok{\circled{2}}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
IP Adresse des MQTT Brokers und Topic definieren
\item[\circled{2}]
Nachricht mit Topic an den MQTT Broker (ip,port) senden
\end{description}

\begin{exercise}[]\protect\hypertarget{exr-mqtt-python}{}\label{exr-mqtt-python}

~

\begin{itemize}
\tightlist
\item
  Speichere die beiden Dateien \texttt{mqtt\_pub.py} und
  \texttt{mqtt\_sub.py} im Ordner \texttt{mqtt} ab.
\item
  (Optional: Passe die IP Adresse des MQTT Brokers an, falls ein anderer
  MQTT Broker genutzt werden soll.)
\item
  Ãffne zwei Terminals und fÃ¼hre diese mit \texttt{python\ mqtt\_pub.py}
  und \texttt{python\ mqtt\_sub.py} aus.
\end{itemize}

\end{exercise}

Falls die Library paho-mqtt nicht installiert ist, kann diese in der
aktivierten virtuellen Environment
\texttt{source\ \textasciitilde{}/.env/bin/activate} mit
\texttt{pip\ install\ paho-mqtt}.

\section{Aufgabe 3: Sensordaten mit MQTT
Ã¼bertragen}\label{aufgabe-3-sensordaten-mit-mqtt-uxfcbertragen}

Passe nun das Script \texttt{mqtt\_pub.py} an, so dass die Temperatur
vom Sensor \texttt{BME688} ausgelesen und Ã¼ber MQTT Ã¼bertragen wird. Die
Temperatur soll alle 10 Sekunden Ã¼bertragen werden. Nutze hierfÃ¼r das
Script zum Auslesen der Sensordaten aus der Ãbung
\href{E01_Luftqualitaet.qmd}{E01 LuftqualitÃ¤t} und passe dieses an.

\begin{exercise}[]\protect\hypertarget{exr-mqtt-bme688}{}\label{exr-mqtt-bme688}

~

\begin{itemize}
\tightlist
\item
  Speichere das \texttt{mqtt\_pub.py} als \texttt{mqtt\_pub\_bme688.py}
  im Ordner \texttt{mqtt} ab.
\item
  ErgÃ¤nze das Script um die Funktionen zum auslesen der Temperatur des
  BME688 Sensors.
\item
  ErgÃ¤nze das Script fÃ¼r das Auslesen der Luftfeuchtigkeit und Luftdruck
  und ergÃ¤nze die topics mit \texttt{iot/humidity} und
  \texttt{iot/pressure}.
\item
  Erweitere das Script \texttt{mqtt\_sub.py} um die Subscription fÃ¼r die
  Topics \texttt{iot/humidity} und \texttt{iot/pressure} und speichere
  es als \texttt{mqtt\_sub\_bme688.py} ab.
\item
  Ãffne zwei Terminals und fÃ¼hre diese mit
  \texttt{python\ mqtt\_pub\_bme688.py} und
  \texttt{python\ mqtt\_sub\_bme688.py} aus.
\end{itemize}

\end{exercise}

\section{Aufgabe 4: MQTT mit Node-RED
verwenden}\label{aufgabe-4-mqtt-mit-node-red-verwenden}

Node-Red\index{Node-Red} ist ein grafisches Entwicklungswerkzeug fÃ¼r
IoT, ein low-code Tool fÃ¼r \emph{event-driven applications}. Es bietet
eine browserbasierte und datenstromorientierte ``Flow'' Programmierung
fÃ¼r die Verarbeitung von Sensordaten (Ã¤hnlich wie FME oder graphische
Modellierungswerkzeuge in GIS). Die Implementation von Node-Red ist in
JavaScript und basiert auf node.js. Datenverarbeitungsflows kÃ¶nnen
gespeichert und wiederverwendet werden. Im Arbeitsbereich
(Abb.~\ref{fig-noderedmqttflow}) kÃ¶nnen sogenannte Nodes, die
unterschiedliche Funktionen erfÃ¼llen, zu einem Daten-``Flow'' werden.
Nodes kÃ¶nnen auch selbst erstellt werden. Es gibt eine Vielzahl von
Nodes, die von der Community entwickelt wurden, die Ã¼ber den Node-Red
Palette Manager installiert werden kÃ¶nnen. Core Nodes von Node-Red sind:

\begin{itemize}
\tightlist
\item
  \textbf{Inject Node}: Kann einen Flow Ã¼ber den Button direkt auslÃ¶sen
  oder in regelmÃ¤ssigen AbstÃ¤nden mit Zeitstempel oder vordefinierten
  Nachrichten (msg) senden.
\item
  \textbf{Debug Node}: Kann die
  \href{https://nodered.org/docs/user-guide/messages}{Nachrichten} (msg)
  in Debug Sidebar anzeigen lassen.
\item
  \textbf{Function Node}: Kann mit JavaScript
  \href{https://nodered.org/docs/user-guide/writing-functions}{Funktionen}
  den Inhalt der Nachrichten (msg) verÃ¤ndern.
\item
  \textbf{Change Node}: ErmÃ¶glicht das Ãndern von Eigenschaften einer
  Nachricht (ohne den Funktion Node zu nÃ¼tzen) um beispielsweise
  Eigenschaften zu setzen, Ã¤ndern oder lÃ¶schen.
\item
  \textbf{Switch Node}: Kann Nachrichten (msg) anhand von Regeln
  auswerten in verschiedene AusgÃ¤nge leiten (wie ein Switch Case in der
  Programmierung).
\item
  \textbf{Template Node}: Kann Ã¼ber Eigenschaften einer Nachricht und
  einer Vorlage (Template) neue Nachricht nach Vorlage erstellen:
  \texttt{Nachricht:\ \{\{payload\}\}!} wird
  \texttt{Nachricht:\ 1570439577309\ !}.
\end{itemize}

Node-Red kann Ã¼ber den Browser auf dem Raspberry Pi oder via Laptop
gestartet werden. Ãffne den Browser und gebe die IP Adresse des
Raspberry Pi mit dem Port 1880 ein:
\texttt{http://\textless{}ip-adresse\textgreater{}:1880}. FÃ¼hrt nun das
Kurztutorial zu Node-Red aus:
\href{https://nodered.org/docs/getting-started/first-flow}{Node-Red
Getting Started: First Flow}. In diesem Tutorial wird ein Flow erstellt,
der eine Nachricht mit einem Zeitstempel ausgibt.

\begin{figure}

\centering{

\includegraphics{images/node-red_mqtt_flow.png}

}

\caption{\label{fig-noderedmqttflow}Node-Red Flow der Daten in das Topic
\emph{iot/temperature} published, und Nachrichten aus dem Topic
\emph{iot/temperature} subscribed.}

\end{figure}%

\begin{exercise}[]\protect\hypertarget{exr-nodered-flow}{}\label{exr-nodered-flow}

Erstelle einen Flow der Nachrichten an den MQTT Broker senden und
Nachrichten vom MQTT Broker empfangen kann.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  FÃ¼ge hierfÃ¼r einen Inject Node, einen Debug Node und einen MQTT Output
  Node hinzu. Ãffne die Einstellungen des MQTT Output Nodes (siehe
  Abb.~\ref{fig-noderedmqttnodesetup}) und setze die IP Adresse des MQTT
  Brokers und das Topic auf \texttt{iot/temperature}. Starte den Flow
  und Ã¼berprÃ¼fe, ob die Nachrichten an den MQTT Broker gesendet werden.
\item
  Erstelle nun einen weiteren Flow, der die Nachrichten vom MQTT Broker
  empfÃ¤ngt und in der Debug Sidebar anzeigt. FÃ¼ge hierfÃ¼r einen MQTT
  Input Node (siehe Abb.~\ref{fig-noderedmqttnodesetup}) und einen Debug
  Node hinzu. Ãffne die Einstellungen des MQTT Input Nodes und setze die
  IP Adresse des MQTT Brokers und das Topic auf
  \texttt{iot/temperature}. Starte den Flow und Ã¼berprÃ¼fe, ob die
  Nachrichten vom MQTT Broker empfangen werden.
\item
  ErgÃ¤nze den Flow um einen MQTT Input Node fÃ¼r die Topics
  \texttt{iot/humidity} und \texttt{iot/pressure} und je einen Debug
  Node. Starte den Flow und Ã¼berprÃ¼fe, ob die Nachrichten vom MQTT
  Broker empfangen werden.
\end{enumerate}

\end{exercise}

\begin{figure}

\centering{

\includegraphics{images/node-red_mqtt_setup.jpg}

}

\caption{\label{fig-noderedmqttnodesetup}Node-Red MQTT Node
Einstellungen setzen, (1) Name angeben, (2) Server Einstellungen Ã¶ffnen
und (3) IP Adresse des MQTT Brokers setzen, (4) subscribe to single
topic wÃ¤hlen und (5) Topic \texttt{iot/temperature} setzen.}

\end{figure}%

\begin{boxtitle}{Hinweis}{colPrimary}

Flows stoppen: Um einen Flow in der AusfÃ¼hrung zu stoppen, kann dieser
Ã¼ber den Tab Flow (rechte Maustaste) deaktiviert werden (disable flow)
und mit einem erneuten Ãbernehmen (Deploy) wird der Flow gestoppt.

\end{boxtitle}

\section{Aufgabe 5: Node-Red MQTT mit InfluxDB
verwenden}\label{aufgabe-5-node-red-mqtt-mit-influxdb-verwenden}

InfluxDB ist die Datenbank, die fÃ¼r die Erfassung, Speicherung,
Verarbeitung und Visualisierung von Zeitreihendaten entwickelt wurde.
Zeitreihendaten sind Datenpunkte, die in zeitlicher Sequenz erfasst
wurden und bestehen in der Regele aus aufeinanderfolgenden Messungen aus
derselben Quelle, wie beispielsweise die Temperaturdaten des BME688.

InfluxDB organisiert die Zeitreihendaten in \emph{Buckets} (anstatt
Datenbanken) und Messungen (Measurements). Ein Bucket kann mehrere
Messungen enthalten, wobei Messungen Felder und Tags enthalten kÃ¶nnen
(\citeproc{ref-influxdata2023}{influxdata, 2023}). Eine Messung enthÃ¤lt
\emph{Felder} mit key-value Paaren von Messwerten, die sich Ã¼ber die
Zeit Ã¤ndern. \emph{Tags} sind key-value Paare, die sich nicht Ã¼ber die
Zeit Ã¤ndern und fÃ¼r die Filterung und Gruppierung verwendet werden
kÃ¶nnen.

Das Tutorial
\href{https://docs.influxdata.com/influxdb/v2/get-started/}{Getting
Started} zeigt die ersten Schritte mit InfluxDB.

\begin{figure}[H]

{\centering \includegraphics{images/mqtt-sensor-broker-influxdb.jpg}

}

\caption{IoT Datenfluss mit Node-Red MQTT und InfluxDB. Python Script
publiziert (publish) die Sensormesswerte und das Topic an den MQTT
Broker, NodeRed abonniert (subscribe) ein oder mehrere Topics und
speichert die Sensormesswerte in einer InlfuxDB Datenbank.}

\end{figure}%

Die graphische OberflÃ¤che von InfluxDB kann Ã¼ber den Browser auf dem
Raspberry Pi oder via Laptop gestartet werden. Ãffnet nun den Browser
und gebe die IP Adresse des Raspberry Pi mit dem Port 8086 ein:
\texttt{http://\textless{}ip-adresse\textgreater{}:8086}.

Erstellt Ã¼ber die linke Menuleiste unter \emph{Load Data} einen neuen
Bucket mit dem Namen \texttt{iot}, falls dieser nicht schon existiert.
Kopiert unter \emph{load Data / API Tokens} den Token fÃ¼r den Zugang zur
Datenbank.

Diese Angaben (\emph{bucket} und \emph{API Token}) werden fÃ¼r den
InfluxDB Node in Node-Red benÃ¶tigt. Die Einstellungen des InfluxDB Node
benÃ¶tigen die Angaben, wohin die Daten in der Datenbank gespeichert
werden (links in Abb.~\ref{fig-noderedinfluxdb}) mit Angaben zum Bucket
(Datenbankname), Organisation\footnote{wird bei der Erstellung der
  Datenbank definiert} und measurement und die Serververbindung (rechts
in Abb.~\ref{fig-noderedinfluxdb}) mit der IP Adresse und das Token fÃ¼r
den Zugang zur Datenbank.

\begin{boxtitle}{Hinweis}{colPrimary}

Falls keine Nodes fÃ¼r InfluxDB in Node-Red vorhanden sind, kann die
Erweiterung \texttt{node-red-contrib-influxdb} Ã¼ber das Hauptmenu
\emph{Palette verwalten} im Tab \emph{Installation} installiert werden.

\end{boxtitle}

\begin{figure}

\centering{

\includegraphics{images/node-red_influxdb_setup.jpg}

}

\caption{\label{fig-noderedinfluxdb}Einstellungen der InflxDB Nodes in
Node-Red, links: Einstellungen zur Datenbank (1) mit Angaben zur
Organisation (5), Bucket (6) und Namen der Messung \emph{measurement}
(7), rechts: Einstellungen zur Datenbankverbindung (2) mit der URL und
Port der InfluxDB (3) und dem API Token (4), fÃ¼r den Zugang zur
Datenbank.}

\end{figure}%

Die Messwerte kÃ¶nnen direkt in die InfluxDB geschrieben werden, jedoch
fehlen da noch die Tags, die fÃ¼r die Filterung und Gruppierung verwendet
werden kÃ¶nnen. Diese kÃ¶nnen Ã¼ber den Change Node hinzugefÃ¼gt werden, wie
in Abb.~\ref{fig-noderedpayload} gezeigt. Hierbei wird der Wert der
Payload in ein Feld mit dem Namen \emph{temperature} geschrieben und die
Tags \emph{device} und \emph{sensor} werden hinzugefÃ¼gt. Dieselbe
Struktur kann alternativ auch mit dem Function Node erstellt werden,
siehe Abb.~\ref{fig-noderedpayload} rechts. Hierbei wird der Wert der
Payload in ein Feld mit dem Namen \emph{temperature} geschrieben und die
Tags \emph{device} und \emph{sensor} werden hinzugefÃ¼gt. Die Bezeichnung
der Messung \emph{temperature} wird im InfluxDB Node definiert oder kann
im Function Node Ã¼berschrieben werden.

\begin{figure}

\centering{

\includegraphics{images/node-red_influxdb_change_function_node.jpg}

}

\caption{\label{fig-noderedpayload}Ãber den Change Node, wie auch den
Function Node kann mit JavaScript der Inhalt der Payload verÃ¤ndert
werden und diesen fÃ¼r den Import in die InfluxDB angepasst werden.}

\end{figure}%

\phantomsection\label{annotated-cell-39}%
\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msg}\OperatorTok{.}\AttributeTok{payload} \OperatorTok{=}\NormalTok{ [\{ }
Â  Â  \DataTypeTok{temperature}\OperatorTok{:}\NormalTok{msg}\OperatorTok{.}\AttributeTok{payload} \hspace*{\fill}\NormalTok{\circled{1}}
\NormalTok{\}}\OperatorTok{,}\NormalTok{ \{ }\DataTypeTok{device}\OperatorTok{:}\StringTok{"RPI\_01"}\OperatorTok{,}\DataTypeTok{Â sensor}\OperatorTok{:}\StringTok{"BME688"}\NormalTok{ \}]}\OperatorTok{;} \hspace*{\fill}\NormalTok{\circled{2}}
\NormalTok{msg}\OperatorTok{.}\AttributeTok{measurement}\OperatorTok{=}\StringTok{"temperature"}\OperatorTok{;} \hspace*{\fill}\NormalTok{\circled{3}}
\ControlFlowTok{return}\NormalTok{ msg}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{description}
\tightlist
\item[\circled{1}]
Werte der Payload in Payloadstruktur fÃ¼r die InfluxDB schreiben
\item[\circled{2}]
Tags der Messung zuweisen
\item[\circled{3}]
Optional \emph{measurement} kann im InfluxDB Node oder im
Funktionsknoten definiert werden
\end{description}

InfluxDB bietet Ã¼ber das Menu \emph{Data Explorer} eine einfache
MÃ¶glichkeit die Daten zu visualisieren. Der Query Builder
(Abb.~\ref{fig-influxdbdataexplorer}) hilft bei der Erstellung von
Abfragen mit der Ã¼ber die Fields und Tags gefiltert werden kann, die
dann Ã¼ber den Button \emph{Submit} ausgefÃ¼hrt und dargestellt werden
kÃ¶nnen. Die erstellte Query kann Ã¼ber den \emph{Script Editor}
(Abb.~\ref{fig-influxdbdataexplorer}) angezeigt werden.

\begin{figure}

\centering{

\includegraphics{images/influxdb_data_explorer.png}

}

\caption{\label{fig-influxdbdataexplorer}Ãber den \emph{Data Explorer}
kÃ¶nnen in InfluxDB einfach Abfragen zusammengestellt und Ã¼ber
\emph{submit} visualisiert werden}

\end{figure}%

\begin{exercise}[]\protect\hypertarget{exr-nodered-influxb}{}\label{exr-nodered-influxb}

~

\begin{itemize}
\tightlist
\item
  Erstellt nun einen Flow der die Nachrichten des Topics
  \texttt{iot/temperature} vom MQTT Broker empfÃ¤ngt und in die InfluxDB
  schreibt.
\item
  Erstellt erst einen flow der nur die Nachrichten ohne Tags in die
  InfluxDB schreibt
\item
  ErgÃ¤nzt den Flow mit einem Change oder Function Node um die Tags
  \emph{device} und \emph{sensor} hinzuzufÃ¼gen.
\item
  Visualisiert den Temperaturverlauf des BME688 in der InfluxDB mit dem
  \emph{Data Explorer} und studiert die Flux Abfragesprache.
\item
  Erstellt einen Flow der die Nachrichten der Topics
  \texttt{iot/humidity} und \texttt{iot/pressure} vom MQTT Broker
  empfÃ¤ngt und in die InfluxDB schreibt.
\item
  (Optional) erstellt im Menu \emph{Dashboard} eine Visualisierung der
  Messwerte.
\end{itemize}

\end{exercise}

\section{Aufgabe 6: InfluxDB mit Grafana
verwenden}\label{aufgabe-6-influxdb-mit-grafana-verwenden}

Grafana ist eine Open-Source Anwendung fÃ¼r die grafische Darstellung von
Daten aus den verschiedenen Datenquellen, wie Postgres, SQLite oder
InfluxDB. Ãber Grafana kÃ¶nnen interaktive Dashboards mit vielen
VisualisierungsansÃ¤tzen erstellt werden. In dieser Ãbung wird Grafana
mit der InfluxDB Datenbank verwendet.

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{Monitoring der Lichtverschmutzung am Nachthimmel} TESS
(Telescope Encoder and Sky Sensor) ist ein Photometer
(\citeproc{ref-Zamorano2016}{Zamorano et al., 2016}) fÃ¼r das Stars4All
Citizen Science Projekt mit dem Ziel die Lichtverschmutzung weltweit in
der Nacht zu vermessen, welche nicht nur fÃ¼r die Umwelt problematisch
ist, sondern auch fÃ¼r astronomische Beobachtungen. Die TESS GerÃ¤te
senden von verschiedenen Standorten weltweit ihre Messungen welche Ã¼ber
der folgende Dashboard mit Grafana der Ãffentlichkeit zur VerfÃ¼gung
gestellt werden. Dashboard: \url{https://tess.dashboards.stars4all.eu/},
Messungen der Lichtverschmutzung am Beispiel des Naturparks Gantrisch in
der Schweiz.
\url{https://tess.dashboards.stars4all.eu/d/datasheet_stars926/stars926?orgId=1}

\begin{figure}[H]

{\centering \includegraphics{images/mqtt_grafana_tess4all.png}

}

\caption{Grafana Dashboard der Messdaten des TESS Photometes im
Naturpark Gantrisch dem ersten Dark Sky Park der Schweiz}

\end{figure}%

\end{boxtitle}

Ãffnet nun den Browser und gebt die IP Adresse des Raspberry Pi mit dem
Port 3000 ein: \texttt{http://\textless{}ip-adresse\textgreater{}:3000}.
Unter Connections / Data Sources kÃ¶nnen Grafana Datenquellen hinzugefÃ¼gt
werden, wÃ¤hlt nun \emph{InfluxDB} um Grafana mit der InfluxDB zu
verbinden. Setzt folgende Einstellungen (Abb.~\ref{fig-grafanainfluxdb})
und speichert diese:

\begin{itemize}
\tightlist
\item
  \emph{Query Language}: WÃ¤hlt in den Einstellungen zu \emph{Query
  Language} die Abfragesprache \texttt{Flux}.
\item
  \emph{HTTP}: Setzt die IP Adresse des Raspberry Pi und den Port 8086:
  \texttt{http://localhost:8086}.
\item
  \emph{Auth}: aktiviert \emph{Basic Auth}
\item
  \emph{Basic Auth Details}: Setzt den InfluxDB Benutzer und das
  Passwort fÃ¼r die InfluxDB
\item
  \emph{InfluxDB Details}: Setzt die InfluxDB Organisation \emph{fhnw},
  den \emph{API Token}, und den InfluxDB Bucket \emph{iot}.
\end{itemize}

\begin{figure}

\centering{

\includegraphics{images/mqtt_grafana_influxdb_settings.png}

}

\caption{\label{fig-grafanainfluxdb}InfluxDB als Datenquelle in Grafana
hinzufÃ¼gen mit den entsprechenden Angaben.}

\end{figure}%

Ist die Verbindung erstellt, kÃ¶nnen neue Dashboards erstellt werden. Die
Queries, die fÃ¼r die Visualisierung verwendet werden sollen, kÃ¶nnen Ã¼ber
den \emph{Query Builder} in InfluxDB erstellt und in Grafana beim
Erstellen der Panels (Abb.~\ref{fig-grafanainfluxdbquery}) reinkopiert
werden.

\begin{figure}

\centering{

\includegraphics{images/mqtt_grafana_influxdb_query.png}

}

\caption{\label{fig-grafanainfluxdbquery}Flux Queries der Datenabfragen
im Data Explorer kÃ¶nnen in Grafana fÃ¼r die Visualisierung kopiert und
genutzt werden.}

\end{figure}%

\begin{exercise}[]\protect\hypertarget{exr-influxb-grafana}{}\label{exr-influxb-grafana}

~

\begin{itemize}
\tightlist
\item
  Erstellt eine Verbindung zwischen Grafana und der InfluxDB.
\item
  Erstellt ein Dashboard mit einer Visualisierung der Temperatur,
  Luftfeuchtigkeit und Luftdruck des BME688 Sensors.
\end{itemize}

\end{exercise}

\section{Aufgabe 7: InfluxDB mit Python verwenden
(optional)}\label{aufgabe-7-influxdb-mit-python-verwenden-optional}

Anstatt mit Node-Red kÃ¶nnen die Daten des Sensors direkt in die InfluxDB
geschrieben werden. Folgender Code zeigt wie die Daten des BME688
Sensors mit Python ausgelesen und in die InfluxDB geschrieben werden
kÃ¶nnen. Teste erst, ob der \texttt{influxdb-client} installiert ist und
installiere diesen falls nicht mit dem Befehl
\texttt{pip3\ install\ influxdb-client}. Folgendes Tutorial zeigt wie
die Daten mit Python in die InfluxDB geschrieben werden kÃ¶nnen:
\href{https://www.influxdata.com/blog/getting-started-with-python-and-influxdb-v2-0/}{Getting
Started with Python and InfluxDB v2.0}.

\begin{figure}[H]

{\centering \includegraphics{images/mqtt-sensor-influxdb.jpg}

}

\caption{Direktes Speichern der Sensormessdaten in der Influxdb ohne
MQTT Protokoll. Hierbei gilt zu beachten, dass beide GerÃ¤te eine aktive
Verbindung haben.}

\end{figure}%

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ datetime }\ImportTok{import}\NormalTok{ datetime}
\ImportTok{import}\NormalTok{ time}

\ImportTok{from}\NormalTok{ influxdb\_client }\ImportTok{import}\NormalTok{ InfluxDBClient, Point, WritePrecision}
\ImportTok{from}\NormalTok{ influxdb\_client.client.write\_api }\ImportTok{import}\NormalTok{ SYNCHRONOUS}

\CommentTok{\# Generieren ein Token in der InfluxDB UI unter dem Tab "Data / Tokens Tab"}
\NormalTok{token }\OperatorTok{=} \StringTok{"\textless{}influxdb{-}token\textgreater{}"}
\NormalTok{org }\OperatorTok{=} \StringTok{"fhnw"}
\NormalTok{bucket }\OperatorTok{=} \StringTok{"iot"}

\NormalTok{client }\OperatorTok{=}\NormalTok{ InfluxDBClient(url}\OperatorTok{=}\StringTok{"http://localhost:8086"}\NormalTok{, token}\OperatorTok{=}\NormalTok{ token, org}\OperatorTok{=}\NormalTok{ org)}
\NormalTok{write\_api }\OperatorTok{=}\NormalTok{ client.write\_api(write\_options }\OperatorTok{=}\NormalTok{ SYNCHRONOUS)}

\NormalTok{temperature }\OperatorTok{=} \FloatTok{22.0}
\NormalTok{data }\OperatorTok{=}\NormalTok{ Point(}\StringTok{"measures"}\NormalTok{).tag(}\StringTok{"fields"}\NormalTok{, }\DecValTok{2}\NormalTok{).field(}\StringTok{"temperature"}\NormalTok{, temperature)}
\NormalTok{write\_api.write(bucket }\OperatorTok{=}\NormalTok{ bucket, record }\OperatorTok{=}\NormalTok{ data)}
\end{Highlighting}
\end{Shaded}

\begin{exercise}[]\protect\hypertarget{exr-python-influxb}{}\label{exr-python-influxb}

Schreibe nun mit Hilfe des Tutorials und dem Beispielcode ein Python
Script, welches die Temperatur, Luftfeuchtigkeit und Luftdruck des
BME688 Sensors ausliest und in die InfluxDB schreibt.

\end{exercise}

\cleardoublepage
\phantomsection
\addcontentsline{toc}{part}{Anhang}
\appendix

\chapter{Raspberry Pi IoT Image}\label{raspberry-pi-iot-image}

Open Source Einplatinenrechner werden in Bildung und Forschung
eingesetzt und haben eine breite Anwendung in weiteren Bereichen wie
IoT. SBCs haben grosse Bedeutung in der Ingenieur- und
Informatikausbildung, da sie sich gut fÃ¼r Hands-on Vermittlung komplexer
Themen eignen, und verbessern technische FÃ¤higkeiten, stÃ¤rken das
Interesse und Motivation (\citeproc{ref-ariza2022}{Ariza \& Baez,
2022}).

\begin{description}
\tightlist
\item[System on Chip SOC \index{System on Chip SOC}]
integriert die meisten Funktionen und Komponenten auf einem Chip (CPU,
RAM, GPU, Schnittstellen) ursprÃ¼nglich fÃ¼r eingebettete (embedded)
Systeme, heute Mobile GerÃ¤te (Mobiles, Tablets), Edge GerÃ¤te (IoT) etc.
â GrÃ¶ssenreduktion, verbesserte Leistung, tiefer Stromverbrauch,
kosteneffizient, jedoch lange Entwicklungszeiten und keine ModularitÃ¤t.
\item[Single Board Computer SBC \index{Single Board Computer SBC}]
ist ein Computer auf einer Leiterplatine mit allen erforderlichen
Komponenten und AnschlÃ¼ssen wie CPU, RAM, GPU I/O Schnittstellen etc. â
Einfach zu nutzen, tiefer Stromverbrauch, kosteneffizient, getestete
Hardware, tendenziell gÃ¼nstig, jedoch schwierig Anpassungen vorzunehmen,
weniger MÃ¶glichkeiten als Â«Multi Board ComputerÂ».
\end{description}

Der \href{https://www.raspberrypi.com}{Raspberry Pi}\index{Raspberry Pi}
ist ein preisgÃ¼nstiger Einplatinencomputer (Single Board Computer SBC)
in Kreditkartenformat zum Experimentieren und Erlernen des
Programmierens. Die Motivation fÃ¼r die Entwicklung des Raspberry Pi war
die sinkende Anzahl Informatikstudierender an der UniversitÃ¤t Cambridge
und der RÃ¼ckgang der Informatikkenntnisse der Studierenden. Der
Raspberry Pi wird von der britischen
\href{https://www.raspberrypi.org}{Raspberry Pi Foundation} entwickelt
seit 2009 entwickelt.

Url: \url{https://www.raspberrypi.com}

Raspberry Pi Modelle im Ãberblick:

\begin{itemize}
\tightlist
\item
  Raspberry Pi 5 (mit 4/8GB RAM ab November 2023)
\item
  Raspberry Pi 4 Model B (mit 1/2/4/8GB RAM)
\item
  Raspberry Pi 3 Model B+
\item
  Raspberry Pi 2 Zero gÃ¼nstige und kompakte Version (mit/ohne Bluetooth
  und WiFi)
\item
  Raspberry Pi 400 Unit (Tastatur mit integriertem Raspberry Pi)
\item
  Raspberry Pi Pico Series flexible und kompakte Microcontroller mit dem
  RP2040 Chip
\item
  Raspberry Pi Compute Module 4 (CM4 mit/ohne eMMC)
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_modelle.jpg}

}

\caption{Raspberry Pi Modelle: 1. Raspberry Pi 5, 2. Raspberry Pi 2
Zero, 3. Raspberry Pi 400, 4. Raspberry Pi Pico, 5. Raspberry Pi Compute
Module 4, 6. RP2040 Chip}

\end{figure}%

Die Raspberry Pi verfÃ¼gen Ã¼ber General Purpose Input Output
GPIO\index{General Purpose Input Output GPIO} sogenannte
Pins\index{Pins}, die fÃ¼r die Verbindung mit Sensoren und Aktoren
verwendet werden kÃ¶nnen. Die Stiftleiste mit den GPIO Pins sind in
unterschiedliche Gruppen unterteilt, die unterschiedliche Funktionen
haben. Die GPIO Pins kÃ¶nnen Ã¼ber eine Programmiersprache wie Python oder
C angesprochen werden und ermÃ¶glichen die Interaktion mit Sensoren oder
Aktoren und weiteren Komponenten.

\begin{figure}[H]

{\centering \includegraphics{images/pinout.png}

}

\caption{links: Die Website \url{https://.pinout.xyz} bietet eine
interaktive Ãbersicht und Dokumentation der Pinouts der einzelnen
Raspberry Pi Modellen, wie beispielsweise welche Pins die Schnittstelle
I2C ansteuern. rechts: Der Befehl \texttt{pinout} liefert direkt Ã¼ber
das Terminal das Pinout des Raspberry Pi}

\end{figure}%

Raspberry Pi war von der weltweiten Chip- und Halbleiterknappheit
betroffen und hatte seit 2020 tiefe LagerbestÃ¤nde von elektronischen
Komponenten. Die Nachfrage nach Raspberry Pi ist seit 2020 stark
gestiegen und die ProduktionskapazitÃ¤ten konnten nicht erhÃ¶ht werden.
Die ProduktionsengpÃ¤sse werden sich voraussichtlich ab Ende 2023
verbessern (\citeproc{ref-upton2022}{Upton, 2022}). Die Knappheit fÃ¼hrte
zu einem Preisanstieg von 50\% bis 100\% bei den Raspberry Pi Modellen
und zu einer Verknappung der Raspberry Pi Modelle. Der Dienst
\href{https://rpilocator.com/?country=CH}{Raspberry Pi Stock Scraper}
fÃ¼hrt eine Ãbersicht der VerfÃ¼gbarkeit der weltweiten Raspberry Pi
LagerbestÃ¤nden von online Shops. Der
\href{https://www.pi-shop.ch/bundles-kits}{Pi-Shop} hat teilweise Kits
und Boards in der Schweiz an Lager.

\section{Raspberry Pi Image
schreiben}\label{raspberry-pi-image-schreiben}

Der Raspberry Pi fÃ¼hrt keinen internen Speicher mit sich, sondern
benÃ¶tigt eine SD-Karte. Auf dieser SD-Karte wird das Betriebssystem
installiert, respektive als Image auf die MicroSD Karte geschrieben. Die
SD-Karte muss mindestens 8 GB Speicherplatz haben idealerweise 16 GB
oder mehr.

Software: \href{https://www.raspberrypi.com/software}{Raspberry Pi -
Software}\\
Tutorial:
\href{https://www.raspberrypi.com/tutorials/how-to-set-up-raspberry-pi}{Raspberry
Pi - How to set up Raspberry Pi}

\textbf{Raspberry Pi Imager}\index{Raspberry Pi Imager} ist die von
Raspberry Pi erstellte Software fÃ¼r das Schreiben von Images auf eine SD
Karte. Der Imager stellt direkt auch weitere Images wie Ubuntu,
Medienzentren, 3D Druck etc. zur VerfÃ¼gung. Alternative \emph{Image
Burner} sind \href{https://www.balena.io/etcher}{Balena Etcher} und
\href{https://sourceforge.net/projects/win32diskimager/}{Win32DiskImager}.

Das Betriebssystem \textbf{Raspberry Pi OS}\index{Raspberry Pi OS} ist
ein auf Debian basiertes Betriebssystem mit Anpassungen fÃ¼r die Hardware
auf dem Raspberry Pi. Es gibt eine \textbf{Lite} Version ohne Desktop
und eine \textbf{Desktop} Version mit Desktop. Die \textbf{Desktop}
Version ist fÃ¼r den Einstieg empfehlenswert, da sie die grafische
OberflÃ¤che bietet und die Konsole. Die \textbf{Lite} Version ist fÃ¼r den
produktiven Einsatz empfehlenswert, da sie weniger Ressourcen benÃ¶tigt
und somit mehr Ressourcen fÃ¼r die Anwendungen zur VerfÃ¼gung stehen. Dazu
muss der Raspberry Pi Ã¼ber das Netzwerk erreichbar sein, beispielsweise
Ã¼ber SSH.

\begin{boxtitle}{Hinweis}{colPrimary}

FÃ¼r die Nutzung am Campus nutzen wir die \textbf{Desktop} Version, da
wir die grafische OberflÃ¤che fÃ¼r das aktivieren des Internetzugangs
benÃ¶tigen.

\end{boxtitle}

Image schreiben mit \textbf{Raspberry Pi 64-bit} (Desktop Version) und
mit den erweiterten Optionen Voreinstellungen zu \textbf{SSH} (Ja),
\textbf{WiFi} (Heimnetzwerk), \textbf{Konto} und unter Sprache die
\textbf{Zeitzone} Europe/Zurich und das das \textbf{Tastaturlayout} CH
setzen.

\begin{boxtitle}{Hinweis}{colPrimary}

Die Einstellungen kÃ¶nnen spÃ¤ter in der Konsole mit dem Programm
\texttt{raspi-config} geÃ¤ndert werden.

\end{boxtitle}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_image_schreiben.png}

}

\caption{Rasperry Pi Imager ausfÃ¼hren mit (1) Betriebssystem wÃ¤hlen, (2)
Raspberry Pi OS (Other), (3) Raspberry Pi OS 64-bit, (4) erweiterte
Einstellungen wÃ¤hlen und unter diesen Voreinstellungen zum Konto, SSH,
Zeitzone und Tastaturlayout vordefinieren.}

\end{figure}%

\begin{boxtitle}{Hinweis}{colPrimary}

FÃ¼r Testzwecke kann es sinnvoll sein den Standardkontonamen \texttt{pi}
und das Standardpasswort \texttt{raspberry} zu verwenden. Jedoch sollte
der Kontonamen und das Passwort fÃ¼r den produktiven Einsatz geÃ¤ndert
werden, vor allem wenn der Raspberry Pi mit dem Internet verbunden ist,
beispielsweise mit einem aktivierten SSH Zugang.

\end{boxtitle}

\begin{boxtitle}{Ãbung}{colPrimary}

\textbf{Raspberry Pi Image auf SD-Karte schreiben}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Installiere den Raspberry Pi Imager
\item
  Schreibe Raspberry Pi OS 64-bit auf die SD Karte
\item
  Aktiviere SSH und setze die Spracheinstellungen (WiFi Name und
  Password des Netzwerks von Zuhause oder dem Mobile Hotspot)
\item
  SD Karte in den Raspberry einsetzen
\item
  Maus, Tastatur und Monitor anschliessen und dann mit dem Netzteil mit
  Strom versehen
\end{enumerate}

\end{boxtitle}

\section{Raspberry Pi einrichten}\label{raspberry-pi-einrichten}

FÃ¼r das Einrichten des Raspberry Pi wird die SD-Karte mit dem Image in
den Raspberry Pi eingesetzt. FÃ¼r das erstmalige Einrichten des Raspberry
Pi OS ist ein Bildschirm, eine Tastatur und eine Maus erforderlich.
Verbunden wird der Raspberry Pi Ã¼ber die HDMI-Schnittstelle mit dem
Bildschirm und Ã¼ber die USB Schnittstelle mit der Tastatur und der Maus,
dann wird die Stromversorgung Ã¼ber USB-C angeschlossen.

\begin{boxshade}{colPrimary}

\textbf{GehÃ¤use Ã¶ffnen und SD Karten Slot Ã¶ffnen}

Den Deckel durch leichtes DrÃ¼cken mit zwei Finger bei (1) horizontal
leicht in Pfeilrichtung drÃ¼cken, nach einem Klick lÃ¤sst sich das GehÃ¤use
aufschieben. Der SD Karten-Slot lÃ¤sst sich mit einem Stift in der
Einbuchtung (3) mit leichtem Druck in Pfeilrichtung Ã¶ffnen (4). Das
Raspberry Pi Board kann durch ein leichtes Klicken in Pfeilrichtung (5)
aus dem GehÃ¤use entfernt werden.

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_oeffnen_sd_karte_wechseln.jpg}

}

\caption{GehÃ¤use Ã¶ffnen, SD Karte wechesln und das Board aus dem GehÃ¤use
entfernen.}

\end{figure}%

\end{boxshade}

\section{WiFi Verbindung einrichten}\label{wifi-verbindung-einrichten}

Das WiFi Network kann auch Ã¼ber den Desktop eingerichtet werden. Das
WiFi Symbol in der oberen rechten Ecke des Desktops zeigt die
verfÃ¼gbaren WiFi Netzwerke an. Je nach Einstellungen muss hierbei noch
das WiFi Land \texttt{CH} ausgewÃ¤hlt werden. Die WiFi Einstellungen
kÃ¶nnen auch Ã¼ber die Konsole mit dem Programm \texttt{raspi-config}
vorgenommen werden.

\begin{boxtitle}{Hinweis}{colPrimary}

FÃ¼r die Verbindung mit dem Internet am Campus muss das Netzwerk
\emph{fhnw-public} ausgewÃ¤hlt werden. Im Browser kann Ã¼ber die Website
\url{https://mpp.ict.fhnw.ch} mit dem FHNW Login oder Ã¼ber das
Mobiltelefon die Verbindung hergestellt werden.

\end{boxtitle}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_image_wifi_cmu.png}

}

\caption{WiFi Verbindung Ã¼ber den Desktop auf dem Campus herstellen. Das
Netzwerk \emph{fhnw-public} wÃ¤hlen und auf der Website
https://mpp.ict.fhnw.ch die Verbindung mit dem FHNW Account oder via
Mobile herstellen.}

\end{figure}%

\section{\texorpdfstring{SSH Verbindung
herstellen\index{SSH}}{SSH Verbindung herstellen}}\label{ssh-verbindung-herstellen}

\includegraphics{images/raspberry_pi_shell.jpg}\{\#fig-shell
width=``30\%''\,``\}

Das SSH Protokoll ermÃ¶glicht den direkten auf den Raspberry Pi Ã¼ber das
Konsolenfenster. HierfÃ¼r wird die IP Adresse des Raspberry Pi benÃ¶tigt.
Die IP Adresse kann Ã¼ber das Programm \texttt{ifconfig} oder
\texttt{ip\ addr} in der Konsole abgefragt werden.

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_ifconfig.png}

}

\caption{Die IP-Adresse fÃ¼r das Wi-Fi ist unter \texttt{wlan0} bei inet
aufgefÃ¼hrt. Falls der Raspberry Pi mit einem Ethernet Kabel mit dem
Netzwerk verbunden ist, wird die IP Adresse unter \texttt{eth0} bei inet
aufgefÃ¼hrt.}

\end{figure}%

FÃ¼r die Verbindung mit SSH zu Raspberry Pi existieren unterschiedliche
Clients:

\begin{itemize}
\tightlist
\item
  Direkt Ã¼ber die Eingabeaufforderung in Windows mit \texttt{ssh}
\item
  PuTTY \url{https://putty.org} (win) ein SSH und telnet client fÃ¼r
  Windows (auch portable Nutzung ohne Installation mÃ¶glich)
\item
  Tabby \url{https://tabby.sh} (win, mac, linux) ein modernes open
  source Terminal fÃ¼r lokale Shell, Serielle Schnittstelle, SSH und
  Telnet Verbindungen, File Transfer mit SFTP und
  KonfigurationsmÃ¶glichkeiten (auch portable Nutzung ohne Installation
  mÃ¶glich)
\end{itemize}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_putty.png}

}

\caption{SSH Verbindung mit Putty einrichten}

\end{figure}%

\subsection{\texorpdfstring{Tabby\index{Tabby}}{Tabby}}\label{tabby}

Neues SSH Verbindungsprofil mit Tabby erstellen mit der IP Adresse des
Raspberry Pi erstellen.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Unter Einstellungen / Profile \& Verbindungen ein Neues Profil anlegen
\item
  In der Auswahl SSH-Verbindung wÃ¤hlen
\item
  Unter Host die IP Adresse Benutzername des Raspberry Pi setzen und
  speichern
\end{enumerate}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_tabby.png}

}

\caption{SSH Verbindung mit Tabby einrichten (1-5) und anwenden (6).}

\end{figure}%

\subsection{Datentransfer mit SFTP}\label{datentransfer-mit-sftp}

Remote Datentransfer mit SFTP dem SSH File Transfer
Protokoll\index{SFTP SSH File Transfer Protokoll} ermÃ¶glicht ein
einfaches Verwalten und auch sichern der Daten. Hierbei eignet sich die
Software \href{https://filezilla-project.org/}{FileZilla} oder
\href{https://winscp.net/eng/docs/lang:de}{WinSCP} fÃ¼r den
Datentransfer.

In Fillezilla eine SFTP Verbindung Ã¼ber Datei/Servermanager herstellen
mit Server:
\texttt{\textless{}IP\ Adresse\ Raspberry\ Pi\textgreater{}}, Protokoll:
\texttt{SFTP}, und bei der Verbindungart \texttt{normal} wÃ¤hlen und dort
Benutzername und Passwort des Raspberry Pi Users angeben.

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_filezilla.png}

}

\caption{Datentransfer mit FileZilla. Eine neue Verbindung im
Servermanager (1) erstellen unter Server die IP-Adresse des Raspberry Pi
setzen mit dem SFTP Prokoll, und bei der Verbindungsart \emph{normal}
wÃ¤hlen und Benutzername und Passwort des Raspberry Pi angeben und mit
``Verbinden'' (4) die SFTP Verbindung aufbauen und im Hauptfenster (5)
Daten transferieren.}

\end{figure}%

\section{Mobilen Hotspot nutzen}\label{mobilen-hotspot-nutzen}

Auf Windows kann ein mobiler Hotspot eingerichtet werden, um den
Raspberry Pi mit dem Internet zu verbinden. HierfÃ¼r wird die
Internetverbindung des Computers Ã¼ber das WLAN mit dem Raspberry Pi
geteilt. Einen Mobilen Hotspot auf Windows einrichten, den Raspberry Pi
mit dem Netzwerk verbinden und die IP Adressen der verbundenen Raspberry
Pi's werden im Reiter Mobiler Hotspot aufgefÃ¼hrt.

\section{Raspberry Pi Config}\label{raspberry-pi-config}

Die Grundlegenden Einstellungen des Raspberry Pi kÃ¶nnen mit dem Programm
\texttt{raspi-config}\index{raspi-config} vorgenommen werden, entweder
Ã¼ber die Konsole oder Ã¼ber den Desktop. Beispielsweise kann dort SSH
aktiviert werden, das Tastaturlayout geÃ¤ndert werden oder die Zeitzone
angepasst werden. Oder weitere Schnittstellen wie I2C, SPI oder UART
aktiviert werden.

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_enable_ssh.png}

}

\caption{Ãber die Konsole \texttt{raspi-config} starten und Ã¼ber das
Konsolenmenu die Einstellungen anpassen. Im Beispiel wird Ã¼ber das
Interface Options Menu \emph{SSH} aktiviert.}

\end{figure}%

\section{\texorpdfstring{Raspberry Pi
aktualisieren\index{Raspberry Pi Update}}{Raspberry Pi aktualisieren}}\label{raspberry-pi-aktualisieren}

Generell empfiehlt es sich den Raspberry Pi aktuell zu halten und vor
jeder Installation von Softwarepaketen folgende Befehle durchzufÃ¼hren

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sudo}\NormalTok{ apt update}
\FunctionTok{sudo}\NormalTok{ apt upgrade}
\FunctionTok{sudo}\NormalTok{ apt{-}get clean}
\end{Highlighting}
\end{Shaded}

\section{Raspberry Pi im Netzwerk
auffinden}\label{raspberry-pi-im-netzwerk-auffinden}

Sobald der Raspberry Pi und auch andere GerÃ¤te mit dem Netzwerk
verbunden sind kann deren IP Adresse mit Scanner Tools wie
\href{https://angryip.org}{Angry IP Scanner}, \texttt{arp\ -a}{[}\^{}
\texttt{arp\ -a} listet die IP- und die MAC Adressen der einzelnen
GerÃ¤te. Es kann ohne das AuffÃ¼hren von Hostnamen jedoch aufwendig
werden, die einzelnen EintrÃ¤ge durchzugehen um zu eruieren. Tipp:
\texttt{arp\ -a} vor dem Booten des Raspberry Pi ausfÃ¼hren und ein
zweites mal nachdem der Raspberry Pi vollstÃ¤ndig gebootet hat nochmals
und eruieren welche IP Adresse hinzugekommen ist.{]} oder \texttt{nmap}
gefunden werden. FÃ¼r Android und iOS existieren diverse Scanner Apps wie
\href{https://www.fing.com/products/fing-app}{Fing} oder
\href{https://techet.net/netanalyzer}{Net Analyzer}.

Dienste, die dass Netzwerk durchleuchten wie der Angry IP Scanner sind
in grÃ¶sseren Netzwerken wie bei Firmen oder UniversitÃ¤ten aus
SicherheitsgrÃ¼nden blockiert. FÃ¼r den Nutzen im lokalen Netzwerk zu
Hause ist der Angry IP Scanner jedoch ein nÃ¼tzliches Tool.

\begin{figure}[H]

{\centering \includegraphics{images/angryip_scanner.png}

}

\caption{Beispiel Scan eines lokalen Netzwerks mit dem Angry IP Scanner}

\end{figure}%

\chapter{Raspberry Pi Sensorbox}\label{raspberry-pi-sensorbox}

\section{Raspberry Pi 4 Set}\label{raspberry-pi-4-set}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_box.jpg}

}

\caption{Inhalt des Raspberry Pi 4 Set, mit dem Brekaout Garden HAT,
HDMI-HDMI Mini Kabel, Netzteil mit USB-C Anschluss und MicroSD Karte mit
Adapter}

\end{figure}%

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4872}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5128}}@{}}
\caption{Inhalt des Raspberry Pi 4 Set}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Inhalt / StÃ¼ckliste
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Inhalt / StÃ¼ckliste
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Raspberry Pi 4B - 4G &
\href{https://www.raspberrypi.com/products/raspberry-pi-4-model-b/}{Raspberry
Pi} \\
Pimoroni Breakout Garden HAT (I2C+SPI) &
\href{https://shop.pimoroni.com/products/breakout-garden-hat-i2c-spi}{Pimoroni} \\
HighPi Pro Case for Raspberry Pi 4 &
\href{https://www.hipi.io/highpipro/}{HiPi} \\
Raspberry Pi 15W USB-C Netzteil &
\href{https://www.raspberrypi.com/products/type-c-power-supply/}{Raspberry
Pi} \\
HDMI-HDMI Mini Kabel\footnote{HDMI Mini Anschluss schnell defekt} & \\
MicroSD Karte mit SD Adapter - 32Gb & \\
HDMI-DVI Adapter & \\
\end{longtable}

\section{Sensorbox}\label{sensorbox}

Folgender Abschnitt gibt eine Ãbersicht der in diesem Kurs verwendeten
Sensoren. Die Sensoren sind auf kleinen Platinen (Pimoroni-Breakouts)
mit RandanschlÃ¼ssen montiert und kÃ¶nnen einfach auf der \emph{Breakout
Garden HAT} Erweiterung auf den Raspberry Pi ohne lÃ¶ten und verkabeln
montiert werden.

Die Sensorbox enthÃ¤lt mehrere typische IoT Sensoren, die in vielen IoT
GerÃ¤ten Verwendung finden und im Geomatikkontext von Interesse sind.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2083}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3472}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.4444}}@{}}
\caption{Sensorbox InhaltsÃ¼bersicht}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Sensor
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Beschreibung
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Produkt, Datenblatt, Library
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Sensor
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Beschreibung
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Produkt, Datenblatt, Library
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
BME688 & Temperatur, Luftdruck, Luftfeuchtigkeit \& Gas &
\href{https://shop.pimoroni.com/products/bme688-breakout?variant=39336951709779}{BME688
Breakout},
\href{https://www.bosch-sensortec.com/products/environmental-sensors/gas-sensors/bme688}{Bosch
BME688},
\href{https://github.com/pimoroni/bme680-python}{bme680-python} \\
ICM20948 & 9DoF Motion Accelero-, Gyro-, Magnetometer &
\href{https://shop.pimoroni.com/products/icm20948}{ICM20948 Breakout},
\href{https://www.invensense.com/wp-content/uploads/2016/06/DS-000189-ICM-20948-v1.3.pdf}{ICM
20948},
\href{https://github.com/pimoroni/icm20948-python}{icm20948-python} \\
VL53L5CX & Time of Flight ToF -- 8x8 Multizone &
\href{https://shop.pimoroni.com/products/vl53l5cx-time-of-flight-tof-sensor-breakout}{VL53L5CX
Breakout},
\href{https://cdn.shopify.com/s/files/1/0174/1800/files/vl53l5cx.pdf}{VL53L5CX},
\href{https://github.com/pimoroni/vl53l5cx-python}{vl53l5cx-python} \\
AS7262 & Spektral Sensor 6 KanÃ¤le: 450, 500,550, 570, 600, 650 nm &
\href{https://shop.pimoroni.com/products/as7262-6-channel-spectral-sensor-spectrometer-breakout}{AS7262
Breakout},
\href{https://ams.com/documents/20143/36005/AS7262_DS000486_5-00.pdf}{AS7262},
\href{https://github.com/pimoroni/as7262-python}{as7262-python} \\
MAX30101 & Herzfrequenz, Oximeter, Rauchsensor &
\href{https://shop.pimoroni.com/products/max30101-breakout-heart-rate-oximeter-smoke-sensor}{MAX30101
Breakout},
\href{https://cdn.shopify.com/s/files/1/0174/1800/files/MAX30101.pdf}{MAX30101},
\href{https://github.com/pimoroni/max30105-python}{max30105-python} \\
MLX90640 & Thermal Kamera 32x24pixel Breakout -- Wide angle (110Â°) &
\href{https://shop.pimoroni.com/products/mlx90640-thermal-camera-breakout?variant=12549161746515}{MLX90640
Breakout},
\href{https://www.melexis.com/-/media/files/documents/datasheets/mlx90640-datasheet-melexis.pdf}{MLX90640},
\href{https://github.com/pimoroni/mlx90640-library}{mlx90640-library}\href{https://github.com/adafruit/Adafruit_CircuitPython_MLX90640}{Adafruit
MLX90640} \\
& 1.54'\,' LCD LCD Bildschirm SPI 240x240pixels &
\href{https://shop.pimoroni.com/products/1-3-spi-colour-lcd-240x240-breakout}{1.54''
SPI Colour Square LCD (240x240)},
\href{https://github.com/pimoroni/st7789-python}{st7789-python} \\
& Adafruit I2C Hub Qwiic/Stemma QT 5 Port Hub &
\href{https://shop.pimoroni.com/products/adafruit-qwiic-stemma-qt-5-port-hub}{I2C
5 Port Hub} \\
\end{longtable}

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_set_number.jpg}

}

\caption{Raspberry Pi mit der Breakout Garden HAT Erweiterung (1) von
Pimoroni und den Sensoren, (2) VL53L5CX Time of Flight, (3) BME688
Temperatur, Luftfeuchtigkeit und Gas, (4) ICM20948 9DoF Motion
Accelero-, Gyro-, Magnetometer, (5) AS7262 Spektral Sensor, (6) MAX30101
Herzfrequenz, Oximeter, (7) MLX90640 Thermal Kamera, (8) 1.54'' LCD
Bildschirm Rauchsensor}

\end{figure}%

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{Sensor Ausrichtung beachten}\\
Beim Anschliessen der Sensoren in die Schnittstellen des Breakout Garden
\textbf{unbedingt} die korrekte Ausrichtung beachten! Die Beschriftung
der AnschlÃ¼sse auf dem Sensor und dem Breakout Garden mÃ¼ssen
Ã¼bereinstimmen!

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_correct_sensor_mount.png}

}

\caption{Sensor links korrekt angeschlossen, rechts falsch ausgerichtet
angeschlossen.}

\end{figure}%

\end{boxtitle}

\chapter{Shell Cheat Sheet}\label{shell-cheat-sheet}

Einen unvollstÃ¤ndige Ãbersicht gÃ¤ngiger Konsolen Befehle in Linux.

\begin{itemize}
\tightlist
\item
  \textbf{Raspberry Pi runterfahren:} \texttt{sudo\ shutdown\ now}
\item
  \textbf{Raspberry Pi neu starten:} \texttt{sudo\ reboot\ now}
\end{itemize}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4059}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5941}}@{}}
\caption{NÃ¼tzliche Linux Befehle fÃ¼r die Kommandozeile
(Shell)}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Kommando
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Kommentar
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Kommando
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Kommentar
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{sudo\ shutdown\ now} & System jetzt runterfahren / beenden \\
\texttt{sudo\ reboot\ now} & System jetzt neustarten \\
\texttt{man\ \textless{}Befehl\textgreater{}} & Dokumentation / Manual
von Paketen \\
\texttt{\textless{}Befehl\textgreater{}\ -\/-help\ \textbar{}\ less} &
Ruft die Optionen von Befehlen auf, die Option \texttt{-less}
ermÃ¶glicht, dass mit den Cursortasten in den in lÃ¤ngeren Hilfeseiten
geblÃ¤ttert werden kann. \\
\texttt{whoami} & User Informationen anzeigen \\
\texttt{pwd} & Name des aktuellen Verzeichnisses aufzeigen \\
\texttt{ls} & Inhalt des aktuellen Verzeichnis zeigen \\
\texttt{ls\ -l} & Auflisten aller Dateien und deren Details aktuellen
Verzeichnis, wie Schreib- und Leseberechtigungen \\
\texttt{ls\ \ -a} & Alle Dateien inklusive der versteckten anzeigen \\
\texttt{ls\ \ -lh} & FilegrÃ¶ssen menschenfreundlich darstellen \\
\texttt{ls\ \ âlah} & Alle Dateien anzeigen \\
\texttt{find} & Suche von Dateien mit sehr vielen Optionen fÃ¼r die
Suche \\
\texttt{cd} & Verzeichnis wechseln (\textbf{c}hange \textbf{d}irectory)
Beispiel: \texttt{cd\ ../Documents} wechsle in den Ã¼bergeordneten Ordner
mit ``..'' und gehe in das Verzeichnis ``Documents'' \\
\texttt{mkdir} & Erstelle ein Verzeichnis \texttt{mkdir\ Projekt} \\
\texttt{cp} & Kopiere eine Datei/Ordner
\texttt{cp\ \textless{}quell-pfad\textgreater{}\ \textless{}ziel-pfad\textgreater{}} \\
\texttt{mv} & Verschieben/Umbenennen einer Datei/Ordner
\texttt{mv\ \textless{}quell-pfad\textgreater{}\ \textless{}ziel-pfad\textgreater{}} \\
\texttt{rm} & Dateien lÃ¶schen \\
\texttt{rm\ -r} & Ordner und Inhalte lÃ¶schen (alternativ
\texttt{rmdir}), Option \texttt{-f} ohne BestÃ¤tigung \\
\texttt{chmod} & Datei- und Verzeichnisrechte Ã¤ndern (r Lese-,w Schreib-
und x AusfÃ¼hrrechte) fÃ¼r Nutzer und Nutzergruppen. Beispiel:
\texttt{chmod\ 777\ Datei.txt} gibt allen Nutzern Lese-, Schreib- und
AusfÃ¼hrrechte. \\
\texttt{zip\ -r\ \textless{}zip\ file\ name\textgreater{}\ \textless{}folder\ to\ zip\textgreater{}}
& Dateien in einem Ordner in eine .zip Datei komprimieren.
(Installationsbefehl, falls das Paket \emph{zip} nicht installiert ist:
\texttt{sudo\ apt\ install\ zip\ unzip}) \\
\texttt{unzip\ datei.zip} & Zip-Datei entzippen \\
\end{longtable}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4059}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5941}}@{}}
\caption{NÃ¼tzliche Linux Befehle zur Softwareverwaltung und
Installation}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Kommando
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Kommentar
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Kommando
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Kommentar
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{sudo\ \textless{}Befehl\textgreater{}} & Einmalig einen Befehl
als su (\textbf{s}uper \textbf{u}ser =Administrator) ausfÃ¼hren (=super
user do..) wie beispielsweise eine Installation von Paketen. Beim
AusfÃ¼hren wird das Passwort des su benÃ¶tigt \\
\texttt{sudo\ apt\ install\ \textless{}Paketname\textgreater{}} &
Software Ã¼ber die Software-Verwaltung APT (Advanced Package Tool)
installieren \\
\texttt{sudo\ apt\ remove\ \textless{}Paketname\textgreater{}} &
Software deinstallieren \\
\texttt{sudo\ apt\ purge\ \textless{}Paketname\textgreater{}} &
Konfigurationsdateien nach der Deinstallation entfernen \\
\texttt{sudo\ apt\ autoremove} & Alle nicht mehr benÃ¶tigten Pakete /
Software \\
\texttt{sudo\ apt-cache\ showpkg\ \textless{}Paketname\textgreater{}} &
Zeigt alle Informationen Ã¼ber Pakete, Version, AbhÃ¤ngigkeiten und
Installation an. \texttt{apt-cache} bietet mit
\texttt{sudo\ apt-cache\ dump} eine Liste aller installierten Pakete,
\texttt{sudo\ apt-cache\ stats} die Anzahl der installierten Pakete und
deren AbhÃ¤ngigkeiten. \\
\texttt{sudo\ apt-cache\ search\ \textless{}Paketname\textgreater{}} &
ErmÃ¶glicht die Suche nach Paketen, beispielsweise
\texttt{sudo\ apt-cache\ search\ minesweep} \\
\texttt{sudo\ apt\ update} & Laden der aktuellen Paketliste fÃ¼r das
Betriebssystem \\
\texttt{sudo\ apt\ dist-upgrade} & Aktualisieren des Betriebssystem
(nach \texttt{sudo\ apt-get\ update} ausfÃ¼hren) \\
\texttt{sudo\ apt\ autoremove} \texttt{sudo\ apt\ autoclean} & Entfernt
nicht mehr benÃ¶tigte Dateien und Pakete \\
\texttt{dpkg\ -\/-get-selections} \texttt{dpkg\ -l} & Alle
Softwarepakete auflisten \\
\texttt{dpkg\ -\/-get-selections\ \textbar{}\ grep~\textless{}Paketname\textgreater{}}
& GewÃ¼nschtes Softwarepaket mit \texttt{grep} filtern \\
\texttt{sudo\ dpkg\ -S\ \textless{}Paketname\textgreater{}} &
Installationsort von einem Softwarepaket anzeigen \\
\texttt{dpkg\ -l\ \textbar{}\ grep\ \textless{}Keyword\textgreater{}} &
Nach einem installieren Softwarepaket suchen \\
\texttt{dpkg\ -s\ \textless{}Paketname\textgreater{}\ \textbar{}\ grep\ Version}
& Version der installierten Software auflisten \\
\texttt{which\ \textless{}Paketname\textgreater{}} & Pfad zu den
installierten Binaries anzeigen \\
\texttt{apt\ list\ \textless{}Paketname\textgreater{}} & Version von
einem Package anzeigen \\
\texttt{apt\ list\ \textless{}Paketname\textgreater{}\ -a} & Alle
verfÃ¼gbaren Versionen von einer Software in diesem Repository
auflisten \\
\texttt{apt-cache\ policy\ \textless{}Paketname\textgreater{}} &
Metadaten von einem Softwarepaket auflisten \\
\texttt{apt-cache\ madison\ \textless{}Paketname\textgreater{}} &
Metadaten von einem Softwarepaket auflisten \\
\texttt{sudo\ apt\ search\ \textless{}Paketname\textgreater{}}
\texttt{sudo\ apt-cache\ search\ \textless{}Paketname\textgreater{}} &
Suche, ob ein Softwarepaket verfÃ¼gbar ist, ev zuerst die Paketliste mit
\texttt{sudo\ apt\ update} aktualisieren. \\
\end{longtable}

\chapter{Raspberry Pi IoT Image}\label{raspberry-pi-iot-image-1}

FÃ¼r eine mÃ¶glichst reibungslose DurchfÃ¼hrung der Ãbungen ist ein
vorkonfiguriertes Image hilfreich. Dies gewÃ¤hrleistet, dass alle
Studierenden mit der gleichen Software arbeiten und die Ãbungen nicht
durch Installationsprobleme verzÃ¶gert werden

FÃ¼r die Ãbungen mit den Sensoren sind Python und die entsprechenden
Sensorbibliotheken erforderlich. Die Installation dieser Bibliotheken
ist in den Ãbungsanleitungen beschrieben. Die Ãbungen mit dem IoT Stack
mit MQTT, InfluxDB, Node-Red und Grafana erfordern eine Installation der
Software auf dem Raspberry Pi. Die Installation dieser ist nicht in der
Ãbungsanleitung8 abgedeckt.

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{Hinweis}: FÃ¼r das Kopieren mehrerer Images auf SD Karten kÃ¶nnen
diese einzel auf die SD Karten geschrieben werden oder empfehlenswert
fÃ¼r das Kopieren von mehreren SD Karten lohnt es sich auch eine SD
Karten Kopierstation zu verwenden, wie z.B. die
\href{https://www.digitec.ch/de/s1/product/renkforce-tragbares-sdmicrosd-flash-lesegeraet-mit-kopierfunktion-v-1-auf-2-von-speicherkartenlesege-14550270}{Renkforce
Speicherkarten-Kopierstation}

\end{boxtitle}

\section{Raspberry Pi Zugangsdaten}\label{raspberry-pi-zugangsdaten}

Notiere die Zugangsdaten fÃ¼r den Raspberry Pi und die einzelnen
Softwarekomponenten in der untenstehenden Tabelle. Die Zugangsdaten
werden fÃ¼r die Ãbungen benÃ¶tigt.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2000}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.3000}}@{}}
\caption{Zugangsdaten zu den einzelnen Konten notieren, gerade bei
Datenbanken geht dies leicht vergessen.}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Konto
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
User
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Passwort
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Kommentar
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Konto
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
User
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Passwort
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Kommentar
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Raspberry Pi & & & \\
influxdb & & & organisation: \\
grafana & & & \\
\end{longtable}

\section{Installation Shell Script}\label{installation-shell-script}

Shell Script fÃ¼r die Installation der erforderlichen Bibliotheken Script
\texttt{install\_iot\_software.sh} mit dem unten aufgefÃ¼hrten Code
erstellen und dem Script die Rechte fÃ¼r die AusfÃ¼hrung setzen mit

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sudo}\NormalTok{ chmod +x install\_iot\_software.sh}
\end{Highlighting}
\end{Shaded}

Script mit folgendem \texttt{sh\ install\_iot\_software.sh} oder
\texttt{./install\_iot\_software.sh} Befehl ausfÃ¼hren:

\begin{boxtitle}{Hinweis}{colPrimary}

InfluxDB Version: Die Version der InfluxDB auf die neuste Version im
Script anpassen.

\end{boxtitle}

Shell Script: \texttt{install\_iot\_software.sh} - Bash Script zu
Installation der Software und Libraries fÃ¼r das fÃ¤cherÃ¼bergreifende
Modul 5200 IoT Installation von:

\begin{itemize}
\tightlist
\item
  Python Libraries Beispielcode fÃ¼r die Pimoroni Sensoren
\item
  Klonen der Libraries mit Beispielen in Documents/Libraries
\item
  Jupyter Notebook
\item
  MQTT, Mosquitto Broker und Clients
\item
  Node-Red
\item
  InfluxDB
\item
  Grafana
\item
  VNC
\end{itemize}

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{ZeilenumbrÃ¼che EOL} ZeilenunterbrÃ¼che von Textdateien
unterscheiden sich zwischen Unix \texttt{LF} und Windows \texttt{CRLF}
Systemen. Bash Script mÃ¼ssen auf Linux Systemen Unix ZeilenumbrÃ¼che
(EOL) \texttt{LF} aufweisen. Dies ist vor allem dann wichtig, wenn das
Script auf einem Windows System erstellt wird. Windows verwendet
standardmÃ¤ssig \texttt{CRLF} ZeilenumbrÃ¼che. In Visual Studio Code
kÃ¶nnen die EOL Zeichen mit \texttt{Ctrl+Shift+P} und
\texttt{Change\ End\ of\ Line\ Sequence} auf \texttt{LF} umgestellt
werden oder Ã¼ber die Statusleiste unten rechts bei \texttt{CRLF}. In
Notepad++ kann dies Ã¼ber \texttt{Edit/EOL\ Conversion/Unix\ (LF)}
umgestellt werden.

\end{boxtitle}

\emph{install\_iot\_software.sh}: Bash Installations-Script mit Unix
ZeilenumbrÃ¼chen EOL

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/bin/bash}
\VariableTok{COL}\OperatorTok{=}\StringTok{\textquotesingle{}\textbackslash{}033[0;32m\textquotesingle{}} \CommentTok{\# Primary Color}
\VariableTok{NC}\OperatorTok{=}\StringTok{\textquotesingle{}\textbackslash{}033[0m\textquotesingle{}} \CommentTok{\# No Color}
\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{Raspberry Pi Version}\VariableTok{$\{NC\}}\StringTok{"}
\ExtensionTok{hostnamectl}
\FunctionTok{cat}\NormalTok{ /proc/cpuinfo }\KeywordTok{|} \FunctionTok{grep}\NormalTok{ Model}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{Raspberry Pi aktualisieren}\VariableTok{$\{NC\}}\StringTok{"}
\FunctionTok{sudo}\NormalTok{ apt update}
\FunctionTok{sudo}\NormalTok{ apt full{-}upgrade }\AttributeTok{{-}y}
\FunctionTok{sudo}\NormalTok{ apt autoremove }\AttributeTok{{-}y}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{VNC Installation}\VariableTok{$\{NC\}}\StringTok{"}
\FunctionTok{sudo}\NormalTok{ apt{-}get install realvnc{-}vnc{-}server}
\FunctionTok{sudo}\NormalTok{ apt{-}get install realvnc{-}vnc{-}viewer}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{i2c{-}tools Installation}\VariableTok{$\{NC\}}\StringTok{"}
\FunctionTok{sudo}\NormalTok{ apt install python3{-}smbus}
\FunctionTok{sudo}\NormalTok{ apt install }\AttributeTok{{-}y}\NormalTok{ i2c{-}tools}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{Mosquitto Server, Clients und Python Libraries Installation}\VariableTok{$\{NC\}}\StringTok{"}
\FunctionTok{sudo}\NormalTok{ apt install mosquitto }\AttributeTok{{-}y}
\FunctionTok{sudo}\NormalTok{ apt install mosquitto{-}clients }\AttributeTok{{-}y}
\FunctionTok{sudo}\NormalTok{ systemctl enable mosquitto.service}
\FunctionTok{sudo}\NormalTok{ systemctl restart mosquitto}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{Node{-}Red Installation}\VariableTok{$\{NC\}}\StringTok{"}
\ExtensionTok{curl} \AttributeTok{{-}sL}\NormalTok{ https://raw.githubusercontent.com/node{-}red/linux{-}installers/master/deb/update{-}nodejs{-}and{-}nodered }\AttributeTok{{-}o}\NormalTok{ update{-}nodejs{-}and{-}nodered.sh}
\FunctionTok{chmod}\NormalTok{ +x update{-}nodejs{-}and{-}nodered.sh}
\FunctionTok{bash}\NormalTok{ update{-}nodejs{-}and{-}nodered.sh }\AttributeTok{{-}{-}confirm{-}root} \AttributeTok{{-}{-}confirm{-}pi} \AttributeTok{{-}{-}confirm{-}install} \AttributeTok{{-}{-}no{-}init}
\FunctionTok{rm}\NormalTok{ update{-}nodejs{-}and{-}nodered.sh}
\FunctionTok{sudo}\NormalTok{ systemctl enable nodered.service}
\FunctionTok{sudo}\NormalTok{ systemctl start nodered.service}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{InfluxDB Installation}\VariableTok{$\{NC\}}\StringTok{"}
\FunctionTok{wget}\NormalTok{ https://dl.influxdata.com/influxdb/releases/influxdb2{-}2.7.1{-}arm64.deb}
\FunctionTok{sudo}\NormalTok{ dpkg }\AttributeTok{{-}i}\NormalTok{ influxdb2{-}2.7.1{-}arm64.deb}
\FunctionTok{sudo}\NormalTok{ service influxdb start}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{Grafana Installation}\VariableTok{$\{NC\}}\StringTok{"}
\FunctionTok{sudo}\NormalTok{ apt{-}get install }\AttributeTok{{-}y}\NormalTok{ apt{-}transport{-}https software{-}properties{-}common wget}
\FunctionTok{sudo}\NormalTok{ mkdir }\AttributeTok{{-}p}\NormalTok{ /etc/apt/keyrings/}
\FunctionTok{wget} \AttributeTok{{-}q} \AttributeTok{{-}O} \AttributeTok{{-}}\NormalTok{ https://apt.grafana.com/gpg.key }\KeywordTok{|} \ExtensionTok{gpg} \AttributeTok{{-}{-}dearmor} \KeywordTok{|} \FunctionTok{sudo}\NormalTok{ tee /etc/apt/keyrings/grafana.gpg }\OperatorTok{\textgreater{}}\NormalTok{ /dev/null}
\BuiltInTok{echo} \StringTok{"deb [signed{-}by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main"} \KeywordTok{|} \FunctionTok{sudo}\NormalTok{ tee }\AttributeTok{{-}a}\NormalTok{ /etc/apt/sources.list.d/grafana.list}
\FunctionTok{sudo}\NormalTok{ apt{-}get update}
\FunctionTok{sudo}\NormalTok{ apt{-}get install grafana }\AttributeTok{{-}y}

\FunctionTok{sudo}\NormalTok{ systemctl daemon{-}reload}
\FunctionTok{sudo}\NormalTok{ systemctl start grafana{-}server}
\FunctionTok{sudo}\NormalTok{ systemctl enable grafana{-}server.service}
\FunctionTok{sudo}\NormalTok{ apt autoremove }\AttributeTok{{-}y}

\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{Klonen der Pimoroni Python Bibliotheken}\VariableTok{$\{NC\}}\StringTok{"}
\BuiltInTok{echo} \StringTok{"}\VariableTok{$\{COL\}}\StringTok{in Documents/Libraries}\VariableTok{$\{NC\}}\StringTok{"}
\BuiltInTok{cd}\NormalTok{ Documents}
\FunctionTok{mkdir}\NormalTok{ Libraries}
\BuiltInTok{cd}\NormalTok{ Libraries}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/st7789{-}python}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/bme680{-}python }
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/icm20948{-}python}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/as7262{-}python}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/max30105{-}python}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/vl53l5cx{-}python}
\FunctionTok{git}\NormalTok{ clone https://github.com/pimoroni/mlx90640{-}library}
\BuiltInTok{cd}\NormalTok{ ../../}
\end{Highlighting}
\end{Shaded}

Zip Datei des Ordners Libraries erstellen fÃ¼r das Backup der
Beispielcode der einzelnen Sensoren.

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ \textasciitilde{}/Documents/}
\FunctionTok{zip} \AttributeTok{{-}r}\NormalTok{ Libraries.zip Libraries}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{Installation der Python Libraries mit
\emph{venv}}{Installation der Python Libraries mit venv}}\label{installation-der-python-libraries-mit-venv}

Mit dem Upgrade auf \emph{Raspberry Pi Bookworm} wird Python auf die
Version 3.11 aktualisiert. Ab dieser Version kÃ¶nnen Python Libraries
nicht mehr systemweit installiert werden. \emph{Python Virtual
Environment} sind nun erfordert, entweder pro Projekt oder pro Userkonto
siehe \url{http://rptl.io/venv} fÃ¼r weitere Informationen.

Erstelle eine Python Virtual Environment \texttt{.env} im Homeordner
\texttt{\textasciitilde{}/} mit folgenden Befehlen fÃ¼r den User
\texttt{iot} und aktiviere die Virtual Environment mit
\texttt{source\ \textasciitilde{}/.env/bin/activate} und deaktiviere die
Virtual Environment mit \texttt{deactivate}. Wenn die Virtual
Environment projetbasiert im Projektordner erstellt wird reicht es den
Pfad zum Projektordner anzugeben z.B.
\texttt{python\ -m\ venv\ \textasciitilde{}/Development/Projekt1/env}
und die Virtual Environment wird im Projektordner erstellt.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python} \AttributeTok{{-}m}\NormalTok{ venv \textasciitilde{}/.env}
\BuiltInTok{source}\NormalTok{ \textasciitilde{}/.env/bin/activate}
\end{Highlighting}
\end{Shaded}

Requirements.txt Datei erstellen mit den Python Libraries, die in der
Virtual Environment installiert werden sollen. Die Datei kann mit
\texttt{nano\ requirements.txt} erstellt und mit \texttt{Ctrl+o} und
\texttt{Ctrl+x} gespeichert werden. Python Libraries in der Virtual
Environment installieren mit
\texttt{pip\ install\ -r\ requirements.txt}. Nutze fÃ¼r die Installation
folgende \texttt{requirements.txt} Datei. Kontrolliere mit
\texttt{pip\ list} ob die Libraries installiert wurden.

\emph{requirements.txt}: Python Libraries fÃ¼r die Pimoroni Sensoren

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matplotlib}
\NormalTok{scipy}
\NormalTok{pigments}
\NormalTok{numpy}
\NormalTok{jupyter}
\NormalTok{rpi.gpio}
\NormalTok{spidev}
\NormalTok{pillow}
\NormalTok{numpy}
\NormalTok{st7789}
\NormalTok{bme680}
\NormalTok{icm20948}
\NormalTok{as7262}
\NormalTok{max30105}
\NormalTok{vl53l5cx{-}ctypes}
\NormalTok{RPI.GPIO}
\NormalTok{adafruit{-}blinka}
\end{Highlighting}
\end{Shaded}

\section{Konfigurationsdateien
editieren}\label{konfigurationsdateien-editieren}

\subsection{Raspberry Pi Einstellungen fÃ¼r I2C, SPI, SSH, VNC
anpassen}\label{raspberry-pi-einstellungen-fuxfcr-i2c-spi-ssh-vnc-anpassen}

\textbf{Interface Options aktivieren} In den Raspberry Pi
Konfigurationseinstellungen mit \texttt{sudo\ raspi-config} die
Interface Optionen \emph{I2C, SPI, SSH und ev VNC (Virtual Network
Computing) oder RPi Connect} aktivieren. VNC, RPi Connect Hollingworth
(\citeproc{ref-Hollingworth2024}{2024})\footnote{RPI Connect erlaubt
  Ã¼ber einen Relay Server die Verbindung zu einem Raspberry Pi
  herzustellen Ã¼ber WebRTC wie Browser Clients fÃ¼r Zoom, Slack,
  Microsoft Teams. Der Relay Server wird nur fÃ¼r die Erstellung der
  Verbindung benÃ¶tigt und wird von Raspberry Pi kostenlos betrieben. RPi
  Connect installieren mit \texttt{sudo\ apt\ install\ rpi-connect} und
  mit \texttt{sudo\ reboot} neu starten.} werden nur benÃ¶tigt, wenn der
Raspberry Pi Ã¼ber Fernzugriff gesteuert werden soll.

\begin{figure}[H]

{\centering \includegraphics{images/raspberry_pi_enable_ssh_spi_i2c.png}

}

\caption{Ãber die Konsole \texttt{raspi-config} starten und Ã¼ber das
Konsolenmenu (links) die Einstellungen in den \emph{Interface Options}
(rechts) \emph{I2C, SPI, SSH und ev VNC} aktivieren.}

\end{figure}%

\subsection{Baud rate des I2C Protokolls
anpassen}\label{baud-rate-des-i2c-protokolls-anpassen}

Baud rate des I2C Protokolls mit
\texttt{sudo\ nano\ /boot/firmware/config.txt} Ã¶ffnen und folgende Zeile
ergÃ¤nzen. Mit \texttt{Ctrl+o} und \texttt{Ctrl+x} speichern (siehe
\citeproc{ref-RaspberryPiLtd2024a}{Raspberry Pi Ltd, 2024b}).

\begin{Shaded}
\begin{Highlighting}[]
\VariableTok{dtparam}\OperatorTok{=}\NormalTok{i2c\_arm=on,i2c\_arm\_baudrate=400000}
\end{Highlighting}
\end{Shaded}

\subsection{Mosquitto Server
Konfiguration}\label{mosquitto-server-konfiguration}

\textbf{Mosquitto Server Konfiguration} anpassen mit
\texttt{sudo\ nano\ /etc/mosquitto/mosquitto.conf} und am Ende der Datei
folgendes einfÃ¼gen (\citeproc{ref-EclipseFoundation2021}{Eclipse
Foundation, 2021}).

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{listener}\NormalTok{ 1883}
\ExtensionTok{allow\_anonymous}\NormalTok{ true}
\end{Highlighting}
\end{Shaded}

Mosquitto Server neu starten mit
\texttt{sudo\ systemctl\ restart\ mosquitto}

\textbf{Node-Red Einstellungen initialisieren} mit
\texttt{sudo\ node-red\ admin\ init}

\begin{itemize}
\tightlist
\item
  \emph{yes} installation customise settings
\item
  \emph{yes} keep settings file at default location
\item
  \emph{no} setup user security
\item
  \emph{yes} enable project features
\item
  select \emph{manual} workflow
\item
  select \emph{default theme}
\item
  \emph{yes} allow function nodes to load external modules
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{Node{-}RED}\NormalTok{ Settings File initialisation}
\ExtensionTok{=====================================}
\ExtensionTok{This}\NormalTok{ tool will help you create a Node{-}RED settings file.}
\ExtensionTok{â}\NormalTok{ Settings file Â· /root/.node{-}red/settings.js}

\ExtensionTok{User}\NormalTok{ Security}
\ExtensionTok{=============}
\ExtensionTok{â}\NormalTok{ Do you want to setup user security}\PreprocessorTok{?}\NormalTok{ Â· No}

\ExtensionTok{Projects}
\ExtensionTok{========}
\ExtensionTok{The}\NormalTok{ Projects feature allows you to version control your flow using a local git repository.}

\ExtensionTok{â}\NormalTok{ Do you want to enable the Projects feature}\PreprocessorTok{?}\NormalTok{ Â· Yes}
\ExtensionTok{â}\NormalTok{ What project workflow do you want to use}\PreprocessorTok{?}\NormalTok{ Â· manual }\AttributeTok{{-}}\NormalTok{ you must manually commit changes}

\ExtensionTok{Editor}\NormalTok{ settings}
\ExtensionTok{===============}
\ExtensionTok{â}\NormalTok{ Select a theme for the editor. To use any theme other than }\StringTok{"default"}\NormalTok{, you will need to install @node{-}red{-}contrib{-}themes/theme{-}collection in your Node{-}RED user directory. Â· default}
\ExtensionTok{â}\NormalTok{ Select the text editor component to use in the Node{-}RED Editor Â· monaco }\ErrorTok{(}\ExtensionTok{default}\KeywordTok{)}

\ExtensionTok{Node}\NormalTok{ settings}
\ExtensionTok{=============}
\ExtensionTok{â}\NormalTok{ Allow Function nodes to load external modules}\PreprocessorTok{?} \ErrorTok{(}\ExtensionTok{functionExternalModules}\KeywordTok{)} \ExtensionTok{Â·}\NormalTok{ Yes}

\ExtensionTok{Settings}\NormalTok{ file written to /root/.node{-}red/settings.js}
\end{Highlighting}
\end{Shaded}

\section{Installationen testen und
initialisieren}\label{installationen-testen-und-initialisieren}

\subsection{Mosquitto Broker}\label{mosquitto-broker}

Testen ob der Mosquitto Broker und Clients lokal auf dem Raspberry Pi
funktionieren. Erstelle einen Subscriber der fÃ¼r das Topic
\texttt{iot/temperature} eine Subscription erstellt.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{mosquitto\_sub} \AttributeTok{{-}h}\NormalTok{ 127.0.0.1 }\AttributeTok{{-}v} \AttributeTok{{-}t} \StringTok{\textquotesingle{}iot/temperature\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Ãffne ein zweite Shell und erstelle einen Publisher fÃ¼r dasselbe Topic

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{mosquitto\_pub} \AttributeTok{{-}h}\NormalTok{ 127.0.0.1 }\AttributeTok{{-}t} \StringTok{\textquotesingle{}iot/temperature\textquotesingle{}} \AttributeTok{{-}m} \StringTok{\textquotesingle{}Aussentemperatur: 22Â° Celsius\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\subsection{Node-Red}\label{node-red}

Node-Red Server testen :
\texttt{\textless{}IP-Adresse\textgreater{}:1880}
http://192.168.1.205:1880 Influxerweiterung \emph{Palette} installieren:
\emph{Hamburgermenu oben-rechts / Paletten verwalten} und unter
\emph{Palette} / \emph{Installation} die Palette
\texttt{node-red-contrib-influxdb} installieren.

\includegraphics{images/5200_iot_nodered_influxdb_erweiterung.png}

\subsection{InfluxDB}\label{influxdb}

InfluxDB Server testen:
\texttt{\textless{}IP-Adresse\textgreater{}:8086}
http://192.168.1.205:8086 Den \emph{Initial User} erstellen mit
\emph{Username, Password, Organisation} und einem \emph{Bucket} Name,
der ersten Datenbank. Im Anschluss mit Logout/Login den Zugang
verifizieren.

\includegraphics{images/5200_iot_influxdb_setup.png}

\begin{boxtitle}{Hinweis}{colPrimary}

\textbf{Operator API token speichern!} Das Superuser Passwort wird nur
einmal angezeigt. Das \textbf{Operator API token} kopieren und an einem
sicheren Ort speichern! Nach dem Logout/Login ist das Passwort nicht
mehr sichtbar.

\end{boxtitle}

\subsection{Grafana}\label{grafana}

Grafana Server testen: \texttt{\textless{}IP-Adresse\textgreater{}:3000}
http://192.168.1.205:3000 Grafana startet mit dem Default Admin User:
\texttt{admin} und Passwort: \texttt{admin}. Das Passwort Ã¤ndern und im
Anschluss mit Logout/Login den Zugang verifizieren.

\includegraphics{images/5200_iot_grafana_setup.png}

\subsection{Jupyter Notebook}\label{jupyter-notebook}

Jupyter Notebook testen
\texttt{\textless{}IP-Adresse\textgreater{}:9999}
http://192.168.1.205:9999

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# jupter notebook installation testen}
\ExtensionTok{jupyter{-}notebook} \AttributeTok{{-}{-}no{-}browser} \AttributeTok{{-}{-}ip}\OperatorTok{=}\NormalTok{192.168.1.205 }\AttributeTok{{-}{-}port}\NormalTok{ 9999 }\AttributeTok{{-}{-}notebook{-}dir}\NormalTok{ \textasciitilde{}/Documents}
\end{Highlighting}
\end{Shaded}

\subsection{VNC Testen}\label{vnc-testen}

VNC Viewer auf dem PC installieren.
\href{https://www.realvnc.com/en/connect/download/viewer}{Real VNC
Viewer} (standalone .exe, d.h. es ist keine Installation erforderlich).

\textbf{Hinweis:} Beim Starten des VNC Viewers muss man sich nicht
anmelden sondern nur die Option \textbf{Verwenden Sie RealVNC Viewer
ohne sich anzumelden} wÃ¤hlen.

\includegraphics{images/raspberrypi_realvnc.png}

\section{Raspberry Pi Image
verkleinern}\label{raspberry-pi-image-verkleinern}

Das Raspberry Pi Image kann mit dem Tool
\href{https://github.com/Drewsif/PiShrink}{PiShrink} verkleinert werden.
PiShrink kann auf dem Raspberry Pi oder auf einen anderen Linux System
wie Ubuntu oder einer virtuellen Machine mit einem Linux installiert und
genutzt werden.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Backup Image auf den lokalen Rechner mit
  \href{https://sourceforge.net/projects/win32diskimager/}{Win32DiskImager}
  \emph{lesen} und in eine Image Datei schreiben.
\item
  Virtuelle Machine mit Linux Ubuntu/Debian mit \emph{gemeinsamen
  Ordner} starten
\item
  Mit dem Script https://github.com/Drewsif/PiShrink das Image
  verkleinern
\item
  SD Karte Formatieren mit
  \href{https://www.sdcard.org/downloads/formatter}{SD Card Formatter}
\item
  Image auf SD Karte schreiben mit \emph{Win 32 Disk Imager} oder
  \emph{Raspberry Pi Imager}
\item
  FÃ¼r die Archivierung kann das Image mit 7zip zusÃ¤tzlich komprimiert
  werden (Archive Format \texttt{.xz} und Kompressionsstufe
  \texttt{Ultra})
\end{enumerate}

Tutorial: \href{https://www.youtube.com/watch?v=5pdgO3Ncl6k}{How I
Backup and Shrink My SD Card Images - Youtube}

Backup Image mit Win32DiskImager schreiben, mit der Funktion
\emph{Lesen/Read} und diese als Image Datei auf den lokalen Rechner
speichern.

\begin{figure}[H]

{\centering \includegraphics{images/raspberrypi_image_verkleinern_01.png}

}

\caption{Backup Image der SD Karte schreiben mit Win32DiskImager und der
Funktion \emph{Lesen/Read}}

\end{figure}%

Virtuelle Machine mit VM \href{https://www.virtualbox.org/}{VirtualBox}
starten und in den Einstellungen der VM Ã¼ber \emph{GerÃ¤te/Gemeinsame
Ordner} einen gemeinsamen Ordner zwischen VM und dem lokalen Rechner
einrichten.

\begin{figure}[H]

{\centering \includegraphics{images/raspberrypi_image_verkleinern_02.png}

}

\caption{Gemeinsamer Ordner in der VM VirtualBox einrichten}

\end{figure}%

Das Image sollte nun im File Explorer unter ``+ Other Locations'' als
Ordner \emph{host} eingebunden und sichtbar sein.

\begin{figure}[H]

{\centering \includegraphics{images/raspberrypi_image_verkleinern_03.png}

}

\caption{Gemeinsamer Ordner \emph{host} auf der VM Virtualbox
eingebunden}

\end{figure}%

Ãffne nun ein Terminal damit das Script \texttt{pishrink.sh} installiert
und ausgefÃ¼hrt werden kann.

\textbf{Tipp:} Falls das Terminal nicht Ã¶ffnet mit \texttt{Ctrl+Alt+F3}
in das TTY Terminal wechseln.

\textbf{Tipp:} Falls der VM User noch keine Adminrechte hat (bei einer
Neuinstallation von Ubuntu ist das \texttt{root} Passwort nocht nicht
gesetzt), kÃ¶nnen diese nachtrÃ¤glich gesetzt werden mit
\texttt{sudo\ passwd}. Bei der Passwortabfrage das aktuelle User
Passwort eingeben und das neue Root Passwort zweimal eingeben.
Anschliessend als Root User anmelden mit \texttt{su\ -}.\footnote{Einem
  User Adminrechte zuweisen:
  \texttt{sudo\ usermod\ -a\ -G\ sudo\ \textless{}username\textgreater{}},
  Kontoinformationen \texttt{id\ \textless{}username\textgreater{}}
  aufzeigen.}

GitHub: \url{https://github.com/Drewsif/PiShrink}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install prerequisites}
\FunctionTok{sudo}\NormalTok{ apt install parted xz{-}utils}
\CommentTok{\# download the pishrink script}
\FunctionTok{wget} \AttributeTok{{-}O}\NormalTok{ ./pishrink.sh https://raw.githubusercontent.com/Drewsif/PiShrink/master/pishrink.sh}
\CommentTok{\# make the script executable}
\FunctionTok{chmod}\NormalTok{ +x ./pishrink.sh}
\CommentTok{\# run pishrink on the .img file}
\FunctionTok{sudo}\NormalTok{ ./pishrink.sh }\AttributeTok{{-}v}\NormalTok{ /host/}\OperatorTok{\textless{}}\NormalTok{rpi{-}imagefile}\OperatorTok{\textgreater{}}\NormalTok{.img}
\CommentTok{\# Komprimiere die Image als .xz Archive (eher langsam)}
\FunctionTok{xz} \AttributeTok{{-}z} \AttributeTok{{-}9e}\NormalTok{ /host/}\OperatorTok{\textless{}}\NormalTok{rpi{-}imagefile}\OperatorTok{\textgreater{}}\NormalTok{.img}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics[width=0.5\textwidth,height=\textheight]{images/raspberrypi_image_verkleinern_04.png}

}

\caption{Screenshot des Terminals wÃ¤hrend der AusfÃ¼hrung von pishrink}

\end{figure}%

Image mit 7-Zip zusÃ¤tzlich komprimieren File Kontextmenu \emph{7-Zip/Add
to Archive} und als Archive Format \texttt{.xz} sowie den Compression
Level \emph{9-Ultra} wÃ¤hlen.

\begin{figure}[H]

{\centering \includegraphics[width=0.5\textwidth,height=\textheight]{images/raspberrypi_image_verkleinern_05.png}

}

\caption{7-Zip Einstellungen fÃ¼r die zusÃ¤tzliche Kompression des Images
mit \texttt{.xz}.}

\end{figure}%

Falls die SD Karte schon frÃ¼her fÃ¼r Raspberry Pi Images benutzt wurde
und mehrerere Partionen aufweist, kann es helfen die Karte mit dem
\href{https://www.sdcard.org/downloads/formatter/}{SD Card Formatter}
nochmals von Grund auf zu formatieren.

\begin{figure}[H]

{\centering \includegraphics[width=0.5\textwidth,height=\textheight]{images/raspberrypi_image_verkleinern_06.png}

}

\caption{Screenshot des SD Card Formatter}

\end{figure}%

\backmatter

\printindex


\end{document}
